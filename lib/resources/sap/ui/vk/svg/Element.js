/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","../abgrToColor","../NodeContentType"],function(q,c,N){"use strict";var E=function(p){p=p||{};this.type="Group";this.uid=q.sap.uid();this.sid=p.sid||undefined;this.name=p.name||undefined;this.vMask=p.subelement?undefined:(1|0);this.sMask=(0|0);this.matrix=new Float32Array(p.matrix||[1,0,0,1,0,0]);this.parent=null;this.children=[];this.domRef=null;this.nodeContentType=N.Regular;this.materialId=p.materialID;this.userData=p.subelement?{skipIt:true}:{};};E.prototype._initStroke=function(m){this.stroke=new Float32Array([0,0,0,1]);this.strokeWidth=1;this.strokeDashArray=[];if(m){if(m.lineColor){this.stroke=new Float32Array(m.lineColor);}if(m.lineWidth){this.strokeWidth=m.lineWidth;}if(m.lineStyle&&m.lineStyle.dashPattern){this.strokeDashArray=m.lineStyle.dashPattern;}if(m.lineStyle&&m.lineStyle.widthCoordinateSpace!==undefined){this.widthCoordinateSpace=m.lineStyle.widthCoordinateSpace;}}};E.prototype._initFillAndStroke=function(m){this.fill=new Float32Array(m&&m.color?m.color:[0,0,0,0]);this._initStroke(m);};E.prototype.setMaterial=function(m,a){if(m&&this.materialId==m.materialId){this._initFillAndStroke(m);}for(var i=0,l=this.children.length;i<l;i++){this.children[i].setMaterial(m);}if(a){this.invalidate();}};E.prototype.add=function(a){if(a.parent!==null){a.parent.remove(a);}a.parent=this;this.children.push(a);a.sMask=this.sMask;if(this.highlightColor){a.highlightColor=this.highlightColor;}return this;};E.prototype.remove=function(a){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;this.children.splice(i,1);}return this;};E.prototype.replace=function(a,n){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;n.parent=this;this.children[i]=n;n.domRef=a.domRef;n.invalidate();}return this;};E.prototype._vkPersistentId=function(){var o=this;do{if(o.sid){return o.sid;}o=o.parent;}while(o);return null;};E.prototype._vkGetNodeContentType=function(){return this.nodeContentType;};E.prototype._vkSetNodeContentType=function(n){this.nodeContentType=n;};E.prototype.traverse=function(a){a(this);var b=this.children;for(var i=0,l=b.length;i<l;i++){b[i].traverse(a);}};E.prototype.traverseAncestors=function(a){var p=this.parent;if(p!==null){a(p);p.traverseAncestors(a);}};E.prototype.traverseVisible=function(a,m){if(this.isVisible(m)){a(this);var b=this.children;for(var i=0,l=b.length;i<l;i++){b[i].traverseVisible(a,m);}}};E.prototype.setVisible=function(m,v){if(this.vMask!==undefined){if(v){this.vMask|=m;}else{this.vMask&=~m;}if(this.domRef!==null){this.domRef.setAttribute("visibility",v?"visible":"hidden");}}};E.prototype.isVisible=function(m){return this.vMask!==undefined?(this.vMask&m)!==0:true;};E.prototype._updateColor=function(m){if(this.domRef!==null){if(this.fill!==undefined){this.domRef.setAttribute("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth>0){this.domRef.setAttribute("stroke",this._cssColor(this.stroke,m));}}};E.prototype.setSelected=function(m,a,b){if(a){this.sMask|=m;this.highlightColor=b;}else{this.sMask&=~m;delete this.highlightColor;}this._updateColor(m);};E.prototype.isSelected=function(m){return(this.sMask&m)!==0;};E.prototype.setTintColor=function(m,t){this.tintColor=t;this._updateColor(m);};E.prototype.setOpacity=function(m,o){this.opacity=o;if(this.domRef!==null){this.domRef.setAttribute("opacity",o!==undefined?o:1);}};E.prototype.setMatrix=function(m){this.matrix=m;if(this.domRef!==null){this.domRef.setAttribute("transform","matrix("+this.matrix.join(",")+")");}};E._multiplyMatrices=function(a,b){var f=a[0],g=a[2],i=a[4];var j=a[1],k=a[3],l=a[5];var m=b[0],n=b[2],o=b[4];var p=b[1],r=b[3],t=b[5];return new Float32Array([f*m+g*p,j*m+k*p,f*n+g*r,j*n+k*r,f*o+g*t+i,j*o+k*t+l]);};E.prototype._matrixWorld=function(m){if(m!==undefined){return E._multiplyMatrices(m,this.matrix);}else{var p=this.parent;var a=this.matrix;while(p!==null){a=E._multiplyMatrices(p.matrix,a);p=p.parent;}return a;}};function e(b,x,y,a,f){b.min.x=Math.min(b.min.x,x-a);b.min.y=Math.min(b.min.y,y-f);b.max.x=Math.max(b.max.x,x+a);b.max.y=Math.max(b.max.y,y+f);}function s(a){return a*a;}E.prototype._expandBoundingBoxCE=function(b,m,a,f,g,i){e(b,a*m[0]+f*m[2]+m[4],a*m[1]+f*m[3]+m[5],Math.abs(g*m[0])+Math.abs(i*m[2]),Math.abs(g*m[1])+Math.abs(i*m[3]));};E.prototype._expandBoundingBoxCR=function(b,m,a,f,r,g){e(b,a*m[0]+f*m[2]+m[4],a*m[1]+f*m[3]+m[5],Math.sqrt(s(r*m[0])+s(g*m[2])),Math.sqrt(s(r*m[1])+s(g*m[3])));};E.prototype._expandBoundingBox=function(b,m){};E.prototype._expandBoundingBoxRecursive=function(b,m,a){if(this.isVisible(m)){var f=this._matrixWorld(a);this._expandBoundingBox(b,f);var g=this.children;for(var i=0,l=g.length;i<l;i++){g[i]._expandBoundingBoxRecursive(b,m,f);}}};E.prototype._getSceneTreeElement=function(){var a=this;var p=a.parent;while(p){if(p.userData.closed){a=p;}p=p.parent;}while(a.userData.skipIt){a=a.parent;}return a;};E.prototype._findRectElementsRecursive=function(a,r,m,b){if(this.isVisible(m)){var f=this._matrixWorld(b);var g=this.children;var j={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};this._expandBoundingBox(j,f);if(j.min.x<=r.x2&&j.max.x>=r.x1&&j.min.y<=r.y2&&j.max.y>=r.y1){a.add(this._getSceneTreeElement());}for(var i=0,l=g.length;i<l;i++){g[i]._findRectElementsRecursive(a,r,m,f);}}};E.prototype.tagName=function(){return"g";};E.prototype._setBaseAttributes=function(a,m){a("id",this.uid);a("opacity",this.opacity!==undefined?this.opacity:1);a("transform","matrix("+this.matrix.join(",")+")");if(this.vMask!==undefined){a("visibility",this.isVisible(m)?"visible":"hidden");}if(this.fill!==undefined){a("fill",this._cssColor(this.fill,m));}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth>0){a("stroke",this._cssColor(this.stroke,m));a("stroke-width",this.strokeWidth);a("vector-effect","non-scaling-stroke");if(this.strokeDashArray.length>0){a("stroke-dasharray",this.strokeDashArray.join(" "));}}};E.prototype._setSpecificAttributes=function(a){};E.prototype.render=function(r,m){var t=this.tagName();r.write("<"+t);var a=r.writeAttribute.bind(r);this._setBaseAttributes(a,m);this._setSpecificAttributes(a);r.write(">");if(this._getTextContent){r.write(this._getTextContent());}this.children.forEach(function(b){b.render(r,m);});r.write("</"+t+">");};E.prototype._createDomElement=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg",this.tagName());var f=b.setAttribute.bind(b);this._setBaseAttributes(f,1<<a);this._setSpecificAttributes(f);if(this._getTextContent){b.textContent=this._getTextContent();}return b;};E.prototype.invalidate=function(a){if(this.domRef!==null){var o=this.domRef;this.domRef=this._createDomElement(a);o.parentNode.replaceChild(this.domRef,o);while(o.children.length>0){this.domRef.appendChild(o.children[0]);}}};E.prototype.rerender=function(a){var o=this.domRef;if(o!==null&&o.parentNode!==null){this.traverse(function(n){n.domRef=n._createDomElement(a);if(n===this){o.parentNode.replaceChild(n.domRef,o);}else{n.parent.domRef.appendChild(n.domRef);}}.bind(this));}};function d(a,b){var f=a.children;for(var i=0,l=f.length;i<l;i++){if(f[i].id===b){return f[i];}}return null;}E.prototype._setDomRef=function(a){this.domRef=a;var b=this.children;for(var i=0,l=b.length;i<l;i++){var f=b[i];f._setDomRef(a?d(a,f.uid):null);}};E.prototype.getElementByProperty=function(n,v){if(this[n]===v){return this;}var a=this.children;for(var i=0,l=a.length;i<l;i++){var b=a[i].getElementByProperty(n,v);if(b!==null){return b;}}return null;};E.prototype.getElementById=function(i){return this.getElementByProperty("uid",i);};function h(a,b,f){return a+(b-a)*f;}E.prototype._cssColor=function(f,m){var a=f[3];if(a===0){return"none";}var r=f[0]*255;var g=f[1]*255;var b=f[2]*255;var t=this.tintColor;if(t){t=c(t);var i=t.alpha;if(i>0){r=h(r,t.red,i);g=h(g,t.green,i);b=h(b,t.blue,i);}}var j=this.highlightColor;if(j){j=c(j);var k=j.alpha;if(k>0){r=h(r,j.red,k);g=h(g,j.green,k);b=h(b,j.blue,k);a=h(a,k,k);}}var l=((r<<24)|(g<<16)|(b<<8)|(a*255))>>>0;return"#"+("00000000"+l.toString(16)).slice(-8);};return E;});
