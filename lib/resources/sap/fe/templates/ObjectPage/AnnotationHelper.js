/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/Log","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/base/ManagedObject","sap/base/util/JSTokenizer","sap/base/util/merge","sap/base/strings/formatMessage","sap/fe/core/CommonUtils","sap/fe/macros/field/FieldHelper","sap/fe/macros/CommonHelper"],function(L,O,M,J,m,f,C,F,a){"use strict";function g(v,k){return sap.ui.getCore().byId(v.stableId).getModel("sap.fe.i18n").getResourceBundle().then(function(r){return C.getTranslatedText(k,r,null,v.entitySet);});}var A={buildExpressionForProgressIndicatorPercentValue:function(i,d,u){var p="0";var e;var o=i.getModel(1);var b=o.createBindingContext("/");if(d.Value&&d.Value.$Path){var v=O.value(d.Value,{context:b});var V="$"+v;var t;if(d.TargetValue){t=O.value(d.TargetValue,{context:b});if(d.TargetValue.$Path){t="$"+t;}}var E="(({0} > 100) ? 100 : (({0} < 0) ? 0 : ({0} * 1)))";var s="(({1} > 0) ? (({0} > {1}) ? 100 : (({0} < 0) ? 0 : ({0} / {1} * 100))) : 0)";if(u){u="'"+u+"'";e="'{'= ({2} === ''%'') ? "+E+" : "+s+" '}'";p=f(e,[V,t,u]);}else{e="'{'= "+s+" '}'";p=f(e,[V,t]);}}return p;},buildExpressionForProgressIndicatorDisplayValue:function(i,d,u){var o=i.getModel(1);var b=o.createBindingContext("/");var p=[];p.push(O.value(d.Value,{context:b}));p.push(O.value(d.TargetValue,{context:b}));p.push(u);var D=A.formatDisplayValue(p);return D;},formatDisplayValue:function(p){var d="",v=p[0],t=p[1],u=p[2];if(v){return sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates",true).then(function(r){if(u){if(u==="%"){d=r.getText("T_ANNOTATION_HELPER_PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_PERCENT",[v]);}else{if(t){d=r.getText("T_ANNOTATION_HELPER_PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_NOT_PERCENT",[v,t,u]);}else{d=r.getText("T_ANNOTATION_HELPER_PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_NOT_PERCENT_NO_TARGET_VALUE",[v,u]);}}}else if(t){d=r.getText("T_COMMON_PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM",[v,t]);}else{d=v;}return d;});}else{L.warning("Value property is mandatory, the default (empty string) will be returned");}},buildExpressionForCriticality:function(d){var s=sap.ui.core.ValueState.None;var e;var c=d.Criticality;if(c){e="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+sap.ui.core.ValueState.Error+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+sap.ui.core.ValueState.Warning+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+sap.ui.core.ValueState.Success+"'' : "+"''"+sap.ui.core.ValueState.None+"'' '}'";if(c.$Path){var b="${"+c.$Path+"}";s=f(e,b);}else if(c.$EnumMember){var h="'"+c.$EnumMember+"'";s=f(e,h);}else{L.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{L.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return s;},buildRatingIndicatorSubtitleExpression:function(c,s){if(s){return sap.fe.templates.ObjectPage.AnnotationHelper.formatRatingIndicatorSubTitle(O.value(s,{context:c}));}},getHeaderRatingIndicatorText:function(c,d){if(d&&d.SampleSize){return A.buildRatingIndicatorSubtitleExpression(c,d.SampleSize);}else if(d&&d.Description){var s=O.value(d.Description,{context:c});return"${path:"+s+"}";}},formatRatingIndicatorSubTitle:function(s){if(s){return sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates",true).then(function(r){var S=s>1?r.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL_PLURAL"):r.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL");return r.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE",[s,S]);});}},getElementBinding:function(p){var n=O.getNavigationPath(p);if(n){return"{path:'"+n+"'}";}else{return"{path: ''}";}},getDeleteButtonVisibility:function(d,v,D){if(d==="false"||D==="true"){return false;}if(v>1){if(D){return D==="false"?"{= (${ui>/editMode} === 'Editable')}":"{= (${ui>/editMode} === 'Editable') &&  !$"+D+"}";}else{return"{= (${ui>/editMode} === 'Editable')}";}}else if(D){return D==="false"?"{= !(${ui>/editMode} === 'Editable')}":"{= !(${ui>/editMode} === 'Editable') && !$"+D+"}";}else{return"{= !(${ui>/editMode} === 'Editable')}";}},getDeleteButtonEnabled:function(d){if(d==="false"){return false;}else if(d&&d!=="true"){return"{= $"+d+"}";}else{return true;}},getEditAction:function(e){var p=e.getPath(),o=e.getObject(p+"@");var d=o.hasOwnProperty("@com.sap.vocabularies.Common.v1.DraftRoot");var s=o.hasOwnProperty("@com.sap.vocabularies.Session.v1.StickySessionSupported");var b;if(d){b=e.getObject(p+"@com.sap.vocabularies.Common.v1.DraftRoot/EditAction");}else if(s){b=e.getObject(p+"@com.sap.vocabularies.Session.v1.StickySessionSupported/EditAction");}return!b?b:p+"/"+b;},isReadOnlyFromStaticAnnotations:function(o,b){var c,i,r;if(o["@Org.OData.Core.V1.Computed"]){c=o["@Org.OData.Core.V1.Computed"].Bool?o["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(o["@Org.OData.Core.V1.Immutable"]){i=o["@Org.OData.Core.V1.Immutable"].Bool?o["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}r=c||i;if(b){r=r||b=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}if(r){return false;}else{return true;}},buildExpressionForTitle:function(h,v){var t="",r=/^\{@i18n>[^\\\{\}:]+\}$/,T=Promise.resolve(t);if(h&&h.Title){t="{= ${localUI>/createMode} ";var H;if(typeof h.Title.Value==="object"){H="${"+h.Title.Value.$Path+"}";}else if(r.test(h.Title.Value)){H="$"+h.Title.Value;}else{H="'"+h.Title.Value+"'";}if(h.TypeName){t=t+"&& ("+H+" === '' || "+H+" === undefined || "+H+" === null)";T=g(v,"T_ANNOTATION_HELPER_DEFAULT_OBJECT_PAGE_HEADER_TITLE").then(function(s){return(t+" ? '"+s+"' + ': ' + '"+h.TypeName+"' : "+H+"}");});}else{T=g(v,"T_ANNOTATION_HELPER_DEFAULT_OBJECT_PAGE_HEADER_TITLE_NO_HEADER_INFO").then(function(s){return t+" ? '"+s+"' : "+H+"}";});}}return T;},buildExpressionForDesc:function(h){var d;if(h&&h.Description){if(typeof h.Description.Value==="object"){d="{"+h.Description.Value.$Path+"}";}else{d=h.Description.Value;}}return d;},isReadOnlyFromDynamicAnnotations:function(o){var i;if(o){if(M.bindingParser(o)){i="$"+o+" === '1'";}}if(i){return"{= "+i+"? false : true }";}else{return true;}},getBindingWithoutMeasure:function(b){var B=J.parseJS(b,0).result,o={showMeasure:false};B=m(B,{formatOptions:o});return JSON.stringify(B);},getExpressionForMicroChartTitlePress:function(c,o,s){if(c){if((c["targetOutbound"]&&c["targetOutbound"]["outbound"])||(c["targetOutbound"]&&c["targetOutbound"]["outbound"]&&c["targetSections"])){return(".handlers.onDataPointTitlePressed($controller, ${$source>/},'"+JSON.stringify(o)+"','"+c["targetOutbound"]["outbound"]+"','"+s+"' )");}else if(c["targetSections"]){return".handlers.navigateToSubSection($controller, '"+JSON.stringify(c["targetSections"])+"')";}else{return undefined;}}},getMicroChartTitleAsLink:function(c){if(c&&(c["targetOutbound"]||(c["targetOutbound"]&&c["targetSections"]))){return"External";}else if(c&&c["targetSections"]){return"InPage";}else{return"None";}},getGroupIdFromConfig:function(c,s,d){var o=c[s],b=["Heroes","Decoration","Workers","LongRunners"],G=d;if(o&&o.requestGroupId&&b.some(function(e){return e===o.requestGroupId;})){G="$auto."+o.requestGroupId;}return G;},getBindingWithGroupIdFromConfig:function(c,k){var G=A.getGroupIdFromConfig(c,k),b;if(G){b="{ path : '', parameters : { $$groupId : '"+G+"' } }";}return b;},doesFieldGroupContainOnlyOneMultiLineDataField:function(d,o){if(d&&d.length===1&&d[0].$Type==="com.sap.vocabularies.UI.v1.DataField"&&o["@com.sap.vocabularies.UI.v1.MultiLineText"]===true){return true;}return false;},getVisibleExpressionForBreadcrumbs:function(v){return v.showBreadCrumbs&&v.fclEnabled!==undefined?"{fclhelper>/breadCrumbIsVisible}":v.showBreadCrumbs;},getEnabledExpressionForHeaderActions:function(o,e,s){if(o===null){var E=(e["@com.sap.vocabularies.Common.v1.DraftRoot"]&&e["@com.sap.vocabularies.Common.v1.DraftRoot"].EditAction)||(e["@com.sap.vocabularies.Common.v1.StickySessionSupported"]&&e["@com.sap.vocabularies.Common.v1.StickySessionSupported"].EditAction);if(E){return"{= ${#"+E+"} ? true : false }";}}if(o&&o.$Path){return s;}else{return true;}},getButtonVisiblityForHeaderActions:function(e,h){var r="{= !(${ui>/editMode} === 'Editable')";if(e&&!e["@com.sap.vocabularies.UI.v1.UpdateHidden"]){r=r+"";}else{r=r+" && !$"+h;}return r+"}";},getButtonEnabledForAnnotationAction:function(b,o,d,s){if(b&&b.$IsBound!==true){return"true";}if(o&&o["@Org.OData.Core.V1.OperationAvailable"]===null&&d){return"{= !${#"+d.Action+"} ? false : true } }";}if(o&&o["@Org.OData.Core.V1.OperationAvailable"]&&o["@Org.OData.Core.V1.OperationAvailable"].$Path){return"{= $"+s+"}";}return true;},getVisiblityOfHeaderFacet:function(o,b){return(A.isReadOnlyFromStaticAnnotations(o,b)&&A.isReadOnlyFromDynamicAnnotations(b));},getPressExpressionForDelete:function(e){var d="${$view>/getBindingContext}",t="${$view>/#fe::ObjectPage/getHeaderTitle/getExpandedHeading/getItems/1/getItems/0/getText}",D="${$view>/#fe::ObjectPage/getHeaderTitle/getExpandedHeading/getItems/1/getItems/1/getText}";var p={title:t,entitySetName:a.addSingleQuotes(e),description:D};return a.generateFunction(".editFlow.deleteSingleDocument",d,a.objectToString(p));},getPressExpressionForEdit:function(d,e,h){var E=a.addSingleQuotes(d&&d.Action),D=d&&d.InvocationGrouping&&d.InvocationGrouping["$EnumMember"],i=D==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";var p={contexts:"${$view>/getBindingContext}",entitySetName:a.addSingleQuotes(e),invocationGrouping:a.addSingleQuotes(i),model:"${$source>/}.getModel()",label:a.addSingleQuotes(d&&d.Label),isNavigable:h&&h.isNavigable};return a.generateFunction(".editFlow.onCallAction",E,a.objectToString(p));},getPressExpressionForFooterAnnotationAction:function(d,e,h){var s=a.addSingleQuotes(d&&d.Action),D=d&&d.InvocationGrouping&&d.InvocationGrouping["$EnumMember"],i=D==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";var p={contexts:"${$view>/#fe::ObjectPage/}.getBindingContext()",entitySetName:a.addSingleQuotes(e),invocationGrouping:a.addSingleQuotes(i),model:"${$source>/}.getModel()",label:a.addSingleQuotes(d&&d.Label),isNavigable:h&&h.isNavigable};return a.generateFunction(".handlers.onCallActionFromFooter","${$view>/}",s,a.objectToString(p));},getStashableHBoxVisiblity:function(h,H){return h===false?true:H&&"{= !%"+H+"}";},getStashableHBoxBinding:function(h,c){if(h&&h.Target&&h.Target["$AnnotationPath"]&&h.Target["$AnnotationPath"].indexOf("DataPoint")>-1){return A.getBindingWithGroupIdFromConfig(c,h.Target["$AnnotationPath"]);}},getChartTitleDescribedBy:function(v,h,c){var s=h&&h.Target&&h.Target["$AnnotationPath"],b=v&&v.controlConfiguration&&v.controlConfiguration[s]&&v.controlConfiguration[s]["navigation"]&&v.controlConfiguration[s]["navigation"]["targetSections"];return b?c:undefined;},getHeaderDataPointNumberExpression:function(p,u,P,v){if(p){return v;}else{return A.getBindingWithoutMeasure(P)||"{"+u+"}";}},getPressExpressionForLink:function(c,o){if(c){if(c["targetOutbound"]&&c["targetOutbound"]["outbound"]){return(".handlers.onDataPointTitlePressed($controller, ${$source>}, "+JSON.stringify(o)+","+JSON.stringify(c["targetOutbound"]["outbound"])+")");}else if(c["targetSections"]){return".handlers.navigateToSubSection($controller, '"+JSON.stringify(c["targetSections"])+"')";}else{return undefined;}}}};A.buildExpressionForProgressIndicatorPercentValue.requiresIContext=true;A.buildExpressionForProgressIndicatorDisplayValue.requiresIContext=true;A.buildRatingIndicatorSubtitleExpression.requiresIContext=true;A.getHeaderRatingIndicatorText.requiresIContext=true;return A;},true);
