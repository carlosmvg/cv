sap.ui.define(["sap/ui/test/OpaBuilder","./FEBuilder","./MacroFieldBuilder","./OverflowToolbarBuilder","./DialogBuilder","sap/fe/test/Utils","sap/ui/table/library","sap/ui/test/matchers/Interactable","sap/ui/core/SortOrder"],function(O,F,M,a,D,U,G,I,S){"use strict";var R=G.RowActionType;function _(m){return m.getType().isA("sap.ui.mdc.table.GridTableType");}function b(m){return _(m)?"rows":"items";}function c(C,m){var i=Number(C);return Number.isNaN(i)?m.getColumns().findIndex(function(o){return(o.getHeader()===C||(o.getDataProperties()&&o.getDataProperties().includes(C)));}):i;}function d(C,r){var m=r;while(m&&!m.isA("sap.ui.mdc.Table")){m=m.getParent();}return m?c(C,m):-1;}function e(C,B){var s={controlType:"sap.m.Button"},o;if(B){s.text=B;}o=F.Matchers.states(s);return o(C)?[C]:O.Matchers.children(o)(C);}function f(C,r){var i=Number(C);var j=r.getCells();if(Number.isNaN(i)){return j.reduce(function(p,o){return p.concat(e(o,C));},[]);}return e(j[i]);}function g(r){var o=r.getRowAction();return o.getItems().reduce(function(i,A,j){if(!i&&A.getType()===R.Navigation){i=o.getAggregation("_icons")[j];}return i;},null);}function h(r){var i=[new I(),F.Matchers.bound()];if(U.isOfType(r,Object)){r=T.Row.Matchers.cellValues(r);}if(r){i=i.concat(r);}return i;}var T=function(){return F.apply(this,arguments).hasType("sap.ui.mdc.Table");};T.create=function(o){return new T(o);};T.prototype=Object.create(F.prototype);T.prototype.constructor=T;T.prototype.hasColumns=function(C){if(!C||Object.keys(C).length===0){return this;}return this.has(T.Matchers.columnsMatcher(C));};T.prototype.hasRows=function(r,i){r=h(r);return i?this.has(T.Matchers.rows(r)):this.has(T.Matchers.rowsMatcher(r));};T.prototype.doOnRows=function(r,v){if(arguments.length===1){v=r;r=undefined;}if(!v){return this;}return this.hasRows(r,true).do(O.Actions.executor(v));};T.prototype.doClickOnCell=function(r,C){return this.doOnRows(r,T.Row.Actions.onCell(C,O.Actions.press()));};T.prototype.doPressKeyboardShortcut=function(s,r,C){if(r&&C){return this.doOnRows(r,T.Row.Actions.onCell(C,F.Actions.keyboardShortcut(s,"input")));}return this.do(F.Actions.keyboardShortcut(s));};T.prototype.doEditValues=function(r,C){if(arguments.length===1){C=r;r=undefined;}return this.doOnRows(r,T.Row.Actions.editCells(C));};T.prototype.doEditCreationRowValues=function(C){return this.has(O.Matchers.aggregation("creationRow")).do(T.Row.Actions.editCells(C));};T.prototype.doSelect=function(r){return this.doOnRows(r,function(o){if(o.getMetadata().getName()==="sap.ui.table.Row"){var t=o.getParent(),i=t.indexOfRow(o);return O.Actions.press("rowsel"+i).executeOn(t);}return O.Actions.press().executeOn(o.getMultiSelectControl());});};T.prototype.doNavigate=function(r){return this.doOnRows(r,function(o){if(o.getMetadata().getName()==="sap.ui.table.Row"){return O.Actions.press().executeOn(g(o));}return O.Actions.press("imgNav").executeOn(o);});};T.prototype.hasNumberOfRows=function(n){return this.has(function(t){var r=t.getRowBinding();return((r&&(n===undefined?r.getLength()!==0:r.getLength()===n))||(!r&&n===0));});};T.prototype.hasQuickFilterItems=function(n){return this.has(function(t){var q=t.getQuickFilter(),i=q.getItems();if(U.isOfType(i,Array)){return i.length===n;}return false;});};T.prototype.doSelectQuickFilter=function(i){return this.has(function(t){return t.getQuickFilter();}).doConditional(F.Matchers.state("controlType","sap.m.Select"),O.Actions.press()).success(function(q){return F.create(this).hasId([].concat(q)[0].getId()).doOnAggregation("items",i,O.Actions.press()).execute();}.bind(this));};T.prototype.doOpenOverflow=function(){return a.openOverflow(this,"toolbar");};T.prototype.doCloseOverflow=function(){return a.closeOverflow(this,"toolbar");};T.prototype.doExecuteAction=function(A){var s=new T(this._getOpaInstance(),this.build()).doOnAggregation("actions",A,O.Actions.press());return this.doOpenOverflow().success(s);};T.prototype.doOpenColumnAdaptation=function(){return this.doOpenOverflow().success(function(t){return O.create().hasType("sap.m.Button").hasId(/-settings$/).has(O.Matchers.ancestor(t)).doPress().execute();});};T.prototype.doOpenColumnSorting=function(){return this.doOpenOverflow().success(function(t){return O.create().hasType("sap.m.Button").hasId(/-sort$/).has(O.Matchers.ancestor(t)).doPress().execute();});};T.prototype.doOpenFilterDialog=function(){return this.doOpenOverflow().success(function(t){return O.create().hasType("sap.m.Button").hasId(/-filter$/).has(O.Matchers.ancestor(t)).doPress().execute();});};T.prototype.doExecuteInlineAction=function(r,C){return this.doOnRows(r,T.Row.Actions.pressInlineAction(C));};T.prototype.doPasteData=function(i){return this.do(function(m){m.firePaste({data:i});});};T.createAdaptationDialogBuilder=function(o){return D.create(o).has(O.Matchers.resourceBundle("title","sap.ui.mdc","table.SETTINGS_COLUMN"));};T.createSortingDialogBuilder=function(o){return D.create(o).has(O.Matchers.resourceBundle("title","sap.ui.mdc","table.SETTINGS_SORT"));};T.createFilteringDialogBuilder=function(o){return D.create(o).has(O.Matchers.resourceBundle("title","sap.ui.mdc","filter.PERSONALIZATION_DIALOG_TITLE"));};T.Cell={Matchers:{state:function(n,v){switch(n){case"editor":case"editors":return function(C){return M.Matchers.states(v)(C);};default:return F.Matchers.state(n,v);}},states:function(s){if(!U.isOfType(s,Object)){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){return T.Cell.Matchers.state(p,s[p]);}));}}};T.Column={Matchers:{state:function(n,v){switch(n){case"sortOrder":return T.Column.Matchers.sortOrder(v);case"template":case"creationTemplate":return function(C){return M.Matchers.states(v)(C.getAggregation(n));};default:return F.Matchers.state(n,v);}},states:function(s){if(!U.isOfType(s,Object)){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){return T.Column.Matchers.state(p,s[p]);}));},sortOrder:function(s){return function(m){var o=m.getParent(),i=_(o),p={};if(i){p.sorted=s===S.None?false:true;if(s!==S.None){p.sortOrder=s;}}else{p.sortIndicator=s;}return F.controlsExist(F.create().hasId(m.getId()+"-innerColumn").hasProperties(p));};}}};T.Row={Matchers:{cell:function(C){return function(r){var i=d(C,r);return r.getCells()[i];};},cellValue:function(C,E){return function(r){var o=T.Row.Matchers.cell(C)(r);return M.Matchers.value(E)(o);};},cellValues:function(C){if(!C){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellValue(s,C[s]);}));},cellProperty:function(C,E){return function(r){var o=T.Row.Matchers.cell(C)(r);return T.Cell.Matchers.states(E)(o);};},cellProperties:function(C){if(!C){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(C).map(function(s){return T.Row.Matchers.cellProperty(s,C[s]);}));},selected:function(s){return function(r){var t=r.getParent(),m=t.getParent(),i=_(m),j=i?t.getSelectedIndices.includes(t.indexOfRow(r)):r.getSelected();return s?j:!j;};},navigated:function(n){return function(r){var i;if(r.getMetadata().getName()==="sap.ui.table.Row"){i=r.getAggregation("_settings").getNavigated();}else{i=r.getNavigated();}return n?i:!i;};},focused:function(){return function(r){var E=[r];if(r.getMetadata().getName()==="sap.ui.table.Row"){E.push(g(r));}return E.some(O.Matchers.focused(true));};},highlighted:function(H){return function(r){var s;if(r.getMetadata().getName()==="sap.ui.table.Row"){s=r.getAggregation("_settings").getHighlight();}else{s=r.getHighlight();}return H===s;};},states:function(s){if(!U.isOfType(s,Object)){return O.Matchers.TRUE;}return F.Matchers.match(Object.keys(s).map(function(p){switch(p){case"selected":return T.Row.Matchers.selected(s.selected);case"focused":return T.Row.Matchers.focused();case"navigated":return T.Row.Matchers.navigated(s.navigated);case"highlight":return T.Row.Matchers.highlighted(s.highlight);default:return F.Matchers.state(p,s[p]);}}));}},Actions:{onCell:function(C,v){return function(r){var i=d(C,r),o;if(r.isA("sap.ui.mdc.table.CreationRow")){o=r._oInnerCreationRow.getCells()[i];}else{o=r.getCells()[i];}if(v.executeOn){v.executeOn(o);}else{v(o);}};},editCell:function(C,v){return T.Row.Actions.onCell(C,O.Actions.enterText(v,true));},editCells:function(C){return Object.keys(C).map(function(s){return T.Row.Actions.editCell(s,C[s]);});},onCellInlineAction:function(C,v){return function(r){var B=f(C,r);return O.Actions.executor(v)(B);};},pressInlineAction:function(C){return T.Row.Actions.onCellInlineAction(C,O.Actions.press());}}};T.Matchers={isGridTable:function(){return _;},rows:function(r){return function(m){return O.Matchers.aggregation(b(m),r)(m._oTable);};},rowsMatcher:function(r){var m=T.Matchers.rows(r);return function(o){return m(o).length>0;};},columns:function(C){return function(m){var i=Object.keys(C).map(function(v){return{index:c(v,m),states:C[v]};}),j=U.getAggregation(m,"columns");return i.reduce(function(r,k){var o=j[k.index];if(o&&(!k.states||F.Matchers.match(T.Column.Matchers.states(k.states))(o))){r.push(o);}return r;},[]);};},columnsMatcher:function(C){var m=T.Matchers.columns(C);return function(o){return m(o).length===Object.keys(C).length;};}};T.Actions={};return T;});
