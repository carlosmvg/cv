sap.ui.define(["sap/fe/core/converters/common/AnnotationConverter","sap/fe/core/EnvironmentCapabilities"],function(A,E){"use strict";var _={};var g=E.getCapabilities;function c(o,a,v){if(a in o){Object.defineProperty(o,a,{value:v,enumerable:true,configurable:true,writable:true});}else{o[a]=v;}return o;}function d(a,i){return k(a)||j(a,i)||f(a,i)||e();}function e(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function f(o,a){if(!o)return;if(typeof o==="string")return h(o,a);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(o,a);}function h(a,b){if(b==null||b>a.length)b=a.length;for(var i=0,n=new Array(b);i<b;i++){n[i]=a[i];}return n;}function j(a,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(a)))return;var b=[];var n=true;var o=false;var q=undefined;try{for(var r=a[Symbol.iterator](),s;!(n=(s=r.next()).done);n=true){b.push(s.value);if(i&&b.length===i)break;}}catch(t){o=true;q=t;}finally{try{if(!n&&r["return"]!=null)r["return"]();}finally{if(o)throw q;}}return b;}function k(a){if(Array.isArray(a))return a;}var V={"Org.OData.Capabilities.V1":"Capabilities","Org.OData.Core.V1":"Core","Org.OData.Measures.V1":"Measures","com.sap.vocabularies.Common.v1":"Common","com.sap.vocabularies.UI.v1":"UI","com.sap.vocabularies.Session.v1":"Session","com.sap.vocabularies.Analytics.v1":"Analytics","com.sap.vocabularies.PersonalData.v1":"PersonalData","com.sap.vocabularies.Communication.v1":"Communication"};var M={parsePropertyValue:function(a,b,i,n){var o=this;var v;var q=i+"/"+b;if(a===null){v={type:"Null",Null:null};}else if(typeof a==="string"){v={type:"String",String:a};}else if(typeof a==="boolean"){v={type:"Bool",Bool:a};}else if(typeof a==="number"){v={type:"Int",Int:a};}else if(Array.isArray(a)){v={type:"Collection",Collection:a.map(function(s,r){return o.parseAnnotationObject(s,q+"/"+r,n);})};if(a.length>0){if(a[0].hasOwnProperty("$PropertyPath")){v.Collection.type="PropertyPath";}else if(a[0].hasOwnProperty("$Path")){v.Collection.type="Path";}else if(a[0].hasOwnProperty("$NavigationPropertyPath")){v.Collection.type="NavigationPropertyPath";}else if(a[0].hasOwnProperty("$AnnotationPath")){v.Collection.type="AnnotationPath";}else if(a[0].hasOwnProperty("$Type")){v.Collection.type="Record";}else if(typeof a[0]==="object"){v.Collection.type="Record";}else{v.Collection.type="String";}}}else if(a.$Path!==undefined){v={type:"Path",Path:a.$Path};}else if(a.$Decimal!==undefined){v={type:"Decimal",Decimal:parseFloat(a.$Decimal)};}else if(a.$PropertyPath!==undefined){v={type:"PropertyPath",PropertyPath:a.$PropertyPath};}else if(a.$NavigationPropertyPath!==undefined){v={type:"NavigationPropertyPath",NavigationPropertyPath:a.$NavigationPropertyPath};}else if(a.$If!==undefined){v={type:"If",If:a.$If};}else if(a.$AnnotationPath!==undefined){v={type:"AnnotationPath",AnnotationPath:a.$AnnotationPath};}else if(a.$EnumMember!==undefined){v={type:"EnumMember",EnumMember:this.mapNameToAlias(a.$EnumMember.split("/")[0])+"/"+a.$EnumMember.split("/")[1]};}else if(a.$Type){v={type:"Record",Record:this.parseAnnotationObject(a,i,n)};}return{name:b,value:v};},mapNameToAlias:function(a){var b=a.split("@"),i=d(b,2),n=i[0],o=i[1];if(!o){o=n;n="";}else{n+="@";}var q=o.lastIndexOf(".");return n+V[o.substr(0,q)]+"."+o.substr(q+1);},parseAnnotationObject:function(a,b,i){var n=this;var o={};if(a===null){o={type:"Null",Null:null};}else if(typeof a==="string"){o={type:"String",String:a};}else if(typeof a==="boolean"){o={type:"Bool",Bool:a};}else if(typeof a==="number"){o={type:"Int",Int:a};}else if(a.$AnnotationPath!==undefined){o={type:"AnnotationPath",AnnotationPath:a.$AnnotationPath};}else if(a.$Path!==undefined){o={type:"Path",Path:a.$Path};}else if(a.$Decimal!==undefined){o={type:"Decimal",Decimal:parseFloat(a.$Decimal)};}else if(a.$PropertyPath!==undefined){o={type:"PropertyPath",PropertyPath:a.$PropertyPath};}else if(a.$If!==undefined){o={type:"If",If:a.$If};}else if(a.$NavigationPropertyPath!==undefined){o={type:"NavigationPropertyPath",NavigationPropertyPath:a.$NavigationPropertyPath};}else if(a.$EnumMember!==undefined){o={type:"EnumMember",EnumMember:this.mapNameToAlias(a.$EnumMember.split("/")[0])+"/"+a.$EnumMember.split("/")[1]};}else if(Array.isArray(a)){var q=o;q.collection=a.map(function(s,u){return n.parseAnnotationObject(s,b+"/"+u,i);});if(a.length>0){if(a[0].hasOwnProperty("$PropertyPath")){q.collection.type="PropertyPath";}else if(a[0].hasOwnProperty("$Path")){q.collection.type="Path";}else if(a[0].hasOwnProperty("$NavigationPropertyPath")){q.collection.type="NavigationPropertyPath";}else if(a[0].hasOwnProperty("$AnnotationPath")){q.collection.type="AnnotationPath";}else if(a[0].hasOwnProperty("$Type")){q.collection.type="Record";}else if(a[0].hasOwnProperty("$If")){q.collection.type="If";}else if(typeof a[0]==="object"){q.collection.type="Record";}else{q.collection.type="String";}}}else{if(a.$Type){var t=a.$Type;o.type=t;}var r=[];Object.keys(a).forEach(function(s){if(s!=="$Type"&&s!=="$If"&&s!=="$Eq"&&!s.startsWith("@")){r.push(n.parsePropertyValue(a[s],s,b,i));}else if(s.startsWith("@")){n.createAnnotationLists(c({},s,a[s]),b,i);}});o.propertyValues=r;}return o;},getOrCreateAnnotationList:function(t,a){var b=a.find(function(i){return i.target===t;});if(!b){b={target:t,annotations:[]};a.push(b);}return b;},createAnnotationLists:function(a,b,i){var n=this;var o=this.getOrCreateAnnotationList(b,i);var C=g();if(!C.MicroChart){delete a["@com.sap.vocabularies.UI.v1.Chart"];}Object.keys(a).forEach(function(q){var r=a[q];switch(q){case"@com.sap.vocabularies.UI.v1.HeaderFacets":if(!C.MicroChart){r=r.filter(function(R){return R.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.Chart")===-1;});}break;case"@com.sap.vocabularies.UI.v1.Identification":if(!C.IntentBasedNavigation){r=r.filter(function(R){return R.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation";});}break;case"@com.sap.vocabularies.UI.v1.LineItem":case"@com.sap.vocabularies.UI.v1.FieldGroup":if(!C.IntentBasedNavigation){r=r.filter(function(R){return R.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation";});}if(!C.MicroChart){r=r.filter(function(R){if(R.Target&&R.Target.$AnnotationPath){return R.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.Chart")===-1;}else{return true;}});}break;default:break;}a[q]=r;var s=o;var t=q.split("#");var u=t[1];q=t[0];var v=q.split("@");if(v.length>2){s=n.getOrCreateAnnotationList(b+"@"+v[1],i);q=v[2];}else{q=v[1];}var w={term:"".concat(q),qualifier:u};var x=b+"@"+w.term;if(u){x+="#"+u;}var y=false;if(r===null){w.value={type:"Bool",Bool:r};}else if(typeof r==="string"){w.value={type:"String",String:r};}else if(typeof r==="boolean"){w.value={type:"Bool",Bool:r};}else if(typeof r==="number"){w.value={type:"Int",Int:r};}else if(r.$If!==undefined){w.value={type:"If",If:r.$If};}else if(r.$Path!==undefined){w.value={type:"Path",Path:r.$Path};}else if(r.$AnnotationPath!==undefined){w.value={type:"AnnotationPath",AnnotationPath:r.$AnnotationPath};}else if(r.$Decimal!==undefined){w.value={type:"Decimal",Decimal:parseFloat(r.$Decimal)};}else if(r.$EnumMember!==undefined){w.value={type:"EnumMember",EnumMember:n.mapNameToAlias(r.$EnumMember.split("/")[0])+"/"+r.$EnumMember.split("/")[1]};}else if(Array.isArray(r)){y=true;w.collection=r.map(function(F,G){return n.parseAnnotationObject(F,x+"/"+G,i);});if(r.length>0){if(r[0].hasOwnProperty("$PropertyPath")){w.collection.type="PropertyPath";}else if(r[0].hasOwnProperty("$Path")){w.collection.type="Path";}else if(r[0].hasOwnProperty("$NavigationPropertyPath")){w.collection.type="NavigationPropertyPath";}else if(r[0].hasOwnProperty("$AnnotationPath")){w.collection.type="AnnotationPath";}else if(r[0].hasOwnProperty("$Type")){w.collection.type="Record";}else if(typeof r[0]==="object"){w.collection.type="Record";}else{w.collection.type="String";}}}else{var z={propertyValues:[]};if(r.$Type){var B=r.$Type;z.type="".concat(B);}var D=[];Object.keys(r).forEach(function(F){if(F!=="$Type"&&!F.startsWith("@")){D.push(n.parsePropertyValue(r[F],F,x,i));}else if(F.startsWith("@")){i.push({target:x,annotations:[{value:n.parseAnnotationObject(r[F],x,i)}]});}});z.propertyValues=D;w.record=z;}w.isCollection=y;s.annotations.push(w);});},parseProperty:function(o,a,b,i){var n=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(b,"@"));var q=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(b));var r={_type:"Property",name:b,fullyQualifiedName:"".concat(a.fullyQualifiedName,"/").concat(b),type:q.$Type,maxLength:q.$MaxLength,precision:q.$Precision,scale:q.$Scale,nullable:q.$Nullable};this.createAnnotationLists(n,r.fullyQualifiedName,i);return r;},parseNavigationProperty:function(o,a,n,b){var i=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(n,"@"));var q=o.getObject("/".concat(a.fullyQualifiedName,"/").concat(n));var r=[];if(q.$ReferentialConstraint){r=Object.keys(q.$ReferentialConstraint).map(function(t){return{sourceTypeName:a.name,sourceProperty:t,targetTypeName:q.$Type,targetProperty:q.$ReferentialConstraint[t]};});}var s={_type:"NavigationProperty",name:n,fullyQualifiedName:"".concat(a.fullyQualifiedName,"/").concat(n),partner:q.$Partner,isCollection:q.$isCollection?q.$isCollection:false,containsTarget:q.$ContainsTarget,targetTypeName:q.$Type,referentialConstraint:r};this.createAnnotationLists(i,s.fullyQualifiedName,b);return s;},parseEntitySet:function(o,a,b,i){var n=o.getObject("/".concat(a));var q=o.getObject("/".concat(a,"@"));var r={_type:"EntitySet",name:a,navigationPropertyBinding:{},entityTypeName:n.$Type,fullyQualifiedName:"".concat(i,"/").concat(a)};this.createAnnotationLists(q,r.fullyQualifiedName,b);return r;},parseEntityType:function(o,a,b,n){var i=this;var q=o.getObject("/".concat(a,"@"));var r=o.getObject("/".concat(a));var s=r.$Key;var t={_type:"EntityType",name:a.replace(n+".",""),fullyQualifiedName:a,keys:[],entityProperties:[],navigationProperties:[]};this.createAnnotationLists(q,t.fullyQualifiedName,b);var u=Object.keys(r).filter(function(w){if(w!="$Key"&&w!="$kind"){return r[w].$kind==="Property";}}).map(function(w){return i.parseProperty(o,t,w,b);});var v=Object.keys(r).filter(function(w){if(w!="$Key"&&w!="$kind"){return r[w].$kind==="NavigationProperty";}}).map(function(w){return i.parseNavigationProperty(o,t,w,b);});t.keys=s.map(function(w){return u.find(function(x){return x.name===w;});}).filter(function(w){return w!==undefined;});t.entityProperties=u;t.navigationProperties=v;return t;},parseAction:function(a,b,n){var i="";var o="".concat(a);if(b.$IsBound){i=b.$Parameter.filter(function(r){return r.$Name===b.$EntitySetPath;}).map(function(r){return r.$Type;}).join("");o="".concat(a,"(").concat(i,")");}var q=b.$Parameter||[];return{_type:"Action",name:a.substr(n.length+1),fullyQualifiedName:o,isBound:b.$IsBound,sourceType:i,returnType:b.$ReturnType?b.$ReturnType.$Type:"",parameters:q.map(function(r){return{_type:"ActionParameter",isEntitySet:r.$Type===b.$EntitySetPath,fullyQualifiedName:"".concat(o,"/").concat(r.$Name),type:r.$Type};})};},parseEntityTypes:function(o){var i=this;var n=o.getObject("/$");var q=o.getObject("/");var r=[];var s=[];var t=[];var u=n.$EntityContainer;var v="";var w=Object.keys(n).filter(function(a){return n[a].$kind==="Schema";});if(w&&w.length>0){v=w[0].substr(0,w[0].length-1);}else if(s&&s.length){v=s[0].fullyQualifiedName.replace(s[0].name,"");v=v.substr(0,v.length-1);}Object.keys(n).filter(function(a){return a!=="$kind"&&n[a].$kind==="EntityType";}).forEach(function(a){var b=i.parseEntityType(o,a,r,v);s.push(b);});Object.keys(q).filter(function(a){return a!=="$kind"&&q[a].$kind==="EntitySet";}).forEach(function(a){var b=i.parseEntitySet(o,a,r,u);t.push(b);});t.forEach(function(a){var b=n[u][a.name].$NavigationPropertyBinding;if(b){Object.keys(b).forEach(function(C){var D=t.find(function(F){return F.name===b[C];});if(D){a.navigationPropertyBinding[C]=D;}});}});var x=Object.keys(n).filter(function(a){return Array.isArray(n[a])&&n[a].length>0&&n[a][0].$kind==="Action";}).reduce(function(a,b){var x=n[b];x.forEach(function(C){a.push(i.parseAction(b,C,v));});return a;},[]);var y=n.$Annotations;var z=Object.keys(y).filter(function(a){return a.indexOf("(")!==-1;});z.forEach(function(a){i.createAnnotationLists(n.$Annotations[a],a,r);});r=r.sort(function(a,b){return a.target.length>=b.target.length?1:-1;});var B=[];return{identification:"metamodelResult",version:"4.0",schema:{entityContainer:{},entitySets:t,entityTypes:s,associations:[],actions:x,namespace:v,annotations:{"metamodelResult":r}},references:B};}};var m={};function l(o){var s=o.id;if(!m.hasOwnProperty(s)){var a=M.parseEntityTypes(o);m[s]=A.convertTypes(a);}return m[s];}_.convertTypes=l;function p(o){var C=l(o.getModel());var P=o.getPath();var a=P.split("/");var t=C.entitySets.find(function(b){return b.name===a[1];});var r=a.slice(2).join("/");if(r.startsWith("$NavigationPropertyBinding")){t=t.navigationPropertyBinding[a[3]];r=a.slice(4).join("/");}if(t){return t.entityType.resolvePath(r);}}_.convertMetaModelContext=p;return _;},false);
