sap.ui.define(["../../ManifestSettings","../../helpers/ID","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/annotations/DataField","sap/fe/core/helpers/BindingExpression","sap/fe/core/converters/helpers/BindingHelper","sap/ui/core/library","sap/fe/core/converters/helpers/Key","sap/fe/core/formatters/TableFormatter"],function(M,I,A,C,D,B,a,l,K,t){"use strict";var _={};var b=K.KeyHelper;var c=a.Draft;var d=B.ifElse;var f=B.formatResult;var e=B.compileBinding;var g=B.bindingExpression;var h=B.annotationExpression;var j=D.isDataFieldTypes;var k=D.isDataFieldForActionAbstract;var P=C.Placement;var m=C.insertCustomElements;var p=A.isActionNavigable;var q=A.getActionsFromManifest;var T=I.TableID;var V=M.VisualizationType;var S=M.SelectionMode;var r=M.CreationMode;var s=M.ActionType;function u(n,i){return z(n)||y(n,i)||w(n,i)||v();}function v(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function w(o,i){if(!o)return;if(typeof o==="string")return x(o,i);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(o,i);}function x(n,o){if(o==null||o>n.length)o=n.length;for(var i=0,o1=new Array(o);i<o;i++){o1[i]=n[i];}return o1;}function y(n,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(n)))return;var o=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=n[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){o.push(_s.value);if(i&&o.length===i)break;}}catch(o1){_d=true;_e=o1;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return o;}function z(i){if(Array.isArray(i))return i;}var E=l.MessageType;var F;(function(F){F["Default"]="Default";F["Annotation"]="Annotation";})(F||(F={}));function G(i,n,o,o1){return m(R(i,n,o),q(o.getManifestControlConfiguration(n).actions,o1,true),{isNavigable:"overwrite",enableOnSelect:"overwrite"});}_.getTableActions=G;function H(i,n,o,o1){return m(b1(i,n,o),c1(o.getManifestControlConfiguration(n).columns,o1),{width:"overwrite",isNavigable:"overwrite"});}_.getTableColumns=H;function J(i,n,o,o1){var p1=n1(i,n,o);var q1=l1(n),r1=q1.navigationPropertyPath;var s1=o.getEntitySet();var t1=s1.name,u1=r1.length===0;var v1=u1?t1:r1;var w1=o.getManifestWrapper().getNavigationConfiguration(v1);return{type:V.Table,annotation:j1(i,n,o,p1,o1),control:p1,actions:G(i,n,o,w1),columns:H(i,n,o,w1)};}_.createTableVisualization=J;function L(i){var n=n1(undefined,"",i);return{type:V.Table,annotation:j1(undefined,"",i,n),control:n,actions:[],columns:Z(i.getEntitySet().entityType,[],i)};}_.createDefaultTableVisualization=L;function N(i){return i.some(function(n){if(n.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return n.Inline!==true;}else if(n.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return n.Inline!==true&&n.RequiresContext;}});}function O(i,n){var o=l1(i),o1=o.navigationPropertyPath;var p1=o1.split("/");var q1={isDeletable:true,isUpdatable:true};var r1=n.getEntitySet();var s1=function(){var x1,y1;var z1=[];p1.reduce(function(E1,F1){if(E1.length>0){E1+="/";}E1+=F1;z1.push(E1);return E1;},"");var A1=false,B1=false;(x1=r1.annotations.Capabilities)===null||x1===void 0?void 0:(y1=x1.NavigationRestrictions)===null||y1===void 0?void 0:y1.RestrictedProperties.forEach(function(E1){var F1;if((E1===null||E1===void 0?void 0:(F1=E1.NavigationProperty)===null||F1===void 0?void 0:F1.type)==="NavigationPropertyPath"){var G1,H1;if(((G1=E1.DeleteRestrictions)===null||G1===void 0?void 0:G1.Deletable)===false){A1=A1||z1.indexOf(E1.NavigationProperty.value)!==-1;}else if(((H1=E1.UpdateRestrictions)===null||H1===void 0?void 0:H1.Updatable)===false){B1=B1||z1.indexOf(E1.NavigationProperty.value)!==-1;}}});q1.isDeletable=!A1;q1.isUpdatable=!B1;var C1=p1.shift();if(C1){var D1=r1.entityType.navigationProperties.find(function(D1){return D1.name==C1;});if(D1&&!D1.containsTarget&&r1.navigationPropertyBinding.hasOwnProperty(C1)){r1=r1.navigationPropertyBinding[C1];}else{r1=null;}}};while((q1.isDeletable||q1.isUpdatable)&&r1&&p1.length>0){s1();}if(r1!==null&&r1.annotations){if(q1.isDeletable){var t1,u1;q1.isDeletable=((t1=r1.annotations.Capabilities)===null||t1===void 0?void 0:(u1=t1.DeleteRestrictions)===null||u1===void 0?void 0:u1.Deletable)!==false;}if(q1.isUpdatable){var v1,w1;q1.isUpdatable=((v1=r1.annotations.Capabilities)===null||v1===void 0?void 0:(w1=v1.UpdateRestrictions)===null||w1===void 0?void 0:w1.Updatable)!==false;}}return q1;}_.getCapabilityRestriction=O;function Q(i,n,o,o1){var p1;if(!i){return S.None;}var q1=o.getManifestControlConfiguration(n);var r1=(p1=q1.tableSettings)===null||p1===void 0?void 0:p1.selectionMode;if(r1&&r1===S.None){if(O(n,o).isDeletable){return"{= ${ui>/editMode} === 'Editable' ? '"+S.Multi+"' : 'None'}";}else{r1=S.None;}}else if(!r1||r1===S.Auto){r1=S.Multi;}if(N(i)){return r1;}else if(O(n,o).isDeletable){if(!o1){return"{= ${ui>/editMode} === 'Editable' ? '"+r1+"' : 'None'}";}else{return r1;}}return S.None;}function R(i,n,o){var o1=[];if(i){var p1=o.getAbsoluteAnnotationPath(n);i.forEach(function(q1,r1){var s1,t1;var u1;if(k(q1)&&!(((s1=q1.annotations)===null||s1===void 0?void 0:(t1=s1.UI)===null||t1===void 0?void 0:t1.Hidden)===true)&&!q1.Inline&&!q1.Determining){var v1=p1+"/"+r1;switch(q1.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":u1={type:s.DataFieldForAction,annotationPath:v1,key:"DataFieldForAction::"+q1.Action.replace(/\//g,"::"),isNavigable:true};break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":u1={type:s.DataFieldForIntentBasedNavigation,annotationPath:v1,key:"DataFieldForIntentBasedNavigation::"+q1.SemanticObject+"::"+q1.Action+(q1.RequiresContext?"::RequiresContext":"")};break;}}if(u1){o1.push(u1);}});}return o1;}function U(i){var n;switch(i){case"UI.CriticalityType/Negative":n=E.Error;break;case"UI.CriticalityType/Critical":n=E.Warning;break;case"UI.CriticalityType/Positive":n=E.Success;break;case"UI.CriticalityType/Neutral":default:n=E.None;}return n;}function W(i,n){var o=E.None;if(i){if(typeof i==="object"){o=h(i);}else{o=U(i);}}return d(n&&c.IsNewObject,E.Information,f([o],t.rowHighlighting));}function X(i,n,o,o1){var p1=(o1===null||o1===void 0?void 0:o1.create)||(o1===null||o1===void 0?void 0:o1.detail);if((p1===null||p1===void 0?void 0:p1.outbound)&&p1.outboundDetail&&(o1===null||o1===void 0?void 0:o1.create)){return{mode:"External",outbound:p1.outbound,outboundDetail:p1.outboundDetail,navigationSettings:o1};}var q1;if(i){var r1,s1,t1,u1,v1;var w1=o.getAnnotationEntityType(i);var x1=(r1=o.getEntitySetForEntityType(w1))===null||r1===void 0?void 0:r1.annotations;q1=(x1===null||x1===void 0?void 0:(s1=x1.Common)===null||s1===void 0?void 0:(t1=s1.DraftRoot)===null||t1===void 0?void 0:t1.NewAction)||(x1===null||x1===void 0?void 0:(u1=x1.Session)===null||u1===void 0?void 0:(v1=u1.StickySessionSupported)===null||v1===void 0?void 0:v1.NewAction);if(n.creationMode===r.CreationRow&&q1){throw Error("Creation mode '".concat(r.CreationRow,"' can not be used with a custom 'new' action (").concat(q1,")"));}if(p1===null||p1===void 0?void 0:p1.route){return{mode:n.creationMode,append:n.createAtEnd,newAction:q1,navigateToTarget:n.creationMode===r.NewPage?p1.route:undefined};}}if(n.creationMode===r.NewPage){n.creationMode=r.Inline;}return{mode:n.creationMode,append:n.createAtEnd,newAction:q1};}var Y=function(i,n,o,o1,p1){var q1,r1;var s1=E.None;var t1=o.getAnnotationEntityType(i);if(o1&&i){var u1,v1,w1;r1=((u1=o1.display)===null||u1===void 0?void 0:u1.target)||((v1=o1.detail)===null||v1===void 0?void 0:v1.outbound);if(r1){q1=".handlers.onChevronPressNavigateOutBound( $controller ,'"+r1+"', ${$parameters>bindingContext})";}else if(r1=(w1=o1.detail)===null||w1===void 0?void 0:w1.route){if(t1){var x1=o.getEntitySetForEntityType(t1);if(x1){var y1,z1,A1,B1,C1,D1;var E1=x1.annotations;s1=W((y1=i.annotations)===null||y1===void 0?void 0:(z1=y1.UI)===null||z1===void 0?void 0:z1.Criticality,!!((A1=E1.Common)===null||A1===void 0?void 0:A1.DraftRoot)||!!((B1=E1.Common)===null||B1===void 0?void 0:B1.DraftNode));q1=".routing.navigateForwardToContext(${$parameters>bindingContext}, { targetPath: '"+p1+"', editable : "+((E1===null||E1===void 0?void 0:(C1=E1.Common)===null||C1===void 0?void 0:C1.DraftRoot)||(E1===null||E1===void 0?void 0:(D1=E1.Common)===null||D1===void 0?void 0:D1.DraftNode)?"!${$parameters>bindingContext}.getProperty('IsActiveEntity')":"undefined")+"})";}}}}var F1=d(o.getManifestWrapper().isFclEnabled(),f([g("/deepestPath","fclnavigated")],t.fclNavigatedRow,t1),false);return{press:q1,action:q1?"Navigation":undefined,rowHighlighting:e(s1),rowNavigated:e(F1)};};var Z=function(i){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var o=arguments.length>2?arguments[2]:undefined;var o1=[];i.entityProperties.forEach(function(p1){var q1=n.some(function(u1){return u1.name===p1.name;});if(!q1){var r1,s1;var t1=(o.getEntitySetForEntityType(i)||i).name;o1.push({key:"DataField::"+p1.name,type:F.Annotation,annotationPath:"/"+t1+"/"+p1.name,personalizationOnly:true,name:p1.name,visible:o.getInverseBindingExpression((r1=p1.annotations)===null||r1===void 0?void 0:(s1=r1.UI)===null||s1===void 0?void 0:s1.Hidden,true),template:"sap.fe.macros.table.ColumnProperty"});}});return o1;};var $=function(i){switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":return!!i.Inline;case"com.sap.vocabularies.UI.v1.DataFieldWithAction":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":return false;case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":return true;default:}};var a1=function(i){var n,o,o1;if(j(i)){var p1;return(p1=i.Value)===null||p1===void 0?void 0:p1.path;}else if(i.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&((n=i.Target)===null||n===void 0?void 0:(o=n.$target)===null||o===void 0?void 0:(o1=o.Value)===null||o1===void 0?void 0:o1.path)){return i.Target.$target.Value.path;}else{return b.generateKeyFromDataField(i);}};var b1=function(i,n,o){var o1=o.getAnnotationEntityType(i);var p1=[];if(i){i.forEach(function(r1,s1){var t1,u1,v1,w1,x1;if(!$(r1)){return;}var y1=o.getAbsoluteAnnotationPath(n)+"/"+s1;p1.push({annotationPath:y1,type:F.Annotation,key:b.generateKeyFromDataField(r1),width:((t1=r1.annotations)===null||t1===void 0?void 0:(u1=t1.HTML5)===null||u1===void 0?void 0:(v1=u1.CssDefaults)===null||v1===void 0?void 0:v1.width)||undefined,personalizationOnly:false,name:a1(r1),visible:o.getInverseBindingExpression((w1=r1.annotations)===null||w1===void 0?void 0:(x1=w1.UI)===null||x1===void 0?void 0:x1.Hidden,true),isNavigable:true});});}var q1=Z(o1,p1,o);q1=q1.concat(p1);return q1;};var c1=function(i,n){var o={};for(var o1 in i){var p1;var q1=i[o1];b.isKeyValid(o1);o[o1]={key:o1,id:"CustomColumn::"+o1,name:"CustomColumn::"+o1,header:q1.header,width:q1.width||undefined,type:F.Default,personalizationOnly:false,template:q1.template||"undefined",visible:true,position:{anchor:(p1=q1.position)===null||p1===void 0?void 0:p1.anchor,placement:q1.position===undefined?P.After:q1.position.placement},isNavigable:p(q1,n,true)};}return o;};function d1(i,n){var o;var o1=n.getManifestWrapper();var p1=n.getManifestControlConfiguration(i);var q1=["Page","Control"].indexOf(o1.getVariantManagement())>-1;var r1=true;var s1=[];if((p1===null||p1===void 0?void 0:(o=p1.tableSettings)===null||o===void 0?void 0:o.personalization)!==undefined){r1=p1.tableSettings.personalization;}var t1=n.getTemplateConverterType()==="ObjectPage";if(q1&&r1){if(r1===true){return t1?"Sort,Column,Filter":"Sort,Column";}else if(typeof r1==="object"){if(r1.column){s1.push("Column");}if(r1.sort){s1.push("Sort");}if(r1.filter&&t1){s1.push("Filter");}return s1.join(",");}}return undefined;}_.getP13nMode=d1;function e1(i,n){var o=false;if(n){var o1,p1,q1;var r1=(o1=i.navigationPropertyBinding[n])===null||o1===void 0?void 0:(p1=o1.annotations)===null||p1===void 0?void 0:(q1=p1.UI)===null||q1===void 0?void 0:q1.DeleteHidden;if(r1&&r1.path){if(r1.path.indexOf("/")>0){var s1=r1.path.split("/");var t1=s1[0];var u1=i.entityType.navigationProperties.find(function(x1){return x1.name===n;}).partner;if(u1===t1){o=r1;}}else{o=false;}}else{o=r1;}}else{var v1,w1;o=(v1=i.annotations)===null||v1===void 0?void 0:(w1=v1.UI)===null||w1===void 0?void 0:w1.DeleteHidden;}return o;}function f1(i,n,o,o1,p1){var q1=n.getEntitySet();var r1=e1(q1,o);if(r1===true||p1===false||o1==="AnalyticalListPage"){return false;}else if(!i){if(r1){return"{= !${"+(o?o+"/":"")+r1.path+"} && ${ui>/editMode} === 'Editable'}";}else{return"{= ${ui>/editMode} === 'Editable'}";}}else{return true;}}_.getDeleteVisible=f1;function g1(i,n){var o,o1,p1;var q1=true;var r1=false;var s1=i===null||i===void 0?void 0:(o=i.annotations)===null||o===void 0?void 0:(o1=o.Capabilities)===null||o1===void 0?void 0:(p1=o1.NavigationRestrictions)===null||p1===void 0?void 0:p1.RestrictedProperties;if(n&&s1){var t1=s1.find(function(t1){var C1,D1;return(t1===null||t1===void 0?void 0:(C1=t1.NavigationProperty)===null||C1===void 0?void 0:C1.type)==="NavigationPropertyPath"&&(t1===null||t1===void 0?void 0:(D1=t1.NavigationProperty)===null||D1===void 0?void 0:D1.value)===n&&(t1===null||t1===void 0?void 0:t1.InsertRestrictions);});if(t1){var u1;q1=(t1===null||t1===void 0?void 0:(u1=t1.InsertRestrictions)===null||u1===void 0?void 0:u1.Insertable)!==false;r1=true;}}if(n&&!r1){var v1,w1,x1,y1;q1=(i===null||i===void 0?void 0:(v1=i.navigationPropertyBinding[n])===null||v1===void 0?void 0:(w1=v1.annotations)===null||w1===void 0?void 0:(x1=w1.Capabilities)===null||x1===void 0?void 0:(y1=x1.InsertRestrictions)===null||y1===void 0?void 0:y1.Insertable)!==false;}else if(!n){var z1,A1,B1;q1=(i===null||i===void 0?void 0:(z1=i.annotations)===null||z1===void 0?void 0:(A1=z1.Capabilities)===null||A1===void 0?void 0:(B1=A1.InsertRestrictions)===null||B1===void 0?void 0:B1.Insertable)!==false;}return q1;}function h1(i,n){var o=false;if(n){var o1,p1,q1;var r1=(o1=i.navigationPropertyBinding[n])===null||o1===void 0?void 0:(p1=o1.annotations)===null||p1===void 0?void 0:(q1=p1.UI)===null||q1===void 0?void 0:q1.CreateHidden;if(r1&&r1.path){if(r1.path.indexOf("/")>0){var s1=r1.path.split("/");var t1=s1[0];var u1=i.entityType.navigationProperties.find(function(x1){return x1.name===n;}).partner;if(u1===t1){o=r1;}}else{o=false;}}else{o=r1;}}else{var v1,w1;o=(v1=i.annotations)===null||v1===void 0?void 0:(w1=v1.UI)===null||w1===void 0?void 0:w1.CreateHidden;}return o;}function i1(i,n,o,o1){var p1=n.getEntitySet();var q1=h1(p1,o);var r1=g1(p1,o);if(q1===true||r1===false||o1==="AnalyticalListPage"){return false;}else if(!i){if(q1){return"{= !${"+(o?o+"/":"")+q1.path+"} && ${ui>/editMode} === 'Editable'}";}else{return"{= ${ui>/editMode} === 'Editable'}";}}else{return true;}}_.getCreateVisible=i1;function j1(i,n,o,o1,p1){var q1=l1(n),r1=q1.navigationPropertyPath;var s1=o.getEntitySet();var t1=o.getManifestWrapper();var u1=s1.name,v1=r1.length===0,w1=d1(n,o),id=T(v1?u1:r1,"LineItem");var y1=Q(i,n,o,v1);var z1=o.getTemplateConverterType();var A1=z1==="AnalyticalListPage";var B1=z1==="ListReport";var C1=O(n,o);var D1=C1.isDeletable;var E1=v1?30:10;if(p1&&p1.MaxItems){E1=p1.MaxItems;}var F1=v1?u1:r1;var G1=t1.getNavigationConfiguration(F1);return{id:id,entityName:u1,collection:"/"+u1+(!v1?"/"+r1:""),navigationPath:r1,isEntitySet:v1,row:Y(i,n,o,G1,F1),p13nMode:w1,show:{"delete":f1(B1,o,r1,z1,D1),create:i1(B1,o,r1,z1),update:k1(z1)},create:X(i,o1,o,G1),selectionMode:y1,autoBindOnInit:!B1&&!A1,enableControlVM:t1.getVariantManagement()==="Control"&&!!w1,threshold:E1};}_.getTableAnnotationConfiguration=j1;function k1(i){if(i==="AnalyticalListPage"||i==="ListReport"){return"Display";}return"{ui>/editMode}";}function l1(i){var n=i.split("@"),o=u(n,2),o1=o[0],p1=o[1];if(o1.lastIndexOf("/")===o1.length-1){o1=o1.substr(0,o1.length-1);}return{navigationPropertyPath:o1,annotationPath:p1};}function m1(i,n){var o=n.getEntityTypeAnnotation(i);if(o){var o1;var p1=[];(o1=o.SelectOptions)===null||o1===void 0?void 0:o1.forEach(function(q1){var r1=q1.PropertyName;var s1=r1.value;if(p1.indexOf(s1)===-1){p1.push(s1);}});return{text:o.Text,propertyNames:p1};}return undefined;}_.getSelectionVariantConfiguration=m1;function n1(i,n,o){var o1=o.getManifestControlConfiguration(n);var p1=o1.tableSettings;var q1;var r1=[];var s1=true;var t1=r.NewPage;var u1;var v1=false;var w1=true;var x1=false;var y1=false;var z1="ResponsiveTable";if(p1&&i){var A1,B1,C1,D1,E1,F1,G1;var H1=o.getAnnotationEntityType(i);p1===null||p1===void 0?void 0:(A1=p1.quickVariantSelection)===null||A1===void 0?void 0:(B1=A1.paths)===null||B1===void 0?void 0:B1.forEach(function(I1){var J1;q1=H1.resolvePath("@"+I1.annotationPath);if(q1){r1.push({annotationPath:I1.annotationPath});}u1={quickFilters:{showCounts:p1===null||p1===void 0?void 0:(J1=p1.quickVariantSelection)===null||J1===void 0?void 0:J1.showCounts,paths:r1}};});s1=p1.enableExport!==undefined?p1.enableExport:true;t1=((C1=p1.creationMode)===null||C1===void 0?void 0:C1.name)||t1;v1=p1.enableAutoScroll;w1=((D1=p1.creationMode)===null||D1===void 0?void 0:D1.createAtEnd)!==undefined?(E1=p1.creationMode)===null||E1===void 0?void 0:E1.createAtEnd:true;x1=!!((F1=p1.creationMode)===null||F1===void 0?void 0:F1.disableAddRowButtonForEmptyData);y1=!!((G1=p1.quickVariantSelection)===null||G1===void 0?void 0:G1.hideTableTitle);z1=p1.type;}return{enableAutoScroll:v1,filters:u1,type:z1,headerVisible:!(q1&&y1),enableExport:s1,creationMode:t1,createAtEnd:w1,disableAddRowButtonForEmptyData:x1};}_.getTableManifestConfiguration=n1;return _;},false);
