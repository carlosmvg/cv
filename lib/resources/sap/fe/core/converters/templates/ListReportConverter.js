sap.ui.define(["../ManifestSettings","../controls/Common/DataVisualization","../helpers/ID","sap/fe/core/converters/controls/Common/Table","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject"],function(M,D,I,T,A,C){"use strict";var _={};var a=C.insertCustomElements;var g=A.getActionsFromManifest;var b=T.getSelectionVariantConfiguration;var c=I.TableID;var F=I.FilterVariantManagementID;var d=I.FilterBarID;var e=D.getDefaultPresentationVariant;var f=D.getDefaultChart;var h=D.getDefaultLineItem;var j=D.isPresentationALPCompliant;var k=D.isPresentationCompliant;var l=D.getDataVisualizationConfiguration;var V=M.VisualizationType;function o(i,w){var x=Object.keys(i);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(i);if(w)y=y.filter(function(z){return Object.getOwnPropertyDescriptor(i,z).enumerable;});x.push.apply(x,y);}return x;}function m(w){for(var i=1;i<arguments.length;i++){var x=arguments[i]!=null?arguments[i]:{};if(i%2){o(Object(x),true).forEach(function(y){n(w,y,x[y]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(w,Object.getOwnPropertyDescriptors(x));}else{o(Object(x)).forEach(function(y){Object.defineProperty(w,y,Object.getOwnPropertyDescriptor(x,y));});}}return w;}function n(i,w,x){if(w in i){Object.defineProperty(i,w,{value:x,enumerable:true,configurable:true,writable:true});}else{i[w]=x;}return i;}var p=function(i,w,x){var y,z,B;var E=[];var S={};w.forEach(function(G){G.propertyNames.forEach(function(H){if(!S[H]){S[H]=true;}});});(y=i.annotations)===null||y===void 0?void 0:(z=y.UI)===null||z===void 0?void 0:(B=z.SelectionFields)===null||B===void 0?void 0:B.forEach(function(G){var H=G.value;if(!S[H]){E.push({readablePath:H,templatingPath:x.getEntitySetBasedAnnotationPath(G.fullyQualifiedName+"/$PropertyPath")});}});return E;};_.getSelectionFields=p;function q(i){var w=e(i);if(w){if(k(w)){return w;}}var x=h(i);if(x){return x;}return undefined;}var r=function(i,w,x){var y=l({annotation:i.annotation,path:i.annotation?x.getRelativeAnnotationPath(i.annotation.fullyQualifiedName,w):""},x);var z="";var B="";var E="";var G="";var H=function(J){return J.key!==undefined;};var J=i;if(H(J)){var K=x.getEntityTypeAnnotation(J.annotationPath);E=x.getBindingExpression(K.Text)||"";y.visualizations.forEach(function(L,N){switch(L.type){case V.Table:var O=y.visualizations[N];var P=O.control.filters||{};P.hiddenFilters=P.hiddenFilters||{paths:[]};if(!J.keepPreviousPresonalization){O.annotation.id=c(J.key,"LineItem");}if(i&&i.annotation&&i.annotation.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){G=i.annotation.SelectionVariant.fullyQualifiedName.split("@")[1];}else{G=J.annotationPath;}P.hiddenFilters.paths.push({annotationPath:G});O.control.filters=P;break;case V.Chart:break;default:break;}});}y.visualizations.forEach(function(L){if(L.type===V.Table){z=L.annotation.id;}else if(L.type===V.Chart){B=L.id;}});return{presentation:y,tableControlId:z,chartControlId:B,title:E,selectionVariantPath:G};};var s=function(i,w,x){var y=[];if(x){x.paths.forEach(function(z,B){var E=w.getEntityTypeAnnotation(z.annotationPath);if(E){var G=E.term==="com.sap.vocabularies.UI.v1.SelectionVariant"?h(i):E;y.push(m({annotation:G},x.paths[B]));}});}else{if(w.getTemplateConverterType()==="AnalyticalListPage"){y=t(i,y);}else{y.push({annotation:q(i)});}}return y.map(function(z){return r(z,i,w);});};function t(i,w){var x=e(i);var y=x&&j(x);if(!y){var z=f(i);var B=h(i);if(z){w.push({annotation:z});}if(B){w.push({annotation:B});}}else{w.push({annotation:x});}return w;}var u=function(i,w){var x=i.entityType;var y=w.getTemplateConverterType();var z=w.getManifestWrapper();var B=z.getViewConfiguration();var E=s(x,w,B);var G=B===null||B===void 0?void 0:B.showCounts;var H="";var J="";var K=false;var L=[];var N=[];var O=d(i.name);var P=F(O);var Q=[O];E.forEach(function(W){W.presentation.visualizations.forEach(function(X){if(X.type===V.Table){var Y=X.control.filters;for(var Z in Y){if(Array.isArray(Y[Z].paths)){var $=Y[Z].paths;$.forEach(function(a1){if(a1&&a1.annotationPath&&N.indexOf(a1.annotationPath)===-1){N.push(a1.annotationPath);var b1=b(a1.annotationPath,w);if(b1){L.push(b1);}}});}}Q.push(X.annotation.id);if(X.control.type==="GridTable"){K=y==="AnalyticalListPage";}}});});var R=v(y,E);if(R){J=R.chartId;H=R.tableId;}var S=p(x,L,w);var U=a([],g(z.getHeaderActions()));return{singleTableId:H,singleChartId:J,showTabCounts:G,headerActions:U,selectionFields:S,views:E,filterBarId:O,variantManagement:{id:P,targetControlIds:Q.join(",")},fitContent:K,isAlp:w.getTemplateConverterType()==="AnalyticalListPage"};};_.convertPage=u;function v(i,w){var x="",y="";if(w.length===1){x=w[0].tableControlId;y=w[0].chartControlId;}else if(i==="AnalyticalListPage"&&w.length===2){w.map(function(z){if(z.chartControlId){y=z.chartControlId;}else if(z.tableControlId){x=z.tableControlId;}});}if(x||y){return{chartId:y,tableId:x};}return undefined;}return _;},false);
