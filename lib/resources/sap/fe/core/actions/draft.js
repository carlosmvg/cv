/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/m/Dialog","sap/m/Button","sap/m/Text","sap/m/MessageBox","sap/fe/core/actions/messageHandling","sap/fe/core/CommonUtils"],function(D,B,T,M,m,C){"use strict";function c(o,p){var P=p||{},l=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core"),r=typeof P.bPreserveChanges==="undefined"||(typeof P.bPreserveChanges==="boolean"&&P.bPreserveChanges);function e(O){if(O){var f=o.getModel(),R,g=f.bindContext(o.getPath()+"/DraftAdministrativeData").getBoundContext();return p.oView.getModel("sap.fe.i18n").getResourceBundle().then(function(_){R=_;return g.requestObject();}).then(function(h){if(h){m.removeUnboundTransitionMessages();var i=h.InProcessByUserDescription||h.InProcessByUser;var E=p.oView.getViewData().entitySet;if(i){var L=C.getTranslatedText("C_DRAFT_OBJECT_PAGE_DRAFT_LOCKED_BY_USER",R,i,E);M.error(L);throw new Error(L);}else{i=h.CreatedByUserDescription||h.CreatedByUser;var u=C.getTranslatedText("C_DRAFT_OBJECT_PAGE_DRAFT_UNSAVED_CHANGES",R,i,E);return s(u).then(function(){return o.executeDraftEditAction(false);});}}});}return Promise.reject(new Error("Draft creation aborted for document: "+o.getPath()));}function s(u){return new Promise(function(f,g){var h=new D({title:l.getText("C_DRAFT_OBJECT_PAGE_WARNING"),state:"Warning",content:new T({text:u}),beginButton:new B({text:l.getText("C_COMMON_OBJECT_PAGE_EDIT"),type:"Emphasized",press:function(){h.close();f(true);}}),endButton:new B({text:l.getText("C_COMMON_OBJECT_PAGE_CANCEL"),press:function(){h.close();g("Draft creation aborted for document: "+o.getPath());}}),afterClose:function(){h.destroy();}});h.addStyleClass("sapUiContentPadding");h.open();});}if(!o){return Promise.reject(new Error("Binding context to active document is required"));}if(!o.executeDraftEditAction){return Promise.reject(new Error("Draft is not supported by document: "+o.getPath()));}return Promise.resolve(P.fnBeforeCreateDraftFromActiveDocument?P.fnBeforeCreateDraftFromActiveDocument(o,r):true).then(function(E){if(!E){throw new Error("Draft creation was aborted by extension for document: "+o.getPath());}return o.executeDraftEditAction(r).catch(function(R){if(r&&R.status===409){return Promise.resolve(P.fnWhenDecisionToOverwriteDocumentIsRequired?P.fnWhenDecisionToOverwriteDocumentIsRequired():true).then(e);}else{throw new Error(R);}});}).then(function(f){return Promise.resolve(P.fnAfterCreateDraftFromActiveDocument?P.fnAfterCreateDraftFromActiveDocument(o,f):f);}).then(function(f){if(P.bPrepareOnEdit&&f.executeDraftPreparationAction){return f.executeDraftPreparationAction().then(function(){var g=f.getPath()||"",E=g&&g.split("(")[0],h=f.getModel(),i=h&&h.getMetaModel(),j=i.getObject(E+"/@com.sap.vocabularies.Common.v1.Messages/$Path");if(j){return f.requestSideEffects([{$PropertyPath:j}]).then(function(){return f;});}return f;});}return f;}).catch(function(f){return Promise.reject(f);});}function a(o,p){var P=p||{};if(!o){return Promise.reject(new Error("Binding context to draft document is required"));}if(!o.executeDraftActivationAction){return Promise.reject(new Error("Activation action is not supported for document : "+o.getPath()));}return Promise.resolve(P.fnBeforeActivateDocument?P.fnBeforeActivateDocument(o):true).then(function(e){if(!e){return Promise.reject(new Error("Activation of the document was aborted by extension for document: "+o.getPath()));}if(!o.executeDraftPreparationAction){return o.executeDraftActivationAction();}var s="draft";var f=o.executeDraftPreparationAction("",s);o.getModel().submitBatch(s);var A=o.executeDraftActivationAction(s);return Promise.all([f,A]).then(function(v){return v[1];}).catch(function(g){return Promise.reject(g);});}).then(function(A){return Promise.resolve(P.fnAfterActivateDocument?P.fnAfterActivateDocument(o,A):A);}).catch(function(e){return Promise.reject(e);});}function d(o){var e=o.getModel(),f=e.getMetaModel(),s=f.getMetaPath(o.getPath()),g=f.getObject(s+"@com.sap.vocabularies.Common.v1.DraftRoot/DiscardAction"),i=o.getObject().IsActiveEntity;if(i||(!i&&!g)){return o.delete();}else{return o.executeDraftDiscardAction();}}var b={createDraftFromActiveDocument:c,activateDocument:a,deleteDraft:d};return b;});
