/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2020 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/UIComponent","sap/fe/core/CommonUtils","sap/base/Log"],function(U,C,L){"use strict";var T=U.extend("sap.fe.core.TemplateComponent",{metadata:{properties:{entitySet:{type:"string",defaultValue:null},bindingContextPattern:{type:"string"},navigation:{type:"object"},enhanceI18n:{type:"string[]"},controlConfiguration:{type:"object"},content:{type:"object"},allowDeepLinking:{type:"boolean"}},events:{"pageReady":{element:{type:"sap.ui.base.ManagedObject"}}},library:"sap.fe.core"},setContainer:function(c){U.prototype.setContainer.apply(this,arguments);if(c){var t=this;c.addEventDelegate({onBeforeShow:function(){t.bShown=false;t.bIsBackNav=false;t._bIsPageReady=false;},onBeforeHide:function(){t.bShown=false;t.bIsBackNav=false;t._bIsPageReady=false;},onAfterShow:function(e){t.bShown=true;t.bIsBackNav=e.isBack||e.isBackToPage;t._checkPageReady(true);}});}},_checkPageReady:function(f){var t=this;var u=function(){if(!sap.ui.getCore().getUIDirty()){sap.ui.getCore().detachEvent("UIUpdated",u);t._bWaitingForRefresh=false;setTimeout(function(){t._checkPageReady();},20);}};if(this.bShown&&this.bDataReceived!==false&&this.bTablesLoaded!==false){if(this.bDataReceived===true&&!f&&!this._bWaitingForRefresh&&sap.ui.getCore().getUIDirty()){this.bDataReceived=undefined;this._bWaitingForRefresh=true;sap.ui.getCore().attachEvent("UIUpdated",u);}else if(!this._bWaitingForRefresh&&sap.ui.getCore().getUIDirty()){this._bWaitingForRefresh=true;sap.ui.getCore().attachEvent("UIUpdated",u);}else if(!this._bWaitingForRefresh){t.firePageReady();}}},init:function(){this.oAppComponent=C.getAppComponent(this);U.prototype.init.apply(this,arguments);},onServicesStarted:function(){var t=this;this.attachPageReady(function(){t._bIsPageReady=true;});var o=this.getTemplatedViewService();var v=o.getView();var b=[];var r=0;var R=0;var f=function(e){e.getSource().detachDataRequested(f);r++;t.bDataReceived=false;};var a=function(e){e.getSource().detachDataReceived(a);R++;if(R===r&&r!==0){r=0;R=0;t.bDataReceived=true;t._checkPageReady(false);}};v.getParent().attachModelContextChange(function(e){t._bIsPageReady=false;b.forEach(function(E){E.detachDataRequested(f);E.detachDataReceived(a);});b=[];e.getSource().findAggregatedObjects(true,function(E){var O=E.getObjectBinding();if(O){O.attachDataRequested(f);O.attachDataReceived(a);b.push(O);}else{var B=Object.keys(E.mBindingInfos);if(B.length>0){B.forEach(function(p){var l=E.mBindingInfos[p].binding;if(l&&l.isA("sap.ui.model.odata.v4.ODataListBinding")){l.attachDataRequested(f);l.attachDataReceived(a);b.push(l);}});}}if(E.isA("sap.ui.mdc.Table")){t.bTablesLoaded=false;E.initialized().then(function(){var c=E.getRowBinding();if(c){c.attachDataRequested(f);c.attachDataReceived(a);b.push(c);}setTimeout(function(){t.bTablesLoaded=true;t._checkPageReady(false);},0);}).catch(function(c){L.error("Cannot find a bound table",c);});}});setTimeout(function(){t._checkPageReady(false);},0);});t._checkPageReady(false);},onBeforeBinding:function(c,p){return true;},onAfterBinding:function(c){return true;},isPageReady:function(){return this._bIsPageReady;},onPageReady:function(l){if(this.getRootControl()&&this.getRootControl().getController()&&this.getRootControl().getController().onPageReady){this.getRootControl().getController().onPageReady(l);}},getNavigationConfiguration:function(t){var n=this.getNavigation();return n[t];},getViewData:function(){var p=this.getMetadata().getAllProperties();var v=Object.keys(p).reduce(function(V,P){V[P]=p[P].get(this);return V;}.bind(this),{});v.fclEnabled=this.oAppComponent._isFclEnabled();return v;},_getPageTitleInformation:function(){if(this.getRootControl()&&this.getRootControl().getController()&&this.getRootControl().getController()._getPageTitleInformation){return this.getRootControl().getController()._getPageTitleInformation();}},getExtensionAPI:function(){return this.getRootControl().getController().getExtensionAPI();}});return T;},true);
