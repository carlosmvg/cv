/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/mdc/TableDelegate","sap/ui/mdc/FilterBarDelegate","sap/ui/core/XMLTemplateProcessor","sap/ui/core/util/XMLPreprocessor","sap/ui/core/Fragment","sap/ui/core/Element","sap/ui/model/json/JSONModel","sap/fe/macros/CommonHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/field/FieldHelper","sap/base/util/ObjectPath","sap/ui/mdc/odata/v4/FieldBaseDelegate","sap/ui/model/odata/type/String","sap/fe/macros/ResourceModel","sap/base/util/merge"],function(T,F,X,a,b,C,J,c,S,d,O,e,f,R,m){"use strict";var D={},N="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1",g={"Edm.Boolean":{modelType:"Bool"},"Edm.Byte":{modelType:"Int"},"Edm.Date":{modelType:"Date"},"Edm.DateTime":{modelType:"Date"},"Edm.DateTimeOffset":{modelType:"DateTimeOffset"},"Edm.Decimal":{modelType:"Decimal"},"Edm.Double":{modelType:"Float"},"Edm.Float":{modelType:"Float"},"Edm.Guid":{modelType:"Guid"},"Edm.Int16":{modelType:"Int"},"Edm.Int32":{modelType:"Int"},"Edm.Int64":{modelType:"Int"},"Edm.SByte":{modelType:"Int"},"Edm.Single":{modelType:"Float"},"Edm.String":{modelType:"String"},"Edm.Time":{modelType:"TimeOfDay"},"Edm.TimeOfDay":{modelType:"TimeOfDay"},"Edm.Stream":{}};function _(){this.control.detachModelContextChange(_,this);var M=this.modelName,o=this.control.getModel(M);if(o){this.resolve(o);}else{this.control.attachModelContextChange(_,this);}}D._catchTranslationModel=function(M,o){if(/{[A-Za-z0-9@]+>/.exec(M)){var h=/{([A-Za-z0-9@]+)>([A-Za-z0-9]+)}/.exec(M);var r=o.getModel(h[1]).getResourceBundle();return r.getText(h[2]);}else{return M;}};D.getCustomData=function(o,p,M){if(M){var h=M.getAggregation(o,"customData").filter(function(i){return M.getProperty(i,"key")===p;});if(h.length===1){return M.getProperty(h[0],"value");}return undefined;}else{if(o&&p){if(o instanceof window.Element){return o.getAttributeNS(N,p);}if(o.data instanceof Function){return o.data(p);}}return undefined;}};D.setCustomData=function(o,p,v){if(o&&p){if(o instanceof window.Element){return o.setAttributeNS(N,"customData:"+p,v);}if(o.data instanceof Function){return o.data(p,v);}}};D.fetchPropertiesForEntity=function(E,M){return M.requestObject(E+"/");};D.fetchAnnotationsForEntity=function(E,M){return M.requestObject(E+"@");};D.fetchModel=function(o){return new Promise(function(r,h){var M=o.getDelegate().payload&&o.getDelegate().payload.modelName,i={modelName:M,control:o,resolve:r};_.call(i);});};D.loadMacroLibrary=function(){return new Promise(function(r,h){sap.ui.require(["sap/fe/macros/macroLibrary"],function(){r();});});};D.templateControlFragment=function(s,p,o,i,I){return this.loadMacroLibrary().then(function(){return a.process(X.loadTemplate(s,"fragment"),{name:s},p);}).then(function(h){var j=h.firstElementChild;if(i&&j){return j;}return b.load({id:I,definition:h,controller:o});});};D.doesValueHelpExist=function(p){var P=p.sPropertyName||"",v=p.sValueHelpType||"",M=p.oMetaModel,o=p.oModifier,s=p.sBindingPath+"/"+P,h=M.createBindingContext(s),V=d.valueHelpProperty(h),G=S.generate([o?S.generate([o.getId(p.oControl),v]):S.generate([p.oControl.getId(),v]),P]);if(V.indexOf("$Path")>-1){V=M.getObject(V);}if(s!==V){G=S.generate([G,V]);}var i=o?o.getAggregation(p.oControl,"dependents"):p.oControl.getAggregation("dependents");return Promise.resolve(i&&i.some(function(j){return o?o.getId(j)===G:j.getId()===G;}));};D.isValueHelpRequired=function(p,i){var P=p.sPropertyName||"",M=p.oMetaModel,s=p.sBindingPath+"/"+P,o=M.createBindingContext(s),v=d.valueHelpProperty(o,i);return Promise.all([M.requestObject(v+"@com.sap.vocabularies.Common.v1.ValueListReferences"),M.requestObject(v+"@com.sap.vocabularies.Common.v1.ValueListMapping"),M.requestObject(v+"@com.sap.vocabularies.Common.v1.ValueList")]).then(function(r){return r[0]||r[1]||r[2];});};D.isTypeFilterable=function(t){return t&&t in g&&!!g[t].modelType;};D.getModelType=function(t){return t&&t in g&&g[t].modelType;};return D;});
