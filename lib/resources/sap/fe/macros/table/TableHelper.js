/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/fe/macros/CommonHelper","sap/fe/core/library","sap/fe/core/helpers/StableIdHelper","sap/fe/core/AnnotationHelper","sap/ui/model/odata/v4/AnnotationHelper","sap/fe/core/converters/ConverterContext","sap/fe/macros/SizeHelper","sap/fe/core/CommonUtils"],function(J,C,F,S,A,O,a,b,c){"use strict";var d=F.CreationMode;var T={_isStaticAction:function(o,s){if(s&&s.indexOf("(")>-1){return true;}if(o){var e=Array.isArray(o)?o[0]:o;if(e.$IsBound&&e.$Parameter[0].$isCollection){return true;}}},isPasteEnabled:function(t,s,o,e,p,f,g){var h=s==="CreationRow";if(!this.createButtonTemplating(t,h)){return g?false:undefined;}else{var r=h?A.getNavigationInsertableRestrictions(o,e,p,f,false):this.isCreateButtonEnabled(o,e,p,f);if(t.showCreate!=="{= ${ui>/editMode} === 'Editable'}"){var i=t.showCreate.substr(3,t.showCreate.length-1);i=i.replace(" && ${ui>/editMode} === 'Editable'","");return r!==false||g?r.substr(0,r.length-1)+" && "+i:undefined;}return r!==false||g?r:undefined;}},createButtonTemplating:function(t,e){var o=t.collection,f=t.create.getObject(),n,N,s=t.navigationPath,g=C.getTargetCollection(t.collection,t.navigationPath),r=t.parentEntitySet.getObject(t.parentEntitySet.getPath()+"@Org.OData.Capabilities.V1.NavigationRestrictions/RestrictedProperties");for(var i in r){n=r[i];if(n.NavigationProperty.$NavigationPropertyPath===s&&n.InsertRestrictions&&n.InsertRestrictions.Insertable){N=n.InsertRestrictions.Insertable;}}if(t.showCreate==="false"){return false;}if(!t.onCreate||(f.mode===d.CreationRow&&e===false)){return false;}else if(o.getObject(g+"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction")){return(o.getObject(g+"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction@Org.OData.Core.V1.OperationAvailable")!==false);}else if(o.getObject(g+"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction")){return(o.getObject(g+"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction@Org.OData.Core.V1.OperationAvailable")!==false);}else if(N===false){return false;}else if(N){return true;}else if(t.creationMode===d.External){return true;}return(o.getObject(g+"@Org.OData.Capabilities.V1.InsertRestrictions/Insertable")!==false);},deleteButtonTemplating:function(t){if(t.selectedContextsModel&&t.id&&t.onDelete){if(t.showDelete!==undefined&&t.showDelete!==null){return t.showDelete;}else{return true;}}return false;},addPresentationVariantToSelectQuery:function(p,P){var r=[];if(!(p&&C._isPresentationVariantAnnotation(P)&&p.RequestAtLeast&&p.RequestAtLeast.length>0)){return"";}p.RequestAtLeast.forEach(function(R){r.push(R.$PropertyPath);});return r.join(",");},addOperationAvailableFieldsToSelectQuery:function(l,o){var s=[],e="";l.forEach(function(r){var f=r.Action;if(r.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&f.indexOf("/")<0&&!r.Determining){if(C.getActionPath(o.context,false,f,true)===null){s.push(f);}else{var R=C.getActionPath(o.context,false,f);if(R.sProperty){s.push(R.sProperty.substr(R.sBindingParameter.length+1));}}}});e=s.join(",");return e;},getOperationAvailableMap:function(l,o){var e={},r;l.forEach(function(R){var s=R.Action;if(R.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&s.indexOf("/")<0&&!R.Determining){r=C.getActionPath(o.context,false,s,true);if(r===null){e[s]=null;}else{r=C.getActionPath(o.context,false,s);if(r.sProperty){e[s]=r.sProperty.substr(r.sBindingParameter.length+1);}}}});return JSON.stringify(e);},getMultiSelectDisabledActions:function(l,o){var m=[],s,e,f,p,g;var h=l.filter(function(i){return i.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction";});h.forEach(function(i){e=i.Action;s=C.getActionPath(o.context,true,e,false);g=o.context.getObject(s+"/@$ui5.overload/0");if(g&&g.$Parameter&&g.$IsBound){for(var n in g.$Parameter){f=s+"/"+g.$Parameter[n].$Name+"@";p=o.context.getObject(f);if(p&&((p["@com.sap.vocabularies.UI.v1.Hidden"]&&p["@com.sap.vocabularies.UI.v1.Hidden"].$Path)||(p["@com.sap.vocabularies.Common.v1.FieldControl"]&&p["@com.sap.vocabularies.Common.v1.FieldControl"].$Path))){m.push(e);break;}}}});return m;},getUiLineItem:function(p){var P=p.getObject(p.sPath),o=C.createPresentationPathContext(p),m=p.getModel();if(C._isPresentationVariantAnnotation(o.getPath())){var l="@com.sap.vocabularies.UI.v1.LineItem",v=P.Visualizations;if(Array.isArray(v)){for(var i=0;i<v.length;i++){if(v[i].$AnnotationPath.indexOf(l)!==-1){l=v[i].$AnnotationPath;break;}}}return m.getMetaContext(p.getPath().split("@")[0]+l);}return p;},getCollectionFields:function(e,m){var p=[],o,E;E=m.getObject(e+"/");for(var k in E){o=E[k];if(o&&o.$kind==="Property"){p.push({name:k,label:m.getObject(e+"/"+k+"@com.sap.vocabularies.Common.v1.Label"),type:o.$Type});}}return p;},create$Select:function(o,s,p,P,e){var f=T.addPresentationVariantToSelectQuery(p,P);var g=(s?s:"")+(s&&f?",":"")+f;if(e){e.forEach(function(h){g+=g?","+h.$PropertyPath:h.$PropertyPath;});}if(o["@Org.OData.Capabilities.V1.DeleteRestrictions"]&&o["@Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.$Path){var r=o["@Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.$Path;g+=g?","+r:r;}return!g?"":", $select: '"+g+"'";},getColumnMinWidth:function(o,D,n,s,f){var e,h=o&&o.hasOwnProperty("@com.sap.vocabularies.Common.v1.Text"),i=typeof o!=="undefined"&&(o.hasOwnProperty("@Org.OData.Measures.V1.Unit")||o.hasOwnProperty("@Org.OData.Measures.V1.ISOCurrency"));if(D==="Edm.String"&&!h&&n&&n<10){n+=0.75;if(n<3){n=3;}e=n;}else if(C.getEditMode(o,s,f)!=="Display"&&D==="Edm.Decimal"&&i){e=20;}if(e){return e;}else{return 8;}},getColumnWidth:function(D,o,s,f,i,e,n,g,h){var w,H=false;if(D){return D;}else if(C.getEditMode(o,s,f)==="Display"){H=o&&o.hasOwnProperty("@com.sap.vocabularies.Common.v1.Text");if(e==="Edm.Stream"&&!H&&o.hasOwnProperty("@Org.OData.Core.V1.MediaType")&&o["@Org.OData.Core.V1.MediaType"].includes("image/")){w="7em";}}else if(e==="Edm.Date"||e==="Edm.TimeOfDay"){w="9em";}else if(e==="Edm.DateTimeOffset"){w="12em";}else if(e==="Edm.Boolean"){w="8em";}else if(o&&((o.hasOwnProperty("@com.sap.vocabularies.UI.v1.IsImageURL")&&o.hasOwnProperty("@com.sap.vocabularies.UI.v1.IsImageURL")===true)||(o.hasOwnProperty("@Org.OData.Core.V1.MediaType")&&o["@Org.OData.Core.V1.MediaType"].includes("image/")))){w="7em";}else if(s==="com.sap.vocabularies.UI.v1.DataFieldForAction"||s==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||s==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var j,k;if(h&&h.length>=g.Label.length){j=b.getButtonWidth(h);}else if(g){j=b.getButtonWidth(g.Label);}else{j=b.getButtonWidth(o.Label);}if(n){k=n*2;}if(!isNaN(k)&&k>j){w=k+"em";}else if(h||(o&&(o.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||o.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"))){j+=2;w=j+"em";}}if(w){return w;}else{return"auto";}},getMarginClass:function(o,D,v){if(JSON.stringify(o[o.length-1])==JSON.stringify(D)){if(v=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return"sapUiNoMarginBottom sapUiNoMarginTop";}return"";}else{if(v=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return"sapUiNoMarginTop";}return"sapUiTinyMarginBottom";}},getDefaultQuickFilterKey:function(q){if(q&&Array.isArray(q.paths)&&q.paths.length>0){return q.paths[0].annotationPath;}return undefined;},formatHiddenFilters:function(h){if(h){try{return JSON.stringify(h);}catch(e){return undefined;}}return undefined;},getColumnStableId:function(i,D){return i?S.generate([i,"C",(D.Target&&D.Target.$AnnotationPath)||(D.Value&&D.Value.$Path)||(D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"?D:"")]):undefined;},getRowsBindingInfo:function(t,o,s,e,l,p,P,f){var r={ui5object:true,suspended:false,path:C.addSingleQuotes((o.$kind==="EntitySet"?"/":"")+(t.navigationPath||s)),parameters:{$count:true},events:{}};var g=T.create$Select(e,l,p,P,f);if(g){r.parameters.$select=g.split(": ")[1];}if(t.requestGroupId){r.parameters.$$groupId=C.addSingleQuotes(t.requestGroupId);}if(t.updateGroupId){r.parameters.$$updateGroupId=C.addSingleQuotes(t.updateGroupId);}if(t.onPatchSent){r.events.patchSent=C.addSingleQuotes(t.onPatchSent);}if(t.onPatchCompleted){r.events.patchCompleted=C.addSingleQuotes(t.onPatchCompleted);}if(t.onDataReceived){r.events.dataReceived=C.addSingleQuotes(t.onDataReceived);}if(t.onContextChange){r.events.change=C.addSingleQuotes(t.onContextChange);}return C.objectToString(r);},filterLineItemsForColumn:function(D,i){return((!D.Action&&!D.SemanticObject&&!D.Inline)||(D.Inline&&((i&&D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction")||D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"))||D.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath");},creationRowApplyEnabled:function(t,o,s,p,e){var E=A.getNavigationInsertableRestrictions(o,s,p,e,true);if(typeof E==="string"&&t.disableAddRowButtonForEmptyData==="true"){E=E.substring(0,E.length-1);return(E+" && ${path: '/fieldValidity/"+t.navigationPath+"' , model: 'creationRowModel', formatter: 'RUNTIME.validateCreationRowFields'}}");}return E;},creationRowVisible:function(s,e){if(s&&s==="{=  ${ui>/editMode} === 'Editable'}"){return s;}else{return s.replace(e+"/","");}},validateCreationRowFields:function(f){if(!f){return false;}return(Object.keys(f).length>0&&Object.keys(f).every(function(k){return f[k]["validity"];}));},pressEventDataFieldForActionButton:function(t,D,e,o,f,i){var s,g;s=this._isStaticAction(f,D.Action);g="${"+t.selectedContextsModel+">/$contexts/"+t.id+"/selectedContexts}";var I=D.InvocationGrouping&&D.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";var p={contexts:g,bStaticAction:s?s:undefined,entitySetName:C.addSingleQuotes(e),invocationGrouping:C.addSingleQuotes(I),prefix:C.addSingleQuotes(t.id),operationAvailableMap:C.addSingleQuotes(o),model:"${$source>/}.getModel()",label:C.addSingleQuotes(D.Label),applicableContext:"${"+t.selectedContextsModel+">/$contexts/"+t.id+"/dynamicActions/"+D.Action+"/aApplicable/}",notApplicableContext:"${"+t.selectedContextsModel+">/$contexts/"+t.id+"/dynamicActions/"+D.Action+"/aNotApplicable/}",isNavigable:i};return C.generateFunction(t.onCallAction,C.addSingleQuotes(D.Action),C.objectToString(p));},isDataFieldForActionEnabled:function(t,D,r,i,o,s){var e=this._isStaticAction(o,D.Action);if(!r||e){return true;}var f=t.selectedContextsModel+">/$contexts/"+t.id;var g="";if(i){g="%{"+f+"/numberOfSelectedContexts} >= 1";}else{if(s==="single"){var n="${"+f+"/numberOfSelectedContexts} === 1";}else{var n="${"+f+"/numberOfSelectedContexts} > 0";}var h="${"+f+"/dynamicActions/"+D.Action+"/bEnabled"+"}";g=n+" && "+h;}return"{= "+g+"}";},pressEventDataFieldForIntentBasedNavigation:function(t,D){var s="${"+t.selectedContextsModel+">/$contexts/"+t.id+"/selectedContexts}";var p=C.addSingleQuotes(D.SemanticObject)+", "+C.addSingleQuotes(D.Action)+", "+C.addSingleQuotes(JSON.stringify(D.Mapping))+", "+s;return C.generateFunction(t.onDataFieldForIBN,"$controller",p);},pressEventForCreateButton:function(t){var o=t.create.getObject(),p,m="${$source>}.getParent().getParent().getParent()",r=m+".getRowBinding() || "+m+".getRowsBindingInfo().path";switch(o.mode){case d.External:p={creationMode:C.addSingleQuotes(d.External),outbound:C.addSingleQuotes(o.outbound)};break;case d.CreationRow:p={creationMode:C.addSingleQuotes(d.CreationRow),creationRow:"${$source>}",createAtEnd:o.append!==undefined?o.append:false};r="${$source>}.getParent()._getRowBinding()";break;case d.NewPage:case d.Inline:p={creationMode:C.addSingleQuotes(o.mode),createAtEnd:o.append!==undefined?o.append:false,tableId:C.addSingleQuotes(t.id)};if(o.newAction){p.newAction=C.addSingleQuotes(o.newAction);}break;default:return undefined;}return C.generateFunction(t.onCreate,r,C.objectToString(p));},pasteEvent:function(t){var o=t.create.getObject(),e=o.append!==undefined?o.append:false;return C.generateFunction(t.onPaste,"$event",e);},getIBNData:function(t){var o=t.create.getObject("outboundDetail");if(o){var i={semanticObject:C.addSingleQuotes(o.semanticObject),action:C.addSingleQuotes(o.action)};return C.objectToString(i);}},isCreateButtonEnabled:function(o,s,r,i){var I=o.$kind==="EntitySet";return I?undefined:A.getNavigationInsertableRestrictions(o,s,r,i,false);},pressEventForDeleteButton:function(t,e){var s=t.selectedContextsModel+">/$contexts/"+t.id,D="${"+s+"/deletableContexts}";var p={id:C.addSingleQuotes(t.id),entitySetName:C.addSingleQuotes(e),numberOfSelectedContexts:"${"+s+"/selectedContexts}.length",unSavedContexts:"${"+s+"/unSavedContexts}",lockedContexts:"${"+s+"/lockedContexts}",controlId:"${"+s+"/controlId}"};return C.generateFunction(t.onDelete,D,C.objectToString(p));},isDeleteButtonEnabled:function(t){var s=t.selectedContextsModel+">/$contexts/"+t.id,D="%{"+s+"/deletableContexts}",n=D+".length > 0",e="("+D+" && "+n+")",u="%{"+s+"/unSavedContexts}",N=u+".length > 0",U="("+u+" && "+N+")",f="("+e+" || "+U+")",g="%{"+s+"/deleteEnabled}";var E="{= "+f+" ? "+g+" : false}";return E;},pressEventForPasteButton:function(t){var m="${$source>}.getParent().getParent().getParent()";return C.generateFunction(t.onPasteButtonPressed,m);},filterLineItems:function(D){return(D.Inline!==true&&D.Determining!==true&&D["@com.sap.vocabularies.UI.v1.Hidden"]!==true);},getHiddenPathExpressionForTableActionsAndIBN:function(h,D){var o=D.context,p=o.getPath(),e=O.getNavigationPath(p);if(h.indexOf("/")>0){var s=h.split("/");var n=s[0];if(o.getObject(e+"/$Partner")===n){return"{= !%{"+s.slice(1).join("/")+"} }";}}return true;},setHeaderLabelVisibility:function(e,f){if(!f){if(e.$Type.indexOf("DataFieldForAction")>-1&&e.Inline){return false;}if(e.$Type.indexOf("DataFieldForIntentBasedNavigation")>-1&&e.Inline){return false;}return true;}return f.some(function(D){if((D.$Type==="com.sap.vocabularies.UI.v1.DataField"||D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation")&&D["@com.sap.vocabularies.UI.v1.Hidden"]!==true){return true;}});},setValueFromFieldGroupTarget:function(D,e){if(e&&e.length){D.Value=e[0].Value;}return true;},getValueOnRatingField:function(D,o){if(D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){if(o.context.getObject("Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.DataPoint")>-1&&o.context.getObject("Target/$AnnotationPath/$Type")=="com.sap.vocabularies.UI.v1.DataPointType"&&o.context.getObject("Target/$AnnotationPath/Visualization/$EnumMember")=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return o.context.getObject("Target/$AnnotationPath/TargetValue");}if(o.context.getObject("Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.FieldGroup")>-1){var p="Target/$AnnotationPath/Data/";for(var i in o.context.getObject(p)){if(o.context.getObject(p+i+"/$Type")==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&o.context.getObject(p+i+"/Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.DataPoint")>-1&&o.context.getObject(p+i+"/Target/$AnnotationPath/$Type")=="com.sap.vocabularies.UI.v1.DataPointType"&&o.context.getObject(p+i+"/Target/$AnnotationPath/Visualization/$EnumMember")=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return o.context.getObject(p+i+"/Target/$AnnotationPath/TargetValue");}}}}},getTextOnActionField:function(D,o){if(D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return D.Label;}if(D.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&o.context.getObject("Target/$AnnotationPath").indexOf("@com.sap.vocabularies.UI.v1.FieldGroup")>-1){var p="Target/$AnnotationPath/Data/";for(var i in o.context.getObject(p)){if(o.context.getObject(p+i+"/$Type")==="com.sap.vocabularies.UI.v1.DataFieldForAction"||o.context.getObject(p+i+"/$Type")==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return o.context.getObject(p+i+"/Label");}}}}};T.getOperationAvailableMap.requiresIContext=true;T.addOperationAvailableFieldsToSelectQuery.requiresIContext=true;T.getValueOnRatingField.requiresIContext=true;T.getTextOnActionField.requiresIContext=true;return T;},true);
