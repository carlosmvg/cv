/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/macros/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/base/Log","sap/fe/core/CommonUtils","sap/fe/navigation/SelectionVariant","sap/fe/core/helpers/StableIdHelper","sap/ui/model/Context"],function(R,O,L,C,S,a,b){"use strict";var H={getPathToKey:function(c){return c.getObject();},isVisible:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),h=A["@com.sap.vocabularies.UI.v1.Hidden"];return typeof h==="object"?"{= !${"+h.$Path+"} }":!h;},fireButtonPress:function(B){return C.fireButtonPress(B);},getParameterEditMode:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),f=A["@com.sap.vocabularies.Common.v1.FieldControl"],c=A["@Org.OData.Core.V1.Immutable"],d=A["@Org.OData.Core.V1.Computed"];if(f&&f.$Path){if(f.$Path==="ReadOnly"){return sap.ui.mdc.enum.EditMode.ReadOnly;}else{return("{= %{"+f.$Path+"} ? "+"'"+sap.ui.mdc.enum.EditMode.ReadOnly+"'"+" : "+"'"+sap.ui.mdc.enum.EditMode.Editable+"'"+" }");}}if(f&&f.$EnumMember){if(f.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){return sap.ui.mdc.enum.EditMode.ReadOnly;}}if(c||d){return sap.ui.mdc.enum.EditMode.ReadOnly;}return sap.ui.mdc.enum.EditMode.Editable;},getMetaPath:function(t,i){return(i&&i.context&&i.context.getPath())||undefined;},getTargetCollection:function(c,n){var p=c.getPath(),P,e,d;if(c.getMetadata().getName()==="sap.ui.model.Context"&&c.getObject("$kind")==="EntitySet"){return p;}if(c.getModel){p=(c.getModel().getMetaPath&&c.getModel().getMetaPath(p))||c.getModel().getMetaModel().getMetaPath(p);}P=p.split("/").filter(function(s){return s&&s!="$Type";});e="/"+P[0];if(P.length===1){return e;}d=n===undefined?P.slice(1).join("/$NavigationPropertyBinding/"):n;return e+"/$NavigationPropertyBinding/"+d;},isPropertyFilterable:function(p,i,d){var m=i.context.getModel(),P=i.context.getPath(),e=H._getEntitySetPath(m,P);if(d&&(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){return false;}return C.isPropertyFilterable(m,e,p,P);},formatDraftLockText:function(I,c,d){if(!I){return R.getText("M_COMMON_DRAFT_OBJECT");}else if(c){if(d){return R.getText("M_COMMON_DRAFT_LOCKED_OBJECT");}else{return R.getText("draft.UNSAVED_CHANGES");}}else{return"";}},_getEntitySetPath:function(m,p){var l;var e=p.slice(0,p.indexOf("/",1));if(m.getObject(e+"/$kind")==="EntityContainer"){l=e.length+1;e=p.slice(l,p.indexOf("/",l));}return e;},_resolveValueHelpField:function(c){var v=c.getModel();var V=v.getObject("/");return V.$model.getMetaModel().createBindingContext("/"+V.CollectionPath+"/"+c.getObject());},getBoolAnnotationValue:function(A){var v=A||false;v=v===true||(v&&v["Bool"]!=="false");return v;},gotoTargetEntitySet:function(c){var p=H.getTargetCollection.call(H,c);return p+"/$";},gotoActionParameter:function(c){var p=c.getPath(),P=c.getObject(p+"/$Name");var s;if(p.indexOf("@$ui5.overload")>-1){s=p.split("@$ui5.overload")[0];}else{var A=p.split("/0/")[0].split(".");s="/"+A[A.length-1]+"/";}return s+P;},showNavigateErrorMessage:function(e){sap.m.MessageBox.show(R.getText("M_COMMON_HELPER_NAVIGATION_ERROR_MESSAGE"),{title:R.getText("M_COMMON_NAVIGATION_ERROR_TITLE")});},getLabel:function(m,p){p=p||"";return(m.getProperty(p+"@@sap.ui.model.odata.v4.AnnotationHelper.label")||m.getProperty(p+"@com.sap.vocabularies.Common.v1.Label")||m.getProperty(p+"/@com.sap.vocabularies.Common.v1.Label")||m.getProperty(p+"@sapui.name"));},getIdentifyingName:function(m,i){return((i?this._getEntitySetPath(m.getModel(),m.getPath())+"/":"")+(m.getProperty("Value/$Path")||m.getProperty("Target/$AnnotationPath")||m.getProperty("@sapui.name")||(m.getProperty("SemanticObject")?a.getStableIdPartFromDataField(m.getObject()):"DataFieldForAction::"+m.getProperty("Action"))));},getEntitySetName:function(m,e){var E=m.getObject("/");for(var k in E){if(typeof E[k]==="object"&&E[k].$Type===e){return k;}}},getActionPath:function(A,r,s,c){var e=A.getPath().split("/@")[0];s=!s?A.getObject(A.getPath()):s;if(s&&s.indexOf("(")>-1){s=s.split("(")[0];e=e.substr(1);}else{e=A.getObject(e).$Type;e=this.getEntitySetName(A.getModel(),e);}if(c){return A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable");}if(r){return"/"+e+"/"+s;}else{return{sEntityName:e,sProperty:A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable/$Path"),sBindingParameter:A.getObject("/"+e+"/"+s+"/@$ui5.overload/0/$Parameter/0/$Name")};}},getEditMode:function(A,d,f,e,c,u,E,p){if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return e;}var g,i,s,h,D,j,F,k,l,I,m,n=E&&E.$Key.indexOf(p)>-1;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(A&&A["@com.sap.vocabularies.Common.v1.SemanticObject"]&&!(A["@com.sap.vocabularies.Common.v1.ValueListReferences"]||A["@com.sap.vocabularies.Common.v1.ValueListMapping"]||A["@com.sap.vocabularies.Common.v1.ValueList"]||A["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]))){return"Display";}if(A&&A["@Org.OData.Core.V1.Computed"]){g=A["@Org.OData.Core.V1.Computed"].Bool?A["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(A&&A["@Org.OData.Core.V1.Immutable"]){i=A["@Org.OData.Core.V1.Immutable"].Bool?A["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}if(n&&!g&&i){return"{= %{@$ui5.context.isTransient} === true ? 'Editable' : 'Display'}";}D=g||i||n;if(c&&c.indexOf("{")===0){c="$"+c;}l=typeof g==="undefined"?typeof i==="undefined":!g;if(f){if(f.indexOf("{")===0){I="$"+f+" === '1'";m="$"+f+" === '0'";}else{D=D||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}}var o;var q;var r;var t;if(I){t=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly'  : 'Display'";if(l){q=e==="Editable"?c+" ? 'Editable' : 'ReadOnly'":"$"+e+" === 'Editable' ? "+c+"? 'Editable' : 'ReadOnly'  : 'Display'";r=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}else{q=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly' : 'Display'";r=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}}else{q="'Display'";r="'Display'";t="'Display'";}j=e&&e.indexOf("{")===0?"$"+e:"'"+e+"'";if(D){if(!l){if(e&&e.indexOf("{")===0){return"{= "+q+"}";}q=q.split("'")&&q.split("'")[1];return q;}else{if(I){if(c&&c.indexOf("$")===0){return("{= "+c+" ? ("+m+"? "+"'Disabled'"+" : "+I+"? "+"'ReadOnly'"+" : "+j+") : "+q+"}");}else if(c=="true"){return("{= "+m+"? "+"'Disabled'"+" : "+I+"? "+"'ReadOnly'"+" : "+"${ui>/editMode} === 'Editable'"+"}");}else{return"{= "+q+"}";}}else if(f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){j="'ReadOnly'";}if(c&&c.indexOf("$")===0){return"{= "+c+" ?"+"${ui>/editMode} === 'Editable'"+" : "+q+"}";}else if(c=="true"){return"{= "+j+"}";}else{return"{= "+q+"}";}}}if(I){if(u&&u.indexOf("{")===0){j="$"+u+" === '1' ? 'EditableReadOnly' : "+j;}else if(u==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){j="EditableReadOnly";}s=m+" ? "+r+" :"+I+" ? "+t+" :"+j;o="{= "+s+"}";}else if(u&&(u.indexOf("{")===0||u==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly")){F=u.indexOf("{")===0?"$"+u+" === '1'":undefined;k=e==="Editable"?"'EditableReadOnly'":"$"+e+" === 'Editable' ? 'EditableReadOnly' : 'Display'";if(F){s=F+" ? "+k+" :"+j;}else{s=k;}o="{= "+s+"}";}else{s=j;o=e;}var v;if(c&&c.indexOf("$")===0){v="{= "+c+" ? "+q+" : "+s+"}";}else if(c=="true"){v="{= "+q+"}";}else{v="{= "+s+"}";}h=l?o:v;return h;},getNavigationContext:function(c){return O.getNavigationPath(c.getPath());},getHiddenPathExpression:function(d,D){var c=D.context,p=c.getPath(),e=O.getNavigationPath(p),h=[],s,P;if(c.getObject(p+"@com.sap.vocabularies.UI.v1.Hidden")){h.push(c.getObject(p+"@com.sap.vocabularies.UI.v1.Hidden"));}if(p.lastIndexOf("/")===p.length-1){P="Value/$Path@com.sap.vocabularies.UI.v1.Hidden";}else{P="/Value/$Path@com.sap.vocabularies.UI.v1.Hidden";}if(c.getObject(p+P)){h.push(c.getObject(p+P));}if(h.length){var f=[];for(var i=0;i<h.length;i++){s=h[i];if(s.$Path){if(s.$Path.indexOf("/")>0){var n=s.$Path.split("/")[0];if(c.getObject(e+"/"+n)&&!c.getObject(e+"/"+n).$isCollection){f.push("%{"+s.$Path+"}");}else{f.push(false);}}else{f.push("%{"+s.$Path+"}");}}else{f.push(s);}}if(f.length===1){return"{= "+f[0]+" === true ? false : true }";}else{return"{= ("+f[0]+" === true || "+f[1]+" === true ) ? false : true }";}}return true;},getActionContext:function(A){return H.getActionPath(A,true);},getPathToBoundActionOverload:function(A){var p=H.getActionPath(A,true);return p+"/@$ui5.overload/0";},addSingleQuotes:function(v){return"'"+v+"'";},generateFunction:function(f){var p="";for(var i=1;i<arguments.length;i++){p+=arguments[i];if(i<arguments.length-1){p+=", ";}}var F=f+"()";if(p){F=f+"("+p+")";}return F;},getHeaderDataPointLinkVisibility:function(p,l,f){var v;if(f){v=l?"{= ${localUI>/isHeaderDPLinkVisible/"+p+"} === true && "+f+"}":"{= ${localUI>/isHeaderDPLinkVisible/"+p+"} !== true && "+f+"}";}else{v=l?"{= ${localUI>/isHeaderDPLinkVisible/"+p+"} === true}":"{= ${localUI>/isHeaderDPLinkVisible/"+p+"} !== true}";}return v;},objectToString:function(p){var n=Object.keys(p).length,P="";for(var k in p){var v=p[k];if(v&&typeof v==="object"){v=this.objectToString(v);}P+=k+": "+v;if(n>1){--n;P+=", ";}}var o="{ "+P+"}";return o;},removeEscapeCharacters:function(e){return e?e.replace(/\\?\\([{}])/g,"$1"):undefined;},getDesigntimeMetadata:function(c,f,d,o){if(o&&o.Facet.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"&&f&&f.Facet.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){return"not-adaptable-tree";}var F=a.generate([f]),D=c["@com.sap.vocabularies.UI.v1.HeaderFacets"]&&c["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"]&&c["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"][F]&&c["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"][F]["flexSettings"]&&c["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"][F]["flexSettings"].designtime;var e=["not-adaptable","not-adaptable-tree","not-adaptable-visibility"];if(e.indexOf(D)>=0){return D;}if(D===undefined||D==="fe-default"){return d;}},getStashed:function(v,f,c){if(v.editableHeaderContent||(c&&c.Facet&&c.Facet.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"&&f&&f.Facet&&f.Facet.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet")){return false;}var o=v.controlConfiguration,F=a.generate([f]),s=o&&o["@com.sap.vocabularies.UI.v1.HeaderFacets"]&&o["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"]&&o["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"][F]&&o["@com.sap.vocabularies.UI.v1.HeaderFacets"]["facets"][F]["stashed"];return s===true;},stringifyCustomData:function(d){var o={ui5object:true};o["customData"]=d instanceof b?d.getObject():d;return JSON.stringify(o);},parseCustomData:function(d){var d=typeof d==="string"?JSON.parse(d):d;if("customData"in d){return d["customData"];}return d;},_getDraftAdministrativeDataType:function(m,e){return m.requestObject("/"+e+"/DraftAdministrativeData/");},getPopoverText:function(c,e){return H._getDraftAdministrativeDataType(c.getModel(),e).then(function(d){var B="{parts: [{path: 'HasDraftEntity', targetType: 'any'}, "+"{path: 'DraftAdministrativeData/InProcessByUser'}, "+"{path: 'DraftAdministrativeData/LastChangedByUser'} ";if(d.InProcessByUserDescription){B+=" ,{path: 'DraftAdministrativeData/InProcessByUserDescription'}";}if(d.LastChangedByUserDescription){B+=", {path: 'DraftAdministrativeData/LastChangedByUserDescription'}";}B+="], formatter: 'sap.fe.macros.field.FieldRuntime.formatDraftOwnerTextInPopover'}";return B;});},getSortConditions:function(p,P){if(p&&this._isPresentationVariantAnnotation(P)&&p.SortOrder){var s={sorters:[]};p.SortOrder.forEach(function(c){var o={};o.name=c.Property.$PropertyPath;o.descending=!!c.Descending;s.sorters.push(o);});return JSON.stringify(s);}return undefined;},_isPresentationVariantAnnotation:function(A){return(A.indexOf("@com.sap.vocabularies.UI.v1.PresentationVariant")>-1||A.indexOf("@com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1);},createPresentationPathContext:function(p){var P=p.sPath.split("@")||[];var m=p.getModel();if(P.length&&P[P.length-1].indexOf("com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1){var s=P[P.length-1];s=p.sPath.split("/PresentationVariant")[0];return m.createBindingContext(s+"@sapui.name");}return m.createBindingContext(p.sPath+"@sapui.name");}};H.isPropertyFilterable.requiresIContext=true;H.getPopoverText.requiresIContext=true;return H;},true);
