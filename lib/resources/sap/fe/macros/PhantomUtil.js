/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/base/Log","sap/ui/base/ManagedObject","sap/fe/macros/ResourceModel","sap/ui/core/util/XMLPreprocessor","sap/ui/base/SyncPromise","./TraceInfo"],function(J,L,M,R,X,S,T){"use strict";var p="sap.fe.macros.PhantomUtil",i=R.getModel();i.bindContext=i.bindContext||function(){return{initialize:function(){},attachChange:function(){},detachChange:function(){},attachEvents:function(){},detachEvents:function(){},updateRequired:function(){},destroy:function(){},getContext:function(){}};};function v(n,C,o,k){var e,f;if(!C[k]){if(o.required){throw new Error(n+": "+"Required metadataContext '"+k+"' is missing");}}else{e=C[k];f=e.getObject();if(f){var h=Object.assign({},o);delete h.required;delete h.type;if(f.hasOwnProperty("$kind")){delete h.$Type;}else{delete h.$kind;}Object.keys(h).forEach(function(P){var j=Array.isArray(h[P])?h[P]:[h[P]],V;if(typeof f==="object"){V=f[P];if(!V){if(f.hasOwnProperty("$Path")){V=e.getObject("$Path/"+P);}}}else if(typeof f==="string"){V=e.getObject(P);if(!V){V=j[0];}}else{V=null;}if(j.indexOf(V)===-1){throw new Error(n+": '"+k+"' must be '"+P+"' '"+j+"' but is '"+V+"': "+e.getPath());}});}}}function a(n,m,C,N){var e=(m.metadataContexts&&Object.keys(m.metadataContexts))||[],P=(m.properties&&Object.keys(m.properties))||[],A={};Object.keys(N.attributes).forEach(function(k){var K=N.attributes[k].name;if(K!=="metadataContexts"){A[K]=true;}});Object.keys(C).forEach(function(k){if(k!=="this"&&k!=="this.i18n"){A[k]=true;}});e.forEach(function(k){var o=m.metadataContexts[k];v(n,C,o,k);delete A[k];});P.forEach(function(k){var o=m.properties[k];if(!N.hasAttribute(k)){if(o.required&&!o.hasOwnProperty("defaultValue")){throw new Error(n+": "+"Required property '"+k+"' is missing");}}else{delete A[k];}});Object.keys(A).forEach(function(k){if(k.charAt(0)!=="_"&&k.indexOf(":")<0){L.warning("Unchecked parameter: "+n+": "+k,null,p);}});}function b(m){if(m){var P={};var o=m.metadataContexts||{};Object.keys(m.properties).forEach(function(s){if(m.properties[s].type!=="sap.ui.model.Context"){P[s]=m.properties[s];}else{o[s]=m.properties[s];}});if(m.events){Object.keys(m.events).forEach(function(e){P[e]=m.events[e];});}return{properties:P,aggregations:Object.assign({"dependents":{type:"sap.ui.core.Element"}},m.aggregations),metadataContexts:o};}else{return{metadataContexts:{},aggregations:{"dependents":{type:"sap.ui.core.Element"}},properties:{},events:{}};}}function w(k){return function(V){var o={};o[k]=V;return o;};}function g(n,k,D){return function(){var V=n.getAttribute(k);if(!V&&D.defaultValue){V=D.defaultValue;}return w(k)(V);};}function _(s,n,A,V){var m;if(n.hasAttribute(A)){var e=n.getAttribute(A);V.getResult(e,n);m=M.bindingParser(e);if(!m){m={model:"entitySet",path:s.bindingContexts.entitySet.getPath(e)};}}else if(s.bindingContexts.hasOwnProperty(A)){m={model:A,path:""};}return m;}function r(m,n,V){var f=m.fragment||m.namespace+"."+m.name,N="this",I=N+".i18n",C={},A=new J(n),s=n.getAttribute("metadataContexts"),o={},e=V.getSettings(),j;var h=b(m.metadata);A._getObject=function(P,F){if((P===undefined||P==="")&&this.oProps){return this.oProps;}if(this.oProps&&this.oProps.hasOwnProperty(P)){return this.oProps[P];}return n.getAttribute(P);};A.getContextName=function(){return N;};A.$$valueAsPromise=true;C[I]=i.getContext("/");if(!e[f]){e[f]={};}var t=null;var k=true;var l={};if(m.hasValidation){var D=h.properties;var q=h.metadataContexts;var u=Object.keys(D);var x=Object.keys(q);var y=[];for(j=0;j<u.length;j++){var K=u[j];if(n.hasAttribute(K)){y.push(V.visitAttribute(n,n.attributes[K]).then(g(n,K,D[K])));}else{var O={};O[K]=D[K].defaultValue;y.push(Promise.resolve(O));}}k=false;for(j=0;j<x.length;j++){var z=x[j];var B=_(e,n,z,V);if(B){B.name=z;c(C,V,B,o);y.push(Promise.resolve(w(z)(C[z])));}else{l[z]=true;k=true;}}if(n.firstElementChild!==null){y.push(V.visitChildNodes(n));}t=S.all(y);}else{t=V.visitAttributes(n);}var E={};return t.then(function(P){if(P!=null){var F=P.reduce(function(Q,U){return Object.assign(Q,U);},{});var G=n.firstElementChild;while(G!==null){E[G.localName]=G;G=G.nextElementSibling;}if(m.create){var H={};if(e.models.viewData){H=e.models.viewData.getProperty("/controlConfiguration");}F=m.create(F,H);Object.keys(l).forEach(function(Q){if(F.hasOwnProperty(Q)){C[Q]=F[Q];}});}A.oProps=F;}if(k&&s){o=s?M.bindingParser(s):{parts:[]};if(!o.parts){o={parts:[o]};}for(j=0;j<o.parts.length;j++){c(C,V,o.parts[j],o);V=V["with"](C,false);}}}).then(function(){var P;C[N]=A.getContext("/");if(T.isTraceInfoActive()){var F=T.traceMacroCalls(f,h,C,n,V);if(F){P=e["_macroInfo"];e["_macroInfo"]=F.macroInfo;}}a(f,h,C,n);var G=V["with"](C,true);var H=n.parentNode;return G.insertFragment(f,n).then(function(){if(Object.keys(E).length>0){var Q=H.firstElementChild;Object.keys(E).forEach(function(U){var W=E[U];var Y=document.createElementNS(Q.namespaceURI,U);var Z=W.firstElementChild;while(Z){var $=Z.nextElementSibling;Y.appendChild(Z);Z=$;}Q.appendChild(Y);});}if(P){e["_macroInfo"]=P;}else{delete e["_macroInfo"];}});});}function c(C,V,o,m){var k=o.name||o.model||undefined;if(m[k]){return;}try{var s=o.path;if(o.model!=null){s=o.model+">"+s;}C[k]=V.getContext(s);var e=V.getSettings();if(e&&e.bindingContexts&&e.bindingContexts.entitySet){C[k].$$configModelContext=V.getSettings().bindingContexts.entitySet.$$configModelContext;}m[k]=C[k];}catch(f){}}function d(m){X.plugIn(r.bind(this,m),m.namespace,m.name);}d._validateMacroSignature=a;return{register:d};});
