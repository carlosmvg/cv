sap.ui.define(["sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/model/odata/AnnotationHelper","sap/ui/model/FilterOperator","sap/ovp/cards/ovpLogger"],function(V,O,F,o){"use strict";var L=new o("OVP.v4.linklist.AnnotationHelper");function g(i){var S=[];var j,D;var P=i.getProperty("/sortBy");if(P){var t=i.getProperty("/sortOrder");if(t&&t.toLowerCase()!=="descending"){D=false;}else{D=true;}j={path:P,descending:D};S.push(j);}return S;}function a(t,S){var u=[];var C=t.getProperty("/filters");if(C){u=u.concat(C);}var v=S&&S.SelectOptions;var w,P,R;if(v){for(var i=0;i<v.length;i++){w=v[i];P=w.PropertyName.PropertyPath;for(var j=0;j<w.Ranges.length;j++){R=w.Ranges[j];if(R.Sign.EnumMember){var x={path:P,operator:R.Option.EnumMember.split("/")[1],value1:V.getPrimitiveValue(R.Low),value2:V.getPrimitiveValue(R.High),sign:R.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(x.sign==="E"&&x.operator!==F.EQ){L.error("Exclude sign is supported only with EQ operator");continue;}if(x.sign==="E"&&x.operator===F.EQ){x.operator=F.NE;x.sign="I";}if(x.operator==="CP"&&x.sign==="I"){var I=F.Contains;var y=x.value1;if(y){var z=y.indexOf('*');var A=y.lastIndexOf('*');if(z>-1){if((z===0)&&(A!==(y.length-1))){I=F.EndsWith;y=y.substring(1,y.length);}else if((z!==0)&&(A===(y.length-1))){I=F.StartsWith;y=y.substring(0,y.length-1);}else{y=y.substring(1,y.length-1);}}}x.operator=I;x.value1=y;}u.push(x);}}}}return u;}function f(C,E,H){var M=C.getSetting("ovpCardProperties");var i=M.getProperty("/metaModel");var j=i.getODataEntityType(E.entityType);var t="/"+E.name;var S=j[M.getProperty("/selectionAnnotationPath")];var I;var u=M.getProperty("/layoutDetail");if(u==='resizable'){var v=M.getProperty("/cardLayout");if(v){if(M.getProperty("/listFlavor")==="standard"){var w="";for(var x in H){w+=x;}var R=M.getProperty("/cardLayout/iRowHeigthPx");if(R===undefined){R=16;}var y;if(M.getProperty("/densityStyle")==="cozy"){y=72;if((w.indexOf("Description")===-1)&&((w.indexOf("Title")>0&&w.indexOf("ImageUrl")>0)||(w.indexOf("Title")>0&&w.indexOf("TypeImageUrl")>0))){y=56;}else if((w.indexOf("Description")===-1)&&w.indexOf("Title")>0){y=48;}}else{y=60;if((w.indexOf("Description")===-1)&&((w.indexOf("Title")>0&&w.indexOf("ImageUrl")>0)||(w.indexOf("Title")>0&&w.indexOf("TypeImageUrl")>0))){y=48;}else if((w.indexOf("Description")===-1)&&w.indexOf("Title")>0){y=40;}}M.setProperty('/cardLayout/itemHeight',y);if(!M.getProperty("/defaultSpan")&&M.getProperty("/cardLayout/autoSpan")){I=M.getProperty("/cardLayout/noOfItems");var z=Math.ceil((I*y+M.getProperty("/cardLayout/headerHeight")+2*M.getProperty("/cardLayout/iCardBorderPx"))/R);M.setProperty("/cardLayout/noOfItems",z);}else{var A=Math.floor(((v.rowSpan*R)-M.getProperty("/cardLayout/headerHeight")-2*M.getProperty("/cardLayout/iCardBorderPx")));I=Math.floor(A/y)*v.colSpan;}}}}else{I=6;}var B=C.getSetting('ovpCardProperties'),P=B.getProperty('/parameters');if(S||!!P){if((S&&S.Parameters)||!!P){t=V.resolveParameterizedEntitySet(C.getSetting("dataModel"),E,S,P);}}var D="{path: '"+t+"', length: "+I;var G=g(M);if(G.length>0){D=D+", sorter:"+JSON.stringify(G);}var J=a(M,S);if(J.length>0){D=D+", filters:"+JSON.stringify(J);}var K=V.checkFilterPreference(M);if(K){D=D+", parameters:{custom: {cardId: '"+M.getProperty("/cardId")+"'}}";}D=D+"}";return D;}f.requiresIContext=true;function b(C,u){var B=C.getModel().getProperty("/baseUrl");return m(B,u);}b.requiresIContext=true;function c(i,D){var I=true;var j=O.format(i,D);if(j.toLowerCase().indexOf("icon")>0){I=false;}return I;}c.requiresIContext=true;function d(D){var i=true;if(!D){return null;}else if(D.toLowerCase().indexOf("icon")>0){i=false;}return i;}function e(u){var i=new RegExp("http(s)?:\/\/(www\.)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?","i");return i.test(u);}function h(t){var i;if(t.hasOwnProperty("Path")){i="{"+t.Path+"}";}else{i=t.String;}return i;}function k(i){var P="{"+i.String+"}";return P;}function l(A){if(A){return 1;}return 0;}function m(B,u){if(!u){return undefined;}else if(u.lastIndexOf(B,0)===0||u.indexOf("://")>0){return u;}else if(u.lastIndexOf("/",0)===0){return B+u;}else{return B+"/"+u;}}function n(i,S,v){var j;if(typeof v==="object"){j=v[i];}else{j=(typeof v==="boolean")?v:true;}return!S[i]&&j;}function p(j,t,u){var N="";if(j){if(t&&u){N="#"+t+"-"+u;for(var i=0;i<j.length;i++){if(j[i].value===N){return j[i].name;}}N="";}else{return j[0].name;}}return N;}function q(C,i){return m(C.baseUrl,i);}function r(R){return this.getModel("contentRow").aBindings[0].getContext().getPath().replace("/staticContent/","");}function s(i){return((i.Path&&("{"+i.Path+"}"))||i.String||"");}return{formatItems:f,formatUrl:b,isImageUrl:c,isImageUrlStaticData:d,isValidURL:e,getIconPath:h,formatString:k,linkedAction:l,formUrl:m,isVisible:n,getApplicationName:p,getImageUrl:q,contentRowIndex:r,getAvatarInitials:s};},true);
