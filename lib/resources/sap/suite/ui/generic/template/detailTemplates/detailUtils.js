sap.ui.define(["sap/suite/ui/generic/template/lib/FeLogger","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/extensionAPI/NavigationController","sap/suite/ui/generic/template/lib/MessageButtonHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/DiscardEditHandler","sap/suite/ui/generic/template/detailTemplates/PaginatorButtonsHelper","sap/suite/ui/generic/template/ObjectPage/extensionAPI/DraftTransactionController","sap/suite/ui/generic/template/ObjectPage/extensionAPI/NonDraftTransactionController","sap/m/DraftIndicator"],function(F,U,H,a,b,N,M,t,D,P,c,d){"use strict";var l=new F("detailTemplates.detailUtils").getLogger();var e=sap.m.DraftIndicatorState;var p=new a({path:"persistent",operator:b.EQ,value1:false});function g(C,o,v){function i(){var T=o.getTemplatePrivateModel();T.setProperty("/objectPage",{displayMode:0,headerInfo:{objectTitle:"",objectSubtitle:""}});o.setStatePreserverPromise(v);}function h(B,I){if(!o.isDraftEnabled()){var q=C.getModel("ui");var T=o.getTemplatePrivateModel();var r=q.getProperty("/createMode");T.setProperty("/objectPage/displayMode",r?4:1);}(v.onComponentActivate||Function.prototype)(B,I);}function u(B){var T=C.getModel("_templPrivGlobal");T.setProperty("/generic/draftIndicatorState",e.Clear);(v.applyHeaderContextToSmartTablesDynamicColumnHide||Function.prototype)(B);}function n(){v.navigateUp();}function j(s,A){return v.oStatePreserverPromise.then(function(S){return S.getUrlParameterInfo(s,A);});}function k(O){return v.getMessageFilters(O);}function m(q){return v.getScrollFunction&&v.getScrollFunction(q);}return{init:i,onActivate:h,getTitle:o.getTitle,updateBindingContext:u,navigateUp:n,getUrlParameterInfo:j,getMessageFilters:k,getScrollFunction:m};}function f(v,T,C){var o;var h;function G(){var R=U.getRouterFor(C);return R?R.getHashChanger():H.getInstance();}function s(i){var I=!T.oComponentUtils.isDraftEnabled();if(I||!i){var J=C.getView().getModel("ui");J.setProperty("/editable",i);}}function O(){T.oServices.oApplication.onBackButtonPressed();}function A(){var L=T.oServices.oApplication.getLinksToUpperLayers();var V=T.oComponentUtils.getViewLevel();var I;if(T.oComponentUtils.isDraftEnabled()){var J=T.oComponentUtils.getTemplatePrivateModel();I=J.getProperty("/objectPage/displayMode");}else{I=1;}v.navigateUp=L[V-1].navigate.bind(null,I,false);var K=v.aBreadCrumbs;var Q=K?K.length:0;for(var i=0;i<Q;i++){var R=K[i];var S=L[i+1];S.adaptBreadCrumbLink(R);var W=T.oCommonUtils.getControlInformation(R,function(X){});W.navigate=S.navigate.bind(null,I,true);}}function j(i){var I=i.getBindingContext();var J=G().getHash();return T.oServices.oApplicationController.propertyChanged(J,I);}function n(){v.navigateUp();}function k(i){var I=T.oServices.oApplication.getBusyHelper();var J=C.getView().getModel("ui");var K=C.getOwnerComponent().getModel("_templPrivGlobal");var L=j(i).then(function(R){if(!o.fclInfo.isContainedInFCL||K.getProperty("/generic/FCL/isVisuallyFullScreen")){n();}},function(){I.getUnbusy().then(function(R){if(!o.fclInfo.isContainedInFCL||K.getProperty("/generic/FCL/isVisuallyFullScreen")){T.oCommonUtils.processDataLossTechnicalErrorConfirmation(function(){n();J.setProperty("/enabled",true);},Function.prototype,o.state);}else{T.oCommonUtils.processDataLossTechnicalErrorConfirmation(Function.prototype,Function.prototype,o.state,"StayOnPage");}});});I.setBusy(L);}function m(i){var I=i.getSource();var J=T.oComponentUtils.getCRUDActionHandler();J.handleCRUDScenario(2,k.bind(null,I));}var q;function r(i){q=q||new D(C,T,v,o.state);return q.discardEdit(i);}function u(){o.state.messageButtonHelper.toggleMessagePopover();}function w(i){return o.state.messageButtonHelper&&o.state.messageButtonHelper.getMessageFilters(i);}function x(){var i;return function(){i=i||new N(T,C,o.state);return i;};}function y(){var i;return function(){if(!i){var I=T.oComponentUtils.isDraftEnabled()?c:d;i=new I(T,C,o.state);}return i;};}function z(){h.handleShowNextObject();}function B(){h.handleShowPrevObject();}var G=t.testable(G,"getHashChangerInstance");var A=t.testable(A,"adaptLinksToUpperLevels");o={onInit:function(R,i,I,J){if(!R||R.footerBar){var K=T.oComponentUtils.isODataBased();var L={controller:C,prepareAllMessagesForNavigation:i,messageSorter:I,getGroupTitle:J};o.state.messageButtonHelper=new M(T,L,K);if(!T.oComponentUtils.isDraftEnabled()){var Q=C.getOwnerComponent().getModel("ui");var S=Q.bindProperty("/editable");var V=sap.ui.getCore().getMessageManager();var W=V.getMessageModel();S.attachChange(function(){if(!S.getValue()){var X=o.state.messageButtonHelper.getContextFilter();var Y=W.bindList("/",null,null,[X,p]);var Z=Y.getContexts();var $=Z.map(function(_){return _.getObject();});V.removeMessages($);}});}T.oServices.oTemplateCapabilities.oMessageButtonHelper=o.state.messageButtonHelper;o.state.onCancel=r;}if(!R||R.paginatorButtons){h=new P(o,C,T);}v.getScrollFunction=function(X){var Y=T.oCommonUtils.getPositionableControlId(X);return Y&&T.oCommonUtils.focusControl.bind(null,Y);};},handlers:{handleShowNextObject:z,handleShowPrevObject:B,onShowMessages:u,applyAndUp:m,onSave:function(){l.error("Save for this floorplan not implemented yet");},onBack:O},extensionAPI:{getNavigationControllerFunction:x,getTransactionControllerFunction:y},fclInfo:{isContainedInFCL:false},state:{},onComponentActivate:function(i,I){if(o.state.messageButtonHelper){o.state.messageButtonHelper.adaptToContext(i);}A();if(h){h.computeAndSetVisibleParamsForNavigationBtns();}v.oStatePreserverPromise.then(function(S){S.applyAppState(i,I);});}};v.navigateUp=n;v.setEditable=s;v.getMessageFilters=w;var E=T.oComponentUtils.getFclProxy();if(E.oActionButtonHandlers){o.handlers.fclActionButtonHandlers=E.oActionButtonHandlers;o.fclInfo.isContainedInFCL=true;}o.stateChanged=function(){return v.oStatePreserverPromise.then(function(S){return S.stateChanged();});};return o;}return{getComponentBase:g,getControllerBase:f};});
