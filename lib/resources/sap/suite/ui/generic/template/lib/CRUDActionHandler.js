sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/extend","sap/ui/generic/app/util/MessageUtil","sap/ui/model/json/JSONModel"],function(B,F,a,e,G,J){"use strict";var A=new F({filters:[new F({path:"type",operator:a.EQ,value1:sap.ui.core.MessageType.Warning}),new F({path:"type",operator:a.EQ,value1:sap.ui.core.MessageType.Error})],and:false});var b=new F({path:"type",operator:a.EQ,value1:sap.ui.core.MessageType.Error});var l="model";function g(t,c,C){var y,n;var f;var I;var s=(function(){var o=c.getOwnerComponent();var R=t.componentRegistry[o.getId()];return!!(R.methods.showConfirmationOnDraftActivate&&R.methods.showConfirmationOnDraftActivate());})();function d(m){var o=t.oNavigationControllerProxy.getActiveComponents();var R;for(var i=0;i<o.length&&!R;i++){var q=o[i];var u=t.componentRegistry[q];R=u.viewLevel&&(u.methods.getScrollFunction||Function.prototype)(m);}return R||null;}function h(S,m,M){return new Promise(function(R){var o,L,q;C.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.MessageInfluencingCRUDAction",{onMessageSelect:function(){L.setProperty("/backbtnvisibility",true);},onBackButtonPress:function(){q.navigateBack();L.setProperty("/backbtnvisibility",false);},onAccept:function(){f=y;o.close();},onReject:function(){f=n;o.close();},isPositionable:function(i){return!!(i&&d(i));},titlePressed:function(E){o.close();var i=E.getParameter("item");var u=i.getBindingContext("msg").getObject();f=d(u.controlIds);o.close();},afterClose:function(){y=null;n=null;q.navigateBack();(f||Function.prototype)();f=null;}},l,function(i){q=i.getContent()[0];i.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");I=i.getContent()[0].getBinding("items");}).then(function(u){o=u;L=o.getModel(l);L.setProperty("/situation",S);L.setProperty("/backbtnvisibility",false);L.setProperty("/title",o.getModel("i18n").getProperty("ST_DETAIL_TITLE_VALIDATION"));var O=A;var E=b;var v=M?new J(M):sap.ui.getCore().getMessageManager().getMessageModel();var U=c.getOwnerComponent().getModel("ui");var w=U.getProperty("/createMode");u.setModel(v,"msg");I=u.getContent()[0].getBinding("items");if(!M){var x=[];var z=t.oNavigationControllerProxy.getActiveComponents();var D=(S<3);for(var i=0;i<z.length;i++){var K=z[i];var N=t.componentRegistry[K];if(N.oController===c||S!==2){var P=(N.methods.getMessageFilters||Function.prototype)(D);x=P?x.concat(P):x;}}if(x.length===0){R(null);return;}O=x.length===1?x[0]:new F({filters:x,and:false});}if(S===3){E=new F({filters:[O,b],and:true});O=new F({filters:[O,A],and:true});w?L.setProperty("/title",o.getModel("i18n").getProperty("ST_DETAIL_TITLE_CREATE")):L.setProperty("/title",o.getModel("i18n").getProperty("ST_DETAIL_TITLE_SAVE"));if(m==="Delete"){var Q=(o.getModel("_templPriv").getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var T=o.getModel("_templPriv").getProperty("/objectPage/headerInfo/objectSubtitle");var V,W;if(Q){if(T){V=[" ",Q,T];W=C.getText("CONFIRMATION_POPUP_TITLE_DELETE_WITH_OBJECTINFO",V);}else{V=[Q];W=C.getText("CONFIRMATION_POPUP_TITLE_DELETE_WITH_OBJECTTITLE",V);}}else{W=C.getText("CONFIRMATION_POPUP_TITLE_ST_GENERIC_DELETE_SELECTED");}L.setProperty("/title",W);}if(I.filter(E).getLength()===0){L.setProperty("/situation",4);L.setProperty("/CRUDAction",m);}}I.filter(O);R(I.getLength()&&o);});});}function j(i){return new Promise(function(R,m){var v;h(i?1:2).then(function(P){v=P;if(v){v.open();return m();}if(!(i&&s)){return R();}h(3).then(function(P){v=P;if(v){y=R;n=m;v.open();}else{R();}});});});}function p(i,o){t.oApplicationProxy.performAfterSideEffectExecution(function(){if(!t.oBusyHelper.isBusy()){j(i).then(o);}});}function r(o,i,m,M){y=o;n=i;return h(3,m,M).then(function(w){if(w){t.oBusyHelper.getUnbusy().then(function(){w.open();},function(){w.open();});}else{i();}});}function H(S,P,i,m,M){if(S===4){return r(P,i,m,M);}else{return p((S===1),P);}}function k(){return new Promise(function name(R){h(1).then(function(P){R(!!P);});});}return{handleCRUDScenario:H,hasValidationMessageOnDetailsViews:k};}return B.extend("sap.suite.ui.generic.template.lib.CRUDActionHandler",{constructor:function(t,c,C){e(this,g(t,c,C));}});});
