sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/mvc/XMLView","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/generic/app/util/ModelUtil","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/FlexibleColumnLayoutHandler","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/js/StableIdHelper","sap/m/MessageBox","sap/suite/ui/generic/template/lib/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/each","sap/suite/ui/generic/template/lib/FeError"],function(C,X,F,a,M,b,c,t,S,d,e,o,f,g,h,k){"use strict";var s="lib.routingHelper";var l=new e(s).getLogger();var m=(sap&&sap.ushell&&sap.ushell.Container)?sap.ushell.Container.getService("CrossApplicationNavigation"):(function(){var i=0;var j={done:function(d1){d1(Object.create(null));},fail:function(){}};return{createEmptyAppState:function(){return{getKey:function(){i++;return""+i;},setData:Function.prototype,save:function(){return Promise.resolve();}};},getAppState:function(){return j;},isInitialNavigation:function(){return true;}};})();var p="---";function n(i,j,d1,e1,f1){var g1={};g1={viewName:d1,controlId:j,controlAggregation:f1};var h1=i.getTargets();h1.addTarget(e1,g1);}function q(i,j){if(i.oTemplateContract.oFlexibleColumnLayoutHandler){i.oTemplateContract.oFlexibleColumnLayoutHandler.createMessagePageTargets(n.bind(null,i.oRouter,j,"sap.suite.ui.generic.template.fragments.MessagePage"));}else{n(i.oRouter,j,"sap.suite.ui.generic.template.fragments.MessagePage","messagePage","pages");}}function E(i,j,d1,e1){var f1=j[d1];if(!f1){f1={draftSpec:"OData",level:0,children:[]};for(var g1 in j){var h1=j[g1];if(h1.level===1){f1.children.push(g1);break;}}j[d1]=f1;}if(f1.hasOwnProperty("isDraft")){return;}if(f1.draftSpec==="parent"){if(f1.parent){if(f1.parent===i.entitySet){f1.isDraft=i.isDraft;}else{E(i,j,f1.parent,e1);var i1=j[f1.parent];f1.isDraft=i1.isDraft;}}else if(f1.level===1){for(var j1 in j){var k1=j[j1];if(k1.level===0){f1.isDraft=k1.isDraft;return;}}}return;}if(f1.draftSpec==="OData"){f1.isDraft=e1.isDraftEnabled(d1);return;}f1.isDraft=f1.draftSpec;}function r(i,j){var d1=i.oAppComponent.getModel();var e1=d1.getMetaModel();e1.loaded().then(function(){var f1=i.oTemplateContract.mEntityTree;var g1=i.oAppComponent.getTransactionController().getDraftController();var h1=g1.getDraftContext();var i1=i.oTemplateContract.mRoutingTree.root;i1.isDraft=h1.isDraftEnabled(j);E(i1,f1,j,h1);for(var j1 in f1){E(i1,f1,j1,h1);}});}function u(i){var j=i.oTemplateContract.oNavigationHost.getId();var d1=i.oAppComponent.getConfig();if(!d1.pages||!d1.pages.length){throw new k(s,"Route Configuration missing");}if(d1.pages.length>1){throw new k(s,"Currently only one Top route supported");}var e1=d1.pages[0];i.oTemplateContract.mEntityTree=Object.create(null);i.oTemplateContract.mRoutingTree=Object.create(null);var f1={sRouteName:"root",entitySet:e1.entitySet,page:e1,getPath:function(){return"";},level:0,fCLLevel:0,children:[],headerTitle:i.oAppComponent.getManifestEntry("sap.app").title,text:""};var g1=D([],e1,f1,null,i,j);i.oRouter.addRoute(g1);i.oTemplateContract.mRoutingTree.root=f1;z(g1,i);v("root",e1,0,f1,i,j,f1.children);q(i,j);r(i,e1.entitySet);return e1.entitySet;}function v(j,d1,e1,f1,g1,h1,i1,j1,k1){var i,l1;if(d1.pages){l1=d1.pages.length;for(i=0;i<l1;i++){y(j,d1.pages[i],e1+1,f1,g1,h1,i1,j1,k1||0);}}}function H(i,j,d1,e1,f1,g1,h1,i1,j1){var k1=e1.target;var l1={pages:j.pages};var m1={entitySet:e1.entitySet,sRouteName:e1.sRouteName,embeddedComponent:i,getPath:function(n1){if(n1===1){return e1.getPath(1)+"/"+i;}return e1.getPath(n1);},patternDelimiter:p};v(k1,l1,d1,m1,f1,g1,h1,i1,j1);}function w(i,j,d1,e1,f1,g1,h1,i1,j1,k1){var l1={};var m1={key:g1,definition:h1,componentName:h1.componentName,componentUsage:h1.componentUsage,hiddenByDefault:h1.hiddenByDefault,containerId:i1,sectionId:j1,subSectionId:k1,pages:h1.pages||[],children:[],communicationObject:l1};i.embeddedComponents[g1]=m1;if(h1.pages){H(g1,h1,j,i,d1,e1,m1.children,l1,f1);}}function x(j,d1,e1,f1,g1,h1){j.embeddedComponents=Object.create(null);j.leadingComponents=Object.create(null);j.facetsWithEmbeddedComponents=Object.create(null);if(d1.implementingComponent){w(j,e1,f1,g1,h1,"implementation",d1.implementingComponent,"template::ImplementingComponent");}else if(d1.embeddedComponents){var i1=Object.create(null);var j1=Object.create(null);var k1;var l1;var m1;for(k1 in d1.embeddedComponents){l1=d1.embeddedComponents[k1];if(!l1.leadingSectionIdOrPath||l1.leadingSectionIdOrPath===k1){i1[k1]=[k1];}else if(d1.embeddedComponents[l1.leadingSectionIdOrPath]){j1[k1]=l1.leadingSectionIdOrPath;}else{m1=j.facetsWithEmbeddedComponents[l1.leadingSectionIdOrPath];if(m1){m1.push(k1);}else{j.facetsWithEmbeddedComponents[l1.leadingSectionIdOrPath]=[k1];}}}var n1=[];for(k1 in j1){var o1=j1[k1];m1=i1[o1];if(m1){m1.push(k1);}else{n1.push(k1);delete j1[k1];}}for(var i=0;i<n1.length;i++){i1[n1[i]]=[n1[i]];}for(k1 in d1.embeddedComponents){l1=d1.embeddedComponents[k1];var p1=i1[k1]&&S.getStableId({type:"ObjectPageSection",subType:"ReuseComponentSection",sReuseComponentName:l1.componentName,sReuseComponentUsage:l1.componentUsage,sReuseComponentId:k1});var q1=S.getStableId({type:"ObjectPageSection",subType:"ReuseComponentSubSection",sReuseComponentName:l1.componentName,sReuseComponentUsage:l1.componentUsage,sReuseComponentId:k1});var r1=S.getStableId({type:"ObjectPageSection",subType:"ReuseComponentContainer",sReuseComponentName:l1.componentName,sReuseComponentUsage:l1.componentUsage,sReuseComponentId:k1});w(j,e1,f1,g1,h1,k1,l1,r1,p1,q1);}Object.keys(i1).forEach(function(o1){var s1=j.embeddedComponents[o1];j.leadingComponents[o1]={sectionId:s1.sectionId,title:s1.definition.groupTitle||s1.definition.title,followingComponents:i1[o1].map(function(t1){var u1=j.embeddedComponents[t1];u1.sectionId=s1.sectionId;return u1;})};});}}function y(i,j,d1,e1,f1,g1,h1,i1,j1){if(j.component){var k1=f1.oTemplateContract.oFlexibleColumnLayoutHandler?f1.oTemplateContract.oFlexibleColumnLayoutHandler.getMaxColumnCountInFCL():1;var l1=(k1===1)||(j.defaultLayoutType==="OneColumn")?0:j1+1;var m1={parent:e1&&e1.entitySet,parentRoute:e1?e1.sRouteName:"root",parentEmbeddedComponent:e1&&e1.embeddedComponent,entitySet:j.entitySet,navigationProperty:j.navigationProperty,level:d1,fCLLevel:l1>=k1?3:l1,children:[],communicationObject:i1,page:j,defaultLayoutType:j.defaultLayoutType,noKey:j.routingSpec&&j.routingSpec.noKey,noOData:j.routingSpec&&j.routingSpec.noOData,draftSpec:j.routingSpec?j.routingSpec.draftSpec||"parent":"OData",text:""};B(m1,e1,f1.oTemplateContract.bCreateRequestsCanonical);var n1=D(i,j,m1,e1,f1,g1);m1.sRouteName=n1.name;var o1=f1.oAppComponent.getModel();var p1=o1.getMetaModel().getODataEntitySet(j.entitySet);m1.semanticObject=p1&&p1["com.sap.vocabularies.Common.v1.SemanticObject"]&&p1["com.sap.vocabularies.Common.v1.SemanticObject"].String;if(h1){h1.push(j.entitySet);}f1.oTemplateContract.mRoutingTree[n1.name]=m1;var q1=f1.oTemplateContract.mEntityTree[j.entitySet];if(!q1||q1.level>m1.level){f1.oTemplateContract.mEntityTree[j.entitySet]=m1;}f1.oRouter.addRoute(n1);z(n1,f1);A(f1,m1,j);v(n1.target,j,d1,m1,f1,g1,m1.children,i1,l1);x(m1,j,d1,f1,g1,l1);}}function z(i,j){var d1=f({},i);d1.name=i.name+"query";d1.pattern=i.pattern+"{?query}";j.oRouter.addRoute(d1);}function A(i,j,d1){if(j.noOData){j.headerTitle=d1.routingSpec.headerTitle;j.titleIconUrl=d1.routingSpec.titleIconUrl;}else{var e1=i.oAppComponent.getModel();var f1=e1.getMetaModel();f1.loaded().then(function(){var g1=f1.getODataEntitySet(j.entitySet);var h1=f1.getODataEntityType(g1.entityType);var i1=h1["com.sap.vocabularies.UI.v1.HeaderInfo"];var j1=(i1&&i1.TypeName&&i1.TypeName.String)||"";if(j1.substr(0,7)==="{@i18n>"){var k1=j1.substring(1,j1.length-1);var l1=k1.split(">");j1=i.oAppComponent.getModel(l1[0]).getResourceBundle().getText(l1[1]);}j.headerTitle=j1;var m1=(i1&&i1.Title&&i1.Title.IconUrl&&i1.Title.IconUrl.String)||"";j.titleIconUrl=m1;});}}function B(j,d1,e1){var f1=(j.level===1||!j.page.navigationProperty)?j.page.entitySet:j.page.navigationProperty;var g1=j.noKey?"":"({keys"+j.level+"})";var h1=f1+g1;var i1=d1&&d1.getPath(1);if(i1){h1=i1+(d1.patternDelimiter||"/")+h1;}var j1;var k1;if(j.noOData){var l1=j.page.routingSpec.binding?("/"+j.page.routingSpec.binding):"";j1=d1.getPath(3)+l1;k1=d1.getPath(2)+l1;}else{j1="/"+j.entitySet+g1;k1=e1||(!j.page.navigationProperty||j.level===1)?j1:d1.getPath(2)+"/"+j.page.navigationProperty+g1;}j.getPath=function(m1,n1){var o1;switch(m1){case 1:o1=h1;break;case 2:o1=k1;break;case 3:o1=j1;break;default:}if(n1){for(var i=1;i<=j.level;i++){o1=o1.replace("{keys"+i+"}",n1[i]);}}return o1;};}function D(i,j,d1,e1,f1,g1){var h1=d1.level;var i1=Array.isArray(i)?i:[i];var j1=f({},j);j1.template=j.component?(j.component.name||j.component):j.template;switch(h1){case 0:j1.name="root";break;case 1:j1.name=j.entitySet;break;default:j1.name=e1.sRouteName+"/"+(e1.embeddedComponent?e1.embeddedComponent+"/":"")+(j.navigationProperty||j.entitySet);}var k1;var l1=j1.name;if(f1.oTemplateContract.oFlexibleColumnLayoutHandler){k1=f1.oTemplateContract.oFlexibleColumnLayoutHandler.adaptRoutingInfo(j1,l1,i1,d1);}else{k1="pages";j1.target=l1;}n(f1.oRouter,g1,j1.name,l1,k1);var m1=new Promise(function(n1){f1.mRouteToComponentResolve[j1.name]=n1;});f1.oTemplateContract.mRouteToTemplateComponentPromise[j1.name]=m1;j1.pattern=d1.getPath(1);return j1;}function I(i,j){var d1;if(!i.oHashChanger.getHash()){d1="";if(j&&j.route&&j.route.length===1){d1=j.route[0];i.navigate(d1,true);}}i.initialize();}function G(j,d1,e1,f1){var i,g1,h1,i1,j1=[],k1;g1=e1.length;for(i=0;i<g1;i++){h1=e1[i].PropertyPath;i1=f1[h1][0];j1.push(new F(h1,a.EQ,i1));}if(j.oAppComponent.getTransactionController().getDraftController().getDraftContext().isDraftEnabled(d1)){var l1=new F({filters:[new F("IsActiveEntity","EQ",false),new F("SiblingEntity/IsActiveEntity","EQ",null)],and:false});j1.push(l1);}k1=new F(j1,true);return k1;}function R(j,d1,e1){var f1="/"+d1;try{var g1=new o.Model(o.Model.ReferenceByModel(j));var h1=g1.findQueryResultByName(d1);var i1=new o.QueryResultRequest(h1);var j1=h1&&h1.getParameterization();var k1=false;if(j1){i1.setParameterizationRequest(new o.ParameterizationRequest(j1));var l1=j1.getAllParameterNames();h(l1,function(){if(e1.hasOwnProperty(this)){k1=true;i1.getParameterizationRequest().setParameterValue(this,e1[this][0]);}});for(var i=0;i<l1.length;i++){if(l1[i].startsWith("P_")){var m1=l1[i].substr(2);if(e1.hasOwnProperty(m1)){k1=true;i1.getParameterizationRequest().setParameterValue(l1[i],e1[m1][0]);}}}if(k1){f1=i1.getURIToQueryResultEntitySet();}}}catch(n1){l.info(n1.name+":"+n1.message);}return f1;}function J(i,j,d1,e1,f1){return new Promise(function(g1,h1){var i1=R(d1,i,e1);d1.read(i1,{filters:[j],success:function(j1){var k1=L(j1,d1,e1);if(k1){var l1=d1.getKey(k1);if(l1){g1({"status":"success","value":l1,"iLevel":f1});}}g1({"status":"noData"});},error:function(){g1({"status":"error"});}});});}function K(j,d1,e1,f1,g1,h1,i1){var j1=[],k1,l1,m1;var n1=new Promise(function(o1){o1({"status":"success","value":i1,"iLevel":0});});if(e1&&f1&&g1){if(h1.aNavigablePages){for(var i=0;i<h1.aNavigablePages.length;i++){if(h1.aNavigablePages&&h1.aNavigablePages[i]&&h1.aNavigablePages[i].bNavigationWithTechnicalKeyPossible){j1.push(n1);continue;}k1=h1.aNavigablePages[i];l1=G(j,k1.sEntitySet,k1.aSemanticKey,f1);m1=J(k1.sEntitySet,l1,g1,f1,k1.iLevel);j1.push(m1);}}return Promise.all(j1).then(function(o1){var p1=[""];var q1;for(var i=0;o1[i]&&o1[i].status==="success";i++){var r1=o1[i].value.split("(");p1.push(r1[1].slice(0,r1[1].length-1));q1=i===0?d1:h1.aNavigablePages[i].sEntitySet;}var s1=q1?j.oTemplateContract.mEntityTree[q1]:j.oTemplateContract.mRoutingTree.root;var t1=Object.create(null);if(j.oTemplateContract.oFlexibleColumnLayoutHandler){j.oTemplateContract.oFlexibleColumnLayoutHandler.adaptAppStatesForExternalNavigation(s1,t1);}var u1={treeNode:s1,keys:p1,appStates:t1};j.navigateToIdentity(u1,true,1).then(function(){I(j,f1);});});}}function L(d1,e1,f1){var g1,i,h1,i1;if(d1&&d1.results){h1=d1.results.length;if(h1===0){i1=null;}else if(h1===1){i1=d1.results[0];}else if(h1>=1){var j1=[];var k1=[];for(i=0;i<h1;i++){g1=d1.results[i];if(g1&&g1.IsActiveEntity){k1.push(g1);}else if(g1&&g1.IsActiveEntity===false){j1.push(g1);}}if(k1.length===0&&j1.length>=2){var l1;for(var j=0;j<j1.length;j++){l1=j1[j];if(l1.DraftUUID===(f1.DraftUUID&&f1.DraftUUID[0])){i1=l1;break;}}if(!i1){i1=j1[0];}}else if(k1.length===1&&j1.length>=1){i1=k1[0];}}}return i1;}function N(i,j){if((i&&j)||(j==="display")){return{mode:"unsupported"};}var d1={mode:"display",force:"false"};d1.mode=j||i||d1.mode;d1.force=!!j;return d1;}function O(j,d1,e1,f1,g1){var h1=f({},f1);Z(j.getMetaModel(),e1,h1);var i1=T(j,d1,e1,h1,g1);if(i1.aNavigablePages&&i1.aNavigablePages[0]&&i1.aNavigablePages[0].aSemanticKey&&i1.aNavigablePages[0].iLevel===0){K(d1,e1,i1.aNavigablePages[0].aSemanticKey,h1,j,i1);return;}else if(i1.aNavigablePages&&i1.aNavigablePages[0]&&i1.aNavigablePages[0].bNavigationWithTechnicalKeyPossible){if(f1.IsActiveEntity&&f1.IsActiveEntity[0]==="false"&&f1.DraftUUID&&f1.DraftUUID[0]!==""){var j1=[];for(var i=0;i<i1.aNavigablePages[0].aTechnicalKey.length;i++){var k1=i1.aNavigablePages[0].aTechnicalKey[i]&&i1.aNavigablePages[0].aTechnicalKey[i].name;if(k1==="DraftUUID"||k1==="IsActiveEntity"){continue;}if(h1.hasOwnProperty(k1)){j1.push({PropertyPath:k1});}}var l1=j.createKey(e1,h1);K(d1,e1,j1,h1,j,i1,l1);return;}var l1=j.createKey(e1,h1);if(l1){var j1=[];for(var i=0;i<i1.aNavigablePages[0].aTechnicalKey.length;i++){var k1=i1.aNavigablePages[0].aTechnicalKey[i]&&i1.aNavigablePages[0].aTechnicalKey[i].name;if(k1==="DraftUUID"||k1==="IsActiveEntity"){continue;}if(h1.hasOwnProperty(k1)){j1.push({PropertyPath:k1});}}K(d1,e1,j1,h1,j,i1,l1);return;}}I(d1,f1);}function P(j,d1){var i,e1,f1=false,g1,h1;if(d1&&j){e1=j.length;for(i=0;i<e1;i++){f1=true;g1=j[i];h1=g1.name||g1.PropertyPath;if(!d1[h1]||d1[h1].length>1){f1=false;break;}}}return f1;}function Q(j,d1,e1,f1,g1,h1,i1){var j1,k1,l1,m1,n1,o1,p1;for(var i=0;i<f1.length;i++){o1=f1[i];if(o1&&o1.navigation&&o1.navigation[e1.mode]){continue;}var q1=i1&&g1===0?i1:o1.entitySet;k1=j.getMetaModel().getODataEntitySet(q1);l1=o1.component&&o1.component.settings&&o1.component.settings.allowDeepLinking;if(!k1||!(g1===0||l1)){continue;}m1=j.getMetaModel().getODataEntityType(k1.entityType);n1=m1["com.sap.vocabularies.Common.v1.SemanticKey"];j1={};p1={};if(n1&&P(n1,d1)){j1["sEntitySet"]=q1;j1["aSemanticKey"]=n1;j1["sNavigationProperty"]=o1.navigationProperty;j1["iLevel"]=g1;h1.push(j1);}else if(m1.key.propertyRef&&(g1===0)&&P(m1.key.propertyRef,d1)){p1.bNavigationWithTechnicalKeyPossible=P(m1.key.propertyRef,d1);p1.aTechnicalKey=m1.key.propertyRef;h1.push(p1);}if(o1.pages){Q(j,d1,e1,o1.pages,++g1,h1);}else{break;}}return h1;}function T(i,j,d1,e1,f1){var g1={},h1=[],i1=[];var j1=j.oAppComponent.getConfig();h1=j1.pages&&j1.pages[0]&&j1.pages[0].pages;if(!h1){return{};}i1=Q(i,e1,f1,h1,0,i1,d1);g1.aNavigablePages=i1;return g1;}function U(i){var j=i.oAppComponent.getModel("_templPrivGlobal");j.setProperty("/generic/forceFullscreenCreate",true);}function V(d1,e1,f1){var g1,h1,i1,j1,k1,l1,i,m1,j,n1,o1;if(g(f1)){return;}g1=d1&&d1.getMetaModel();h1=g1&&g1.getODataEntitySet(e1);i1=h1&&h1.entityType;j1=g1&&g1.getODataEntityType(i1);k1=j1&&j1.property;l1=[];o1=k1&&k1.length;for(i=0;i<o1;i++){m1=k1[i];if(m1["type"]==="Edm.Guid"){l1.push(m1["name"]);}}for(j=0;j<l1.length;j++){if(!f1[l1[j]]){continue;}n1=f1[l1[j]][0];n1=n1.toLowerCase().replace(/(guid')([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})(')/,"$2");if(!n1.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/)){n1=n1.replace(/([0-9a-f]{8})([0-9a-f]{4})([0-9a-f]{4})([0-9a-f]{4})([0-9a-f]{12})/,"$1-$2-$3-$4-$5");}f1[l1[j]][0]=n1;}}function W(i){var j=i.oAppComponent.getInboundParameters();return j?Object.keys(j).filter(function(d1){return j[d1].useForCreate;}):[];}function Y(j,d1){var e1;var f1=W(j);for(var i=0;i<f1.length;i++){var g1=f1[i];var h1=d1[g1];if(h1&&h1.length===1){e1=e1||Object.create(null);e1[g1]=h1[0];}}return e1;}function Z(i,j,d1){var e1=i.getODataEntityType(i.getODataEntitySet(j).entityType);e1.property.forEach(function(f1){if(f1["com.sap.vocabularies.Common.v1.EditableFieldFor"]){var g1=f1["com.sap.vocabularies.Common.v1.EditableFieldFor"].PropertyPath||f1["com.sap.vocabularies.Common.v1.EditableFieldFor"].String;var h1=f1.name;if(d1[g1]&&!d1[h1]){d1[h1]=d1[g1];}if(d1[h1]&&!d1[g1]){d1[g1]=d1[h1];}}});}function $(j,d1,e1){var f1=j.oAppComponent.getConfig();var g1=j.oAppComponent.getModel();g1.attachMetadataFailed(j.fnInitializationResolve);V(g1,d1,e1);var h1=e1.preferredMode&&e1.preferredMode[0];var i1=e1.mode&&e1.mode[0];var j1=N(h1,i1);a1(j,d1,e1).then(function(k1){d1=k1;switch(j1.mode){case"create":U(j);var l1=(f1.pages[0]&&f1.pages[0].component&&f1.pages[0].component.settings&&f1.pages[0].component.settings.creationEntitySet);d1=l1||d1;var m1=Y(j,e1);var n1=j.oAppComponent.getTransactionController().getDraftController();var o1=n1.getDraftContext().isDraftEnabled(d1);var p1=I.bind(null,j,e1);if(o1){var q1=b.create(n1,d1,"/"+d1,g1,j.oTemplateContract.oApplicationProxy,m1);q1.then(function(i){var r1=Object.create(null);if(j.oTemplateContract.oFlexibleColumnLayoutHandler){var s1=j.oTemplateContract.mEntityTree[d1];j.oTemplateContract.oFlexibleColumnLayoutHandler.adaptAppStatesForExternalNavigation(s1,r1);}j.navigateToSubContext(i,true,4,null,r1).then(p1);},function(i){p1();j.navigateToMessagePage({title:j.oTemplateContract.getText("ST_GENERIC_ERROR_TITLE"),text:i.messageText,description:"",icon:"sap-icon://message-error"});});j.oTemplateContract.oBusyHelper.setBusy(q1,true);}else{var r1=Object.create(null);if(j.oTemplateContract.oFlexibleColumnLayoutHandler){var s1=j.oTemplateContract.mEntityTree[d1];j.oTemplateContract.oFlexibleColumnLayoutHandler.adaptAppStatesForExternalNavigation(s1,r1);}j.navigateForNonDraftCreate(d1,m1,null,r1).then(p1);}break;case"createWithContext":U(j);var t1=new Promise(function(y1,z1){var A1=function(H1){z1();I(j,e1);j.navigateToMessagePage({title:j.oTemplateContract.getText("ST_ERROR"),text:(H1&&H1.messageText)||j.oTemplateContract.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),icon:"sap-icon://message-error",description:""});};var B1=g1.getMetaModel().getODataEntitySet(d1);var C1=B1["com.sap.vocabularies.Common.v1.DraftRoot"];if(C1&&C1.NewAction){var D1=g1.getMetaModel().getODataFunctionImport(C1.NewAction.String.split("/")[1]);var E1={};if(D1){var F1=D1.parameter?D1.parameter.length:0;for(var i=0;i<F1;i++){var G1=D1.parameter[i];if(G1.mode==="In"&&e1[G1.name]&&e1[G1.name][0]){E1[G1.name]=e1[G1.name][0];}}g1.callFunction("/"+D1.name,{success:function(H1,I1){var J1=new M(g1);var K1=J1.getContextFromResponse(H1);if(K1){y1();j.navigateToContext(K1,null,true,4).then(I.bind(null,j,e1));}else{A1();}},error:A1,method:"POST",urlParameters:E1});}else{A1();}}else{A1();}});j.oTemplateContract.oBusyHelper.setBusy(t1,true);break;case"edit":var u1=f({},e1);Z(g1.getMetaModel(),d1,u1);var v1=T(g1,j,d1,u1,j1);if(v1.aNavigablePages&&v1.aNavigablePages[0]&&(v1.aNavigablePages[0].bNavigationWithTechnicalKeyPossible||(v1.aNavigablePages[0].aSemanticKey&&v1.aNavigablePages[0].iLevel===0))){var w1="";var x1;if(v1.aNavigablePages[0].bNavigationWithTechnicalKeyPossible){w1=g1.createKey(d1,u1);x1=b.edit(j.oAppComponent.getTransactionController(),d1,"/"+w1,g1,j.oTemplateContract,j.fnInitializationResolve);}else if(v1.aNavigablePages&&v1.aNavigablePages[0]&&v1.aNavigablePages[0].aSemanticKey&&v1.aNavigablePages[0].iLevel===0){w1="";x1=b.edit(j.oAppComponent.getTransactionController(),d1,w1,g1,j.oTemplateContract,j.fnInitializationResolve,v1.aNavigablePages[0].aSemanticKey,u1);}x1.then(function(i){var r1=Object.create(null);if(j.oTemplateContract.oFlexibleColumnLayoutHandler){var s1=j.oTemplateContract.mEntityTree[d1];j.oTemplateContract.oFlexibleColumnLayoutHandler.adaptAppStatesForExternalNavigation(s1,r1);}j.navigateToSubContext(i.context,true,2,null,r1).then(function(){I(j);});},function(i){if(i.lockedByUser){if(!j1.force){O(g1,j,d1,e1,j1);}else{j.fnInitializationResolve();j.navigateToMessagePage({title:j.oTemplateContract.getText("LOCKED_OBJECT_POPOVER_TITLE"),text:j.oTemplateContract.getText("LOCKED_OBJECT_POPOVER_TITLE"),description:j.oTemplateContract.getText("ST_GENERIC_LOCKED_OBJECT_POPOVER_TEXT",[i.lockedByUser]),icon:"sap-icon://message-error",replaceURL:true});}}else if(i.draftAdminReadResponse){I(j,e1);}else{var y1=j.oTemplateContract.getText("ST_GENERIC_ERROR_NOT_AUTORIZED_EDIT");d.warning(y1,{onClose:function(z1){O(g1,j,d1,e1,{mode:"display",force:false});}});}});}else{I(j,e1);}break;case"display":O(g1,j,d1,e1,j1);break;default:j.fnInitializationResolve();j.navigateToMessagePage({title:j.oTemplateContract.getText("ST_GENERIC_ERROR_TITLE"),text:j.oTemplateContract.getText("ST_GENERIC_ERROR_TITLE"),description:j.oTemplateContract.getText("PARAMETER_COMBINATION_NOT_SUPPORTED",[i1,h1]),icon:"sap-icon://message-error",replaceURL:true});}});}function _(i){var j=i.oAppComponent.getFlexibleColumnLayout();if(j){i.oTemplateContract.oFlexibleColumnLayoutHandler=new c(i.oTemplateContract.oNavigationHost,i);}var d1=X.create({viewName:"sap.suite.ui.generic.template.fragments.TemplateHost"}).then(function(g1){i.createHostView=function(){return g1.clone();};});var e1=i.oAppComponent.getModel();var f1=Promise.all([d1,e1.getMetaModel().loaded()]);f1.then(function(){var g1=u(i);var h1=i.oAppComponent.getComponentData();var i1=h1&&h1.startupParameters;if(g1&&i1&&!i.oHashChanger.getHash()){$(i,g1,i1);}else{I(i);}});}function a1(j,d1,e1){return new Promise(function(f1){var g1=d1;var h1=j.oTemplateContract.mRoutingTree.root.children;var i1=j.getParsedShellHashFromFLP();i1.then(function(j1){var k1=j1.parseShellHash(document.location.hash);for(var i=0;i<h1.length;i++){if(k1.semanticObject===j.oTemplateContract.mEntityTree[h1[i]].semanticObject){g1=h1[i];break;}}f1(g1);});});}function b1(i,j){var d1,e1,f1;d1=i.getPath().substring(1);e1=d1.split("(");f1=e1.shift();var g1=e1.join("(");var h1=g1.substring(0,g1.length-1);if(j){d1=d1.replace(f1,j);if(d1.indexOf("/")===0){d1=d1.substring(1);}}return{entitySet:f1,path:d1,key:h1};}function c1(){return m;}var u=t.testableStatic(u,"routingHelpergenerateRoutingMetadataAndGetRootEntitySet");var I=t.testableStatic(I,"routingHelper_initialiseRouting");var K=t.testableStatic(K,"routingHelper_readObject");var $=t.testableStatic($,"routingHelper_processStartupParameters");var V=t.testableStatic(V,"routingHelper_transformStartupGuidParameters");return{startupRouter:_,determineNavigationPath:b1,readObjectProcessResults:L,getCrossAppNavService:c1};});
