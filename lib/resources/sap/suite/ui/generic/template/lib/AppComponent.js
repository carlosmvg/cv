/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/UIComponent","sap/m/NavContainer","sap/f/FlexibleColumnLayout","sap/ui/model/base/ManagedObjectModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/odata/MessageScope","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/generic/app/ApplicationController","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/BusyHelper","sap/suite/ui/generic/template/lib/DataLossHandler","sap/suite/ui/generic/template/lib/NavigationController","sap/suite/ui/generic/template/lib/ProcessObserver","sap/suite/ui/generic/template/lib/TemplateAssembler","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/suite/ui/generic/template/lib/FeLogger","sap/base/util/extend","sap/base/util/isPlainObject","sap/suite/ui/generic/template/lib/FeError"],function(U,N,F,M,a,b,c,J,R,A,d,B,D,e,P,T,C,V,t,f,g,h,j,k){"use strict";var s="lib.AppComponent";var l=new g(s).getLogger();A=t.observableConstructor(A);var m=sap.m.DraftIndicatorState;var r=T.getRegisterAppComponent();var o;function n(){o=o||new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return o.getText.apply(o,arguments);}function p(){return new P({processObservers:[]});}var q=sap.ui.getCore().getMessageManager().getMessageModel();var v=new a({path:"validation",operator:b.EQ,value1:true});function u(w,x){var y={oAppComponent:w,ghostapp:!!(w.getManifestEntry("sap.ui.generic.app").settings||{}).ghostapp,componentRegistry:Object.create(null),aRunningSideEffectExecutions:[],getText:n,mRouteToTemplateComponentPromise:Object.create(null),oTemplatePrivateGlobalModel:(new J()).setDefaultBindingMode("TwoWay"),aStateChangers:[],oPaginatorInfo:Object.create(null),oStatePreserversAvailablePromise:Promise.resolve(),oValidationMessageBinding:q.bindList("/",null,null,v)};y.oDataLossHandler=new D(y);y.oValidationMessageBinding.attachChange(Function.prototype);var z;var E;var G;function H(){var i=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");y.oTemplatePrivateGlobalModel.setProperty("/generic",{crossAppNavSupport:!!i&&i.isIntentUrl(document.URL),draftIndicatorState:m.Clear,shellServiceUnavailable:false,forceFullscreenCreate:false});w.setModel(y.oTemplatePrivateGlobalModel,"_templPrivGlobal");y.oShellServicePromise.catch(function(){y.oTemplatePrivateGlobalModel.setProperty("/generic/shellServiceUnavailable",true);});var q=sap.ui.getCore().getMessageManager().getMessageModel();w.setModel(q,"_templPrivMessage");}function I(){y.fnAddSideEffectPromise=function(j1){var i=0;for(;y.aRunningSideEffectExecutions[i];){i++;}y.aRunningSideEffectExecutions[i]=j1;var k1=function(){y.aRunningSideEffectExecutions[i]=null;};j1.then(k1,k1);};z.attachEvent("beforeSideEffectExecution",function(i){if(i.getParameter("valueChange")||i.getParameter("fieldControl")){var j1=i.getParameter("promise");setTimeout(y.oBusyHelper.setBusy.bind(null,j1),1000);y.fnAddSideEffectPromise(j1);}});var h1=w.getModel("_templPrivGlobal");var i1="/generic/draftIndicatorState";z.attachBeforeQueueItemProcess(function(i){if(i.draftSave){h1.setProperty(i1,m.Saving);}});z.attachOnQueueCompleted(function(){if(h1.getProperty(i1)===m.Saving){h1.setProperty(i1,m.Saved);}});z.attachOnQueueFailed(function(){if(h1.getProperty(i1)===m.Saving){h1.setProperty(i1,m.Clear);}});h1.setProperty("/generic/appComponentName",w.getMetadata().getComponentName());}function K(){var i={appComponent:w,oTemplateContract:y,application:new d(y),oViewDependencyHelper:new V(y)};y.oViewDependencyHelper=i.oViewDependencyHelper;y.oShellServicePromise=w.getService("ShellUIService").catch(function(){var k1=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.ShellUIService");return((k1&&k1.createInstance())||Promise.reject());});y.oShellServicePromise.catch(function(){l.warning("No ShellService available");});var h1=c1().settings||Object.create(null);w.applySettings(h1);(U.prototype.init||Function.prototype).apply(w,arguments);y.appSettings=new M(w);y.oBusyHelper.setBusy(y.oShellServicePromise);G=r(i);var i1=w.getModel();y.bCreateRequestsCanonical=true;var j1=i1.messageScopeSupported();y.oBusyHelper.setBusy(j1);j1.then(function(k1){if(k1){i1.setMessageScope(c.BusinessObject);y.bCreateRequestsCanonical=false;}z=new A(i1);H();E=new e(y);I();C.enableAutomaticDraftSaving(y);if((!i1.oMetadata||!i1.oMetadata.isLoaded())||i1.oMetadata.isFailed()){i1.attachMetadataFailed(function(){E.navigateToMessagePage({title:n("ST_GENERIC_ERROR_TITLE"),text:n("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE"),icon:"sap-icon://message-error",description:n("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC")});for(var l1 in y.componentRegistry){y.componentRegistry[l1].fnViewRegisteredResolve(true);}});}if(w&&w.getMetadata()&&w.getMetadata().getManifest()){f.setAppComponent(w);}f.setApplicationStatus(f.mApplicationStatus.LOADING);f.publishEvent("elements","ViewRenderingStarted",{});});}function L(){if(y.oNavigationHost){return"";}if(y.sRoutingType==="f"){var i=new F();y.oNavigationHost=i;y.aNavigationObservers=[new P({processName:"BeginColumnNavigation",eventHandlers:{attachProcessStart:i.attachBeginColumnNavigate.bind(i),attachProcessStop:i.attachAfterBeginColumnNavigate.bind(i)}}),new P({processName:"MidColumnNavigation",eventHandlers:{attachProcessStart:i.attachMidColumnNavigate.bind(i),attachProcessStop:i.attachAfterMidColumnNavigate.bind(i)}}),new P({processName:"EndColumnNavigation",eventHandlers:{attachProcessStart:i.attachEndColumnNavigate.bind(i),attachProcessStop:i.attachAfterEndColumnNavigate.bind(i)}})];y.oNavigationObserver=new P({processObservers:y.aNavigationObservers});y.aHeaderLoadingObservers=[p(),p(),p()];}else{var h1=new N({id:w.getId()+"-appContent"});y.oNavigationHost=h1;y.oNavigationObserver=new P({processName:"Navigation",eventHandlers:{attachProcessStart:h1.attachNavigate.bind(h1),attachProcessStop:h1.attachAfterNavigate.bind(h1)}});}y.oHeaderLoadingObserver=new P({processObservers:y.aHeaderLoadingObservers||[]});y.oPagesDataLoadedObserver=new P({processObservers:[y.oHeaderLoadingObserver,y.oNavigationObserver]});y.oNavigationHost.addStyleClass(y.oApplicationProxy.getContentDensityClass());y.oBusyHelper=new B(y);y.oBusyHelper.setBusyReason("HashChange",true,true);y.oBusyHelper.getUnbusy().then(function(){y.oShellServicePromise.then(function(i1){i1.setBackNavigation(y.oApplicationProxy.onBackButtonPressed);});});return y.oNavigationHost;}function O(){y.ghostapp=true;if(y.oNavigationHost){y.oNavigationHost.destroy();}if(z){z.destroy();}if(E){E.destroy();}if(y.oValidationMessageBinding){y.oValidationMessageBinding.destroy();}f.setAppComponent(null);(U.prototype.exit||Function.prototype).apply(w,arguments);G();t.endApp(x);}function Q(){y.ghostapp=true;y.oNavigationControllerProxy.suspend();}function S(){y.ghostapp=false;y.oNavigationControllerProxy.restore();}function W(i){var h1=Object.keys(i).map(function(i1){var j1=i[i1];if(j1.pages){j1.pages=W(j1.pages);}return i[i1];});return h1;}function X(b1){if(b1._version==="1.3.0"&&b1.pages&&j(b1.pages)){b1.pages=W(b1.pages);}}function Y(h1,i1){if(!h1){return;}for(var i=0;i<h1.length;i++){var j1=h1[i];if(j1.routingSpec&&j1.routingSpec.noOData){j1.entitySet=j1.routingSpec.routeName;if(i1>1){j1.navigationProperty=j1.routingSpec.routeName;}}Y(j1.pages,i1+1);if(j1.embeddedComponents){for(var k1 in j1.embeddedComponents){var l1=j1.embeddedComponents[k1];if(l1.pages){l1.pages=W(l1.pages);Y(l1.pages,i1+1);}}}if(j1.implementingComponent&&j1.implementingComponent.pages){j1.implementingComponent.pages=W(j1.implementingComponent.pages);Y(j1.implementingComponent.pages,i1+1);}}}function Z(b1){Y(b1.pages,0);}function $(i){if(i){var h1=i.entitySet;var i1=(i.component&&i.component.settings&&i.component.settings.quickVariantSelectionX&&i.component.settings.quickVariantSelectionX.variants)||{};var j1=function(i1){for(var k1 in i1){var l1=i1[k1];if(l1.entitySet){return true;}}return false;};if(j1(i1)){for(var k1 in i1){var l1=i1[k1];if(l1.entitySet===undefined){l1.entitySet=h1;}}}}}function _(b1){$(b1.pages[0]);}function a1(i){if(i&&i.objectPageDynamicHeaderTitleWithVM){i.objectPageHeaderType=i.objectPageHeaderType||"Dynamic";i.objectPageVariantManagement=i.objectPageVariantManagement||"VendorLayer";}}var b1;function c1(){if(!b1){var i=w.getMetadata();b1=i.getManifestEntry("sap.ui.generic.app");if(!b1){return Object.create(null);}X(b1);Z(b1);_(b1);a1(b1.settings);}return b1;}var d1;function e1(){if(!d1){d1=h({},w.getMetadata().getManifest());d1["sap.ui.generic.app"]=c1();}return d1;}function f1(){var i=w.getFlexibleColumnLayout();y.sRoutingType=i?"f":"m";return"sap."+y.sRoutingType+".routing.Router";}var g1={init:K,createContent:L,exit:O,suspend:Q,restore:S,_getRouterClassName:f1,getConfig:c1,getInternalManifest:e1,getTransactionController:function(){return z.getTransactionController();},getApplicationController:function(){return z;},getNavigationController:function(){return E;}};var X=t.testable(X,"fnNormalizePagesMapToArray");c1=t.testable(c1,"getConfig");return g1;}return U.extend("sap.suite.ui.generic.template.lib.AppComponent",{metadata:{config:{title:"SAP UI Application Component",fullWidth:true},properties:{forceGlobalRefresh:{type:"boolean",defaultValue:true},considerAnalyticalParameters:{type:"boolean",defaultValue:false},showDraftToggle:{type:"boolean",defaultValue:false},objectPageHeaderType:{type:"string",defaultValue:"Static"},objectPageVariantManagement:{type:"string",defaultValue:"None"},flexibleColumnLayout:{type:"object",defaultValue:null},inboundParameters:{type:"object",defaultValue:null},tableColumnVerticalAlignment:{type:"string",defaultValue:"Middle"},useColumnLayoutForSmartForm:{type:"boolean",defaultValue:true}},events:{pageDataLoaded:{}},routing:{config:{async:true,viewType:"XML",viewPath:"",clearTarget:false},routes:[],targets:[]},library:"sap.suite.ui.generic.template"},suppressDataLossPopup:function(){return false;},constructor:function(){var i=t.startApp();h(this,u(this,i));(U.prototype.constructor||Function.prototype).apply(this,arguments);}});});
