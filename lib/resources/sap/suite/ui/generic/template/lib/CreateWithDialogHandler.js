sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/base/util/extend","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/lib/CRUDHelper"],function(B,S,M,e,t,C){"use strict";function g(s,c,T){var d,o;function G(){return{"aFilters":[{sPath:"fullTarget",sOperator:"StartsWith",oValue1:d.getBindingContext().getPath()},{sPath:"target",sOperator:"EQ",oValue1:"/"+c.getOwnerComponent().getEntitySet()}]};}function r(){var i=G(d);var m=sap.ui.getCore().getMessageManager().getMessageModel();if(i){var j=m.bindList("/",null,null,[i]);var k=j.getContexts();if(k.length){var E=[];for(var l in k){E.push(k[l].getObject());}sap.ui.getCore().getMessageManager().removeMessages(E);}}}function f(){d.close();if(T.oComponentUtils.isDraftEnabled()){T.oServices.oCRUDManager.discardDraft(d.getBindingContext());}else{r(d);c.getView().getModel().deleteCreatedEntry(d.getBindingContext());}d.setBindingContext(null);}function a(E){var m=false;var i=sap.ui.getCore().getMessageManager().getMessageModel().getData();m=i.some(function(n){return n.type==="Error"&&n.validation;});if(!m&&T.oComponentUtils.isDraftEnabled()){var j=T.oComponentUtils.getCRUDActionHandler();j.handleCRUDScenario(1,A);}else if(!m){T.oCommonEventHandlers.submitChangesForSmartMultiInput();var F=G(d);var k=T.oServices.oCRUDManager.saveEntity(F);k.then(function(){d.close();if(s&&s.oSmartTable){T.oCommonUtils.refreshModel(s.oSmartTable);T.oCommonUtils.refreshSmartTable(s.oSmartTable);}else{T.oCommonUtils.refreshModel(o);T.oCommonUtils.refreshSmartTable(o);M.showSuccessMessageIfRequired(T.oCommonUtils.getContextText("ITEM_CREATED",o.getId()),T.oServices);}r(d);d.setBindingContext(null);});var l={saveEntityPromise:k};T.oComponentUtils.fire(c,"AfterSave",l);}}function A(){var i=T.oServices.oCRUDManager.activateDraftEntity(d.getBindingContext());i.then(function(R){if(R&&R.response&&R.response.statusCode==="200"){d.close();d.setBindingContext(null);M.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_SAVED"),T.oServices);T.oCommonUtils.refreshSmartTable(s.oSmartTable);}},Function.prototype);var E={activationPromise:i};T.oComponentUtils.fire(c,"AfterActivate",E);}function b(i,E){d=i;var j=s.oSmartFilterbar;o=T.oCommonUtils.getOwnerControl(E);o=T.oCommonUtils.isSmartTable(o)?o:o.getParent();if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.addEntry(E,false,j,false,false,true).then(function(k){T.oServices.oApplication.registerContext(k);d.setBindingContext(k);d.open();});}else{var n=T.oServices.oApplication.createNonDraft(o.getEntitySet());d.setBindingContext(n);d.open();}}function h(i,E){d=i;o=T.oCommonUtils.getOwnerControl(E);o=T.oCommonUtils.isSmartTable(o)?o:o.getParent();if(!T.oComponentUtils.isDraftEnabled()){var n=C.createNonDraft(o.getParent().getBindingContext(),o.getTableBindingPath(),d.getModel());var D=T.oCommonUtils.getContextText("CREATE_DIALOG_TITLE",o.getId());var m=new sap.ui.model.json.JSONModel();m.setProperty("/title",D);d.setModel(m,"localModel");d.setBindingContext(n);d.open();}}var A=t.testable(A,"fnActivateImpl");var r=t.testable(r,"fnRemoveOldMessageFromModel");var G=t.testable(G,"fnGetFilterForCurrentState");return{onCancelPopUpDialog:f,onSavePopUpDialog:a,createWithDialog:b,createWithDialogInOP:h};}return B.extend("sap.suite.ui.generic.template.lib.CreateWithDialogHandler",{constructor:function(s,c,T){e(this,g(s,c,T));}});});
