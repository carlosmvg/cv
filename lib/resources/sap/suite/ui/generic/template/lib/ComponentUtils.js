sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/lib/FeLogger","sap/suite/ui/generic/template/js/AnnotationHelper","sap/suite/ui/generic/template/lib/CRUDActionHandler","sap/base/util/extend","sap/base/util/isEmptyObject","sap/suite/ui/generic/template/lib/FeError"],function(B,F,A,C,e,a,b){"use strict";var c="lib.ComponentUtils";var l=new F(c).getLogger();var d={isPreliminary:function(){return false;}};function g(o,f){var t=f.oTemplateContract.mRoutingTree[f.route];var h;var H;var j;var k;var m;var I=false;var L;var n=[];var N=false;var E=[];function p(){return o.getModel("_templPriv");}function q(){return t.level;}function r(){return f.preprocessorsData;}function s(){var i=r();if(i&&i.rootContextExpand){return i.rootContextExpand.join(',');}}function u(){return f.oParameterModel;}function v(i,I1,J1){if(typeof J1!=="function"){throw new b(c,"Event handler must be a function");}E.push({template:i,event:I1,handler:J1});}function D(I1,J1,K1){for(var i=E.length;i--;){if(E[i].handler===K1&&E[i].event===J1&&E[i].template===I1){E.splice(i,1);}}}function w(I1,J1,K1){for(var i=0;i<E.length;i++){if(E[i].event===J1&&E[i].template===I1){E[i].handler(K1);}}}function x(i){return i.getMetadata().getName();}function y(){return f.oApplication.isComponentActive(o);}function z(){return f.oNavigationObserver.getProcessFinished(true);}function P(i,I1){var J1=z();J1.then(function(){if(y()){if(I1){Y(true);}w(x(f.oController),"PageDataLoaded",{context:i});if(r1()){var K1=i.getObject();if(!K1.IsActiveEntity){f.oApplication.getDraftSiblingPromise(i);}}}});}function G(){h.then(function(i){if(i){P(i);}});}function S(){f.oHeaderLoadingObserver.startProcess();if(!m){var i=new Promise(function(I1){m=I1;});f.oApplication.getBusyHelper().setBusy(i);}}function J(){if(!H){h=new Promise(function(i){H=i;});}}if(t.getPath(3)){J();}else{h=Promise.resolve();}function K(i){l.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;J();if(!o.getComponentContainer().getElementBinding().isSuspended()){S();}}function M(){if(m){m();m=null;}f.oHeaderLoadingObserver.stopProcess();}function O(i){var I1=i.getSource().getBoundContext();if(I1){return I1;}if(o.getComponentContainer().getElementBinding().isSuspended()){I1=null;}else{I1=d;}W();return I1;}function Q(){f.oTemplateContract.oNavigationControllerProxy.navigationContextNotFound();}function R(){I=false;if(!k){return;}if(k===d){Q();W();}else if(!o.getComponentContainer().getElementBinding().isSuspended()){var i=o.getBindingContext();var I1=i1(i);var J1=I1.bIsDraft||N;var K1;if(J1){N=false;K1=I1.bIsCreate?4:2;}else{K1=1;}var L1=p();L1.setProperty("/objectPage/displayMode",K1);var M1=o.getModel("ui");M1.setProperty("/enabled",true);M1.setProperty("/createMode",I1.bIsCreate);M1.setProperty("/editable",J1);(f.methods.updateBindingContext||Function.prototype)(i);if(H){H(k);}}else{return;}H=null;k=null;}function T(i){l.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");j();M();if(I){k=O(i);}R();}function U(i){j();var I1=O(i);if(I1&&I1.isPreliminary()){return;}k=I1;R();f.oHeaderLoadingObserver.stopProcess();}function V(i){var I1={createPreliminaryContext:true,canonicalRequest:!f.oTemplateContract.bCreateRequestsCanonical};var J1=r();if(J1.rootContextExpand&&J1.rootContextExpand.length){I1.expand=s();}f.oHeaderLoadingObserver.startProcess();var K1=new Promise(function(L1){j=L1;});J();if(f.methods.beforeRebind){f.methods.beforeRebind(K1);}k=null;o.getComponentContainer().bindElement({path:i,events:{dataRequested:K,dataReceived:T,change:U},parameters:I1,batchGroupId:"Changes",changeSetId:"Changes"});L=i;if(f.methods.afterRebind){f.methods.afterRebind();}}function W(){J();var i=o.getComponentContainer();i.unbindElement();i.setBindingContext();L=null;k=null;I=false;M();}function X(){var I1=l1();var J1=(I1.length===n.length);for(var i=0;i<I1.length&&J1;i++){J1=I1[i]===n[i];}n=I1;return!J1;}function Y(i){f.reuseComponentsReady.then(function(I1){for(var J1 in I1){I1[J1].pathUnchangedCallBack(i);}});}function Z(i,I1){var J1=Object.create(null);for(var K1 in i){var L1=i[K1];J1[K1]=I1(L1,K1);}return J1;}function $(){var i=p();for(var I1 in t.embeddedComponents){var J1=!!t.embeddedComponents[I1].definition.hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+I1+"/hidden",J1);}}function _(i,I1){var J1=X();if(J1&&!I1){$();}if(!i){if(f.routingSpec&&f.routingSpec.noOData){P(null,J1);}return;}var K1=o.getComponentContainer();if(!K1){return;}var L1=o.getModel("ui");var M1=!!f.nonDraftCreateContext;if(M1){var N1=K1.getBindingContext();if(N1===f.nonDraftCreateContext){return;}L1.setProperty("/enabled",true);L1.setProperty("/editable",true);L1.setProperty("/createMode",true);W();if(H){H(f.nonDraftCreateContext);H=null;}else{h=Promise.resolve(f.nonDraftCreateContext);}G();K1.setBindingContext(f.nonDraftCreateContext);Promise.all([f.oViewRenderedPromise,f.viewRegistered]).then(Y.bind(null,true));}else{var O1=K1.getElementBinding();if(O1){if(L===i){if(O1.isSuspended()){O1.resume();R();}if(I){S();}f.oApplication.getBusyHelper().getUnbusy().then(Y.bind(null,J1&&f.routingSpec.noOData));if(!I1){G();}if(!I1&&!r1()){L1.setProperty("/editable",false);}L1.setProperty("/enabled",true);return;}else if(!I1){W();}}L1.setProperty("/enabled",false);L1.setProperty("/editable",false);L1.setProperty("/createMode",false);V(i);G();}}function a1(i,I1){var J1={};if(i){J1.discardPromise=i;}var K1=o.getModel();if(K1.hasPendingChanges()){var L1=f.oController.getView();L1.setBindingContext(null);K1.resetChanges();L1.setBindingContext();}var M1=o.getModel("ui");if(I1||M1.getProperty("/editable")){delete f.nonDraftCreateContext;M1.setProperty("/editable",false);if(i){i.catch(function(){M1.setProperty("/editable",true);});}else{var N1=p();N1.setProperty("/objectPage/displayMode",1);}w(x(f.oController),"AfterCancel",J1);}}function b1(i,I1){return r1()?null:f.oTemplateContract.oNavigationControllerProxy.navigateForNonDraftCreate(i,I1);}function c1(i,I1){N=I1;f.oTemplateContract.oNavigationControllerProxy.adaptUrlAfterNonDraftCreateSaved(i);}function d1(){var i=o.getComponentContainer().getElementBinding();if(i){o.getModel().invalidateEntry(i.getBoundContext());if(i.isSuspended()){W();}else{i.refresh(true);}}}function e1(i){i=i||o.getIsRefreshRequired();if(i||!a(f.mRefreshInfos)){(f.methods.refreshBinding||Function.prototype)(i,f.mRefreshInfos);o.setIsRefreshRequired(false);f.mRefreshInfos=Object.create(null);}Y(i);}function f1(){var i=o.getModel();var I1={canonicalRequest:!f.oTemplateContract.bCreateRequestsCanonical,batchGroupId:"facets",updateAggregatedMessages:true};i.read(L,I1);}function g1(i){if(r1()){var I1=o.getComponentContainer();var J1=I1.getElementBinding();if(J1&&!J1.isSuspended()){J1.suspend();i.catch(function(){J1.resume();});}}}function h1(){var i=o.getComponentContainer();if(f.nonDraftCreateContext){i.setBindingContext();delete f.nonDraftCreateContext;return;}var I1=i.getElementBinding();if(I1&&!I1.isSuspended()){if(f.oTemplateContract.oValidationMessageBinding.getLength()){W();}else{I1.suspend();}M();}}function i1(i){var I1=q();return f.oApplication.registerContext(i,I1,o.getEntitySet());}function j1(i){if(i.level<2){return[i.entitySet];}var I1=f.oTemplateContract.mRoutingTree[i.parentRoute];var J1=j1(I1);if(i!==t){J1.push(i.navigationProperty?J1[I1.level-1]+"/"+i.navigationProperty:i.entitySet);}return J1;}function k1(){return t.level<2?[]:j1(t);}function l1(){return f.oApplication.getCurrentKeys(q());}function m1(i){return f.oApplication.getCommunicationObject(o,i);}function n1(i,I1,J1,K1){f.oTemplateContract.oNavigationControllerProxy.navigateToChild(t,i,J1,I1,K1);}function o1(i,I1,J1){f.oTemplateContract.oNavigationControllerProxy.navigateFromNodeAccordingToContext(t,i,I1,J1);}function p1(){return t.headerTitle;}function q1(i){f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function r1(){return t.isDraft;}function s1(){return!(f.routingSpec&&f.routingSpec.noOData);}function t1(){return!f.oTemplateContract.bCreateRequestsCanonical;}function u1(){return h;}function v1(){return f.oTemplateContract.oPaginatorInfo[q()-1];}function w1(i,I1){var J1=q();if(!I1){J1--;}f.oTemplateContract.oPaginatorInfo[J1]=i;}function x1(i,I1){f.reuseComponentsReady.then(function(J1){var K1=I1.getComponentInstance();for(var L1 in J1){if(K1===J1[L1].component){var M1=p();M1.setProperty("/generic/embeddedComponents/"+L1+"/isInVisibleArea",i);return;}}});}function y1(i){i.oStatePreserverPromise=f.reuseComponentsReady.then(function(I1){var J1={appStateName:encodeURI("sap-iapp-state-"+t.entitySet),getCurrentState:function(){var L1=i.getCurrentState?i.getCurrentState():Object.create(null);var M1=function(N1,O1){if(N1.component.stGetCurrentState){var P1=N1.component.stGetCurrentState();for(var Q1 in P1){L1["$embeddedComponent$"+O1.length+"$"+O1+"$"+Q1]=P1[Q1];}}};Z(I1,M1);return L1;},applyState:function(L1,M1){var N1=Object.create(null);var O1=Object.create(null);for(var P1 in L1){if(P1.indexOf("$embeddedComponent$")===0){var Q1=P1.substring(19);var R1=Q1.indexOf("$");var S1=Number(Q1.substring(0,R1));var T1=Q1.substring(R1+1,R1+S1+1);var U1=O1[T1];if(!U1){U1=Object.create(null);O1[T1]=U1;}var V1=Q1.substring(R1+S1+2);U1[V1]=L1[P1];}else{N1[P1]=L1[P1];}}(i.applyState||Function.prototype)(N1,M1);var W1=function(X1,Y1){if(X1.component.stApplyState){X1.component.stApplyState(O1[Y1]||Object.create(null),M1);}};Promise.all([f.oViewRenderedPromise,h]).then(Z.bind(null,I1,W1));},oComponent:o};var K1=f.oApplication.getStatePreserver(J1);f.oApplication.registerStateChanger(K1.getAsStateChanger());return K1;});f.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([f.oTemplateContract.oStatePreserversAvailablePromise,i.oStatePreserverPromise]);}function z1(){var i=f.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:Function.prototype,isListAndFirstEntryLoadedOnStartup:t.level?null:Function.prototype,isNextObjectLoadedAfterDelete:Function.prototype};}function A1(){return t.page.component.settings||{};}function B1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var I1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.controllerExtensions"];I1=I1&&I1[o.getTemplateName()];I1=I1&&I1["sap.ui.generic.app"];return I1&&I1[o.getEntitySet()];}function C1(i){f.aUnsavedDataCheckFunctions=f.aUnsavedDataCheckFunctions||[];f.aUnsavedDataCheckFunctions.push(i);}function D1(I1,J1){if(f.methods.getTableForChildContext){var K1=p();var L1=K1.getProperty("/generic/currentActiveChildContext");var M1=L1&&f.methods.getTableForChildContext(L1);if(M1){var N1=M1.getTable();if(f.oControllerUtils.oCommonUtils.isMTable(N1)){var O1=N1.getItems();for(var i=0;i<O1.length;i++){var P1=O1[i];if(P1.getBindingContextPath()===L1){N1.scrollToIndex(i);break;}}}}}}var E1;function F1(){E1=E1||new C(f.oTemplateContract,f.oController,f.oControllerUtils.oCommonUtils);return E1;}function G1(i){if(f.methods.executeAfterInvokeActionFromExtensionAPI){f.methods.executeAfterInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function H1(i){if(f.methods.executeBeforeInvokeActionFromExtensionAPI){f.methods.executeBeforeInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}return{getBusyHelper:function(){return f.oApplication.getBusyHelper();},attach:function(i,I1,J1){v(x(i),I1,J1);},detach:function(i,I1,J1){D(x(i),I1,J1);},fire:function(i,I1,J1){w(x(i),I1,J1);},isListReportTemplate:function(){return A.isListReportTemplate(f.routeConfig);},getPreprocessorsData:r,getRootExpand:s,getParameterModelForTemplating:u,bindComponent:_,cancelEdit:a1,getNonDraftCreatePromise:b1,adaptUrlAfterNonDraftCreateSaved:c1,refreshBinding:e1,refreshBindingUnconditional:d1,suspendBinding:h1,messagesRefresh:f1,getTemplatePrivateModel:p,registerContext:i1,getViewLevel:q,getBreadCrumbInfo:k1,getCurrentKeys:l1,getCommunicationObject:m1,navigateRoute:n1,navigateAccordingToContext:o1,getTitle:p1,setText:q1,onBeforeDraftTransfer:g1,isDraftEnabled:r1,isODataBased:s1,getNoStateMessagesForTables:t1,isComponentActive:y,navigateToDataLoadedFailedPage:Q,getHeaderDataAvailablePromise:u1,getPaginatorInfo:v1,setPaginatorInfo:w1,onVisibilityChangeOfReuseComponent:x1,getNavigationFinishedPromise:z,setStatePreserverPromise:y1,unbind:W,getFclProxy:z1,getSettings:A1,getExtensions:B1,registerUnsavedDataCheckFunction:C1,layoutChanged:D1,getCRUDActionHandler:F1,executeAfterInvokeActionFromExtensionAPI:G1,executeBeforeInvokeActionFromExtensionAPI:H1};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(o,f){e(this,g(o,f));}});});
