sap.ui.define(["sap/ui/core/Control","sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiTagController","sap/suite/ui/generic/template/AnalyticalListPage/util/KpiUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/KpiAnnotationHelper","sap/suite/ui/generic/template/AnalyticalListPage/util/AnnotationHelper","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/ui/comp/odata/ODataModelUtil","sap/suite/ui/generic/template/AnalyticalListPage/control/KpiProvider","sap/ui/Device","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/model/Filter","sap/ui/model/json/JSONModel","sap/ui/core/Locale","sap/m/ResponsivePopover","sap/m/MessageStrip","sap/ui/core/format/NumberFormat","sap/m/library","sap/ui/core/library","sap/suite/ui/generic/template/lib/FeLogger","sap/m/GenericTag","sap/m/ObjectNumber","sap/ui/events/KeyCodes"],function(C,K,a,b,A,F,V,O,c,D,S,d,J,L,R,M,N,e,f,g,G,h,l){"use strict";var o=new g("AnalyticalListPage.control.SmartKpiTag");var m=o.getLogger();var n=o.Level;var T="Target",p="Maximize",q="Minimize";return G.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.SmartKpiTag",{metadata:{designTime:true,interfaces:["sap.m.IOverflowToolbarContent"],properties:{entitySet:{type:"string",defaultValue:"",bindable:false},qualifier:{type:"string",defaultValue:"",bindable:false},modelName:{type:"string",defaultValue:undefined,bindable:false},groupId:{type:"string",defaultValue:"AlpKpiGroup",bindable:false},smartFilterId:{type:"string",defaultValue:undefined,bindable:false},shortDescription:{type:"string",defaultValue:"",bindable:"bindable"},enabled:{type:"boolean",defaultValue:true,bindable:false},error:{type:"boolean",defaultValue:false,bindable:false},errorType:{type:"sap.ui.core.MessageType",defaultValue:f.MessageType.Error},errorMessage:{type:"string",defaultValue:"",bindable:"bindable"},kpivalue:{type:"string",defaultValue:"",bindable:"bindable"},kpiunit:{type:"string",defaultValue:"",bindable:"bindable"},indicator:{type:"sap.m.ValueColor",defaultValue:undefined}},events:{beforeRebindFilterableKPI:{}}},renderer:{},_isPercent:false,_unScaledValue:"",_sUnitofMeasure:"",_relativeToProperties:[],_bStopDataLoad:true,bSearchTriggred:false,init:function(){m.setLevel(n.WARNING,this);},_initCompositeSupport:function(s){a.addToKpiList(s,this);},propagateProperties:function(){C.prototype.propagateProperties.apply(this,arguments);this._initialiseMetadata();},_initialiseMetadata:function(){O.handleModelInit(this,this._onMetaDataInit);},_setDeferredGroups:function(){if(!this._oModel){return;}var i=this._oModel.getDeferredGroups();var s=this.getGroupId();if(i.indexOf(s)<0){i.push(s);this._oModel.setDeferredGroups(i);}},_onMetaDataInit:function(){var s=this.getModelName();if(!s){this._oModel=this.getModel();}else{this._oModel=this.getModel(s);}this._setDeferredGroups();this._oModel.getMetaModel().loaded().then(function(){this.kpiProvider=new c(this);if(!this.kpiProvider){this._kpiErrorHandler({},false);this._updateKpiList(true);return;}this.kpiSettings=this.kpiProvider.getConfig();if(!this.kpiSettings){m.error("KPI Error details: incorrect KPI configuration");this._updateKpiList(true);return;}var i=this.getSmartFilterId();if(i){if(i&&!this._oSmartFilter){this._oSmartFilter=this._findControl(i);this._oSmartFilter.attachSearch(function(E){this.bSearchTriggred=true;this._createFilterableKpi();}.bind(this));this._oSmartFilter.attachFilterChange(function(E){if(!this._oSmartFilter.isLiveMode()&&!this._oSmartFilter.isDialogOpen()){this.setEnabled(false);}}.bind(this));if(this._oSmartFilter.isInitialised()){this._createFilterableKpi();}else{this._oSmartFilter.attachInitialized(this._createFilterableKpi,this);}}}else{this._createGlobalKpi();}}.bind(this));},_handleFilterableKpiInGoMode:function(E){var i=true;if(!this._oSmartFilter.isLiveMode()){if(!this.bSearchTriggred){this.setProperty('visible',false);i=false;}else{var j=this.getProperty('errorMessage');if(j!=="KPI_AUTHORIZATION_ISSUE"&&j!=="KPI_DEFAULT_PV_ERROR_MESSAGE"){this.setProperty('visible',true);}}}return i;},_createFilterableKpi:function(E){if(!this._handleFilterableKpiInGoMode(E)){return;}try{this._updateKpiList(false);this.setBusy(true);this.setBusyIndicatorDelay(0);var I=false;if(this.getEntitySet()===this._oSmartFilter.getEntitySet()){I=true;if(!F.checkManditoryFieldsFilled(this._oSmartFilter)){this._mandatoryfieldsErrorHandler(false,false,true);return;}}var r=this.kpiSettings,s=r.selectOptions,P=A.resolveParameterStringValue(r.parameters),u=this._oSmartFilter.getUiState(),U=u.getProperty("selectionVariant"),t=U?U.SelectOptions:undefined,v=U?U.Parameters:undefined,w=this._oSmartFilter.getFilterData(true),x=new S(U),y=new S(),z=[],B,H,Q,W,X=false,Y,Z,$=this._oModel.getMetaModel(),_=$.getODataEntitySet(this.getEntitySet()),a1=$.getODataEntityType(_.entityType),b1=r.entitySet["Org.OData.Capabilities.V1.FilterRestrictions"],c1=b1["RequiredProperties"];if(t){for(var i=0;i<t.length;i++){H=t[i].PropertyName;Q=t[i].Ranges;var d1=$.getODataProperty(a1,H),e1=d1&&F.isPropertyNonFilterable(_,d1.name);if(e1||F.isPropertyHidden(d1)){continue;}if(d1){if(Q){for(var k=0;k<Q.length;k++){if(Q[k].Sign==="I"||Q[k].Sign==="E"){if(Q[k].Low!==undefined){W=a.getFilter(Q[k],t[i],H);if(this._checkKPIMandatoryFields(c1,H)){if(!W.value1){this._mandatoryfieldsErrorHandler(false,false,true);return;}}if(d1!==null&&d1['type']==="Edm.DateTime"){if(W.value1&&!(W.value1.indexOf('Z')===(W.value1.length-1))){W.value1=W.value1.split('T')[0]+"T00:00:00Z";}if(W.value2&&!(W.value2.indexOf('Z')===(W.value2.length-1))){W.value2=W.value2.split('T')[0]+"T00:00:00Z";}}y.addSelectOption(W.path,W.sign,W.operator,W.value1,W.value2);}}}}}}}if(v){for(var i=0;i<v.length;i++){Y=v[i];H=Y.PropertyName;Z=Y.PropertyValue;var f1=b.checkMandatoryParameter(this._oModel,_,H);if(f1){if(!Z){this._mandatoryfieldsErrorHandler(false,false,true);return;}}if(Z!==y.getParameter(H)){if(H&&Z&&(Z!=="")){var g1=b.checkParameterizedEntitySet(this._oModel,_,H);if(g1){if(b.checkForDateTimeParameter(this._oModel,this.getEntitySet(),H)){if(Z&&!(Z.indexOf('Z')===(Z.length-1))){Z=Z.split('T')[0]+"T00:00:00Z";}}y.addParameter(H,Z);}}}}}if(s){for(var i=0;i<s.length;i++){B=s[i];H=B.PropertyName.PropertyPath;Q=B.Ranges;var d1=$.getODataProperty(a1,H),e1=d1&&F.isPropertyNonFilterable(_,d1.name);if(e1){continue;}if(d1&&w&&w[H]===undefined){X=true;if(!y.getSelectOption(H)){for(var k=0;k<Q.length;k++){if(Q[k].Sign.EnumMember===V.SelectionRangeSignType+"/I"||Q[k].Sign.EnumMember===V.SelectionRangeSignType+"/E"){if(Q[k].Low!==undefined){W=a.getFilter(Q[k],B);if(this._checkKPIMandatoryFields(c1,H)){if(!W.value1){this._mandatoryfieldsErrorHandler(true,false,false);return;}}y.addSelectOption(W.path,W.sign,W.operator,W.value1,W.value2);}}}}}}}if(P){for(var i=0;i<P.length;i++){Y=P[i];H=Y.PropertyName&&Y.PropertyName.PropertyPath;Z=x.getParameter(H)||Y.PropertyValue.String;var f1=b.checkMandatoryParameter(this._oModel,_,H);if(f1){if(!Z){this._mandatoryfieldsErrorHandler(true,false,false);return;}}if(w&&w["$Parameter."+H]===undefined){X=true;if(!y.getParameter(H)){if(H&&Z&&(Z!=="")){y.addParameter(H,Z);}}}}}if(!I||!X){if(!F.checkManditoryFieldsFilled(this._oSmartFilter)){this._mandatoryfieldsErrorHandler(false,false,true);return;}}this.fireBeforeRebindFilterableKPI({selectionVariant:y,entityType:_.entityType});var h1=y.getSelectOptionsPropertyNames();for(var i=0;i<h1.length;i++){B=y.getSelectOption(h1[i]);for(var j=0;j<B.length;j++){Q=B[j];if(Q.Sign==="I"||Q.Sign==="E"){if(Q.Low!==undefined){W=a.getFilter(Q,null,h1[i]);z.push(new d(W));}}}}this._filterableKPISelectionVariant=y;var i1=b.resolveParameterizedEntitySet(this._oModel,r.entitySet,y);this._applyFiltersToKpi.apply(this,[y,z,i1]);}catch(j1){this._updateKpiList(true);m.error("KPI Error details: "+j1);}},_createGlobalKpi:function(){try{this._updateKpiList(false);this.setBusy(true);this.setBusyIndicatorDelay(0);var k=this.kpiSettings;var s=k.selectOptions,r,t,u=[];if(s){for(var i=0;i<s.length;i++){r=s[i];for(var j=0;j<r["Ranges"].length;j++){t=r["Ranges"][j];if(t.Low){u.push(new d(a.getFilter(t,r)));}}}}var P=b.resolveParameterizedEntitySet(this._oModel,k.entitySet,k.selectionVariant);this._applyFiltersToKpi.apply(this,[k.selectionVariant,u,P]);}catch(E){this._updateKpiList(true);m.error("KPI Error details: "+E);}},_applyFiltersToKpi:function(s,i,P){this._relativeToProperties=[];var j=this.kpiSettings;var k=j.dataPoint,r;var t=this.getGroupId();this._getCriticalityRefProperties(k);this._oConfig={path:P,filterable:this.getSmartFilterId()?true:false,properties:{value:j.props.value,valueFormat:j.dataPoint.ValueFormat,title:j.props.title,unitOfMeasure:j.props.unitOfMeasure,isInteger:j.dataPoint.Value&&F.isInteger(j.dataPoint.Value.EdmType)?true:false}};this._oConfig.properties.shortDescription=j.props.shortDescription;this._checkForPercent(this._oConfig.properties.unitOfMeasure);if(this._relativeToProperties.length!==0){r=(this._relativeToProperties.indexOf(this._oConfig.properties.value)===-1)?[this._oConfig.properties.value].concat(this._relativeToProperties).join(","):this._relativeToProperties;}else{r=[this._oConfig.properties.value];}if(this._oConfig){this._oModel.read(this._oConfig.path,{async:true,filters:i,urlParameters:{"$select":r,"$top":1},success:this._kpiSuccessHandler.bind(this),error:this._kpiErrorHandler.bind(this),groupId:t});}if(this.getSmartFilterId()){this._updateKpiList(!this._bStopDataLoad);}else{this._updateKpiList(true);}},_updateKpiList:function(P){Promise.resolve().then(function(){this._updateKpiListAsync(P);}.bind(this));},_updateKpiListAsync:function(P){var s=this.getGroupId();a.updateKpiList(this,P);if(!P){return;}var k=a.getKpiList(this.getModelName(),s);for(var i in k){if(!k[i].bProcessed){return;}}this._oModel.submitChanges({groupId:s});},_checkKPIMandatoryFields:function(k,P){if(k&&P){for(var i=0;i<k.length;i++){if(k[i].PropertyPath===P){return true;}}}},_mandatoryfieldsErrorHandler:function(i,I,j){this._kpiErrorHandler({},i,I,j);this._updateKpiList(true);},_checkKpiCriticality:function(){var i=this.kpiSettings;var j=i.dataPoint;var k;i.criticalityNotDefined=false;if(i.criticality){if(i.criticality.criticalityPath){k=i.criticality.criticalityPath;this._oConfig.criticality={criticalityPath:i.criticality.criticalityPath};}else if(i.criticality.criticalityType){k=this._getCriticalityFromEnum(i.criticality.criticalityType);this._oConfig.criticality={criticalityType:i.criticality.criticalityType};}}else if(i.criticalityCalculation){var I=i.criticalityCalculation.improveDirection,t=i.criticalityCalculation.toleranceHigh,s=i.criticalityCalculation.toleranceLow,r=i.criticalityCalculation.deviationLow,u=i.criticalityCalculation.deviationHigh;var v=[];if(this.getError()||(this.getSmartFilterId()&&this._checkCriticalityCalculationForNumber(j.CriticalityCalculation,I))){this._mCriticalityIndicator="None";}else{v.push(this._getPathForIndicatorParts(t));v.push(this._getPathForIndicatorParts(s));v.push(this._getPathForIndicatorParts(r));v.push(this._getPathForIndicatorParts(u));v.push({path:"/"+i.props.value});k={parts:v,formatter:function(w,x,y,z,B){var E=x?x:s,H=w?w:t,P=y?y:r,Q=z?z:u;E=E&&Number(E);H=H&&Number(H);P=P&&Number(P);Q=Q&&Number(Q);B=B&&Number(B);return this._getImproveDirection(E,H,P,Q,B);}.bind(this)};this._oConfig.criticalityCalculation={improveDirection:i.criticalityCalculation.improveDirection,toleranceLow:i.criticalityCalculation.toleranceLow,toleranceHigh:i.criticalityCalculation.toleranceHigh,deviationLow:i.criticalityCalculation.deviationLow,deviationHigh:i.criticalityCalculation.deviationHigh};}}else{i.criticalityNotDefined=true;}this._oConfig.criticalityProps={criticalityIndicator:k,relativeProperties:this._relativeToProperties};},_getCriticalityRefProperties:function(i){var j=i.CriticalityCalculation;var k=i.Criticality;if(k&&k.Path&&this._relativeToProperties.indexOf(k.Path)===-1){this._relativeToProperties.push(k.Path);}else if(j){if(j.DeviationRangeLowValue&&j.DeviationRangeLowValue.Path&&this._relativeToProperties.indexOf(j.DeviationRangeLowValue.Path)===-1){this._relativeToProperties.push(j.DeviationRangeLowValue.Path);}if(j.DeviationRangeHighValue&&j.DeviationRangeHighValue.Path&&this._relativeToProperties.indexOf(j.DeviationRangeHighValue.Path)===-1){this._relativeToProperties.push(j.DeviationRangeHighValue.Path);}if(j.ToleranceRangeLowValue&&j.ToleranceRangeLowValue.Path&&this._relativeToProperties.indexOf(j.ToleranceRangeLowValue.Path)===-1){this._relativeToProperties.push(j.ToleranceRangeLowValue.Path);}if(j.ToleranceRangeHighValue&&j.ToleranceRangeHighValue.Path&&this._relativeToProperties.indexOf(j.ToleranceRangeHighValue.Path)===-1){this._relativeToProperties.push(j.ToleranceRangeHighValue.Path);}}},_kpiSuccessHandler:function(i,r){this.setProperty("error",false);this.setProperty("errorMessage","");if((this.kpiProvider.kpiConfig.bIsKpiAnnotaion&&!this.kpiProvider.kpiConfig.hasOwnProperty("navigation"))||this.kpiProvider.kpiConfig.oDefaultPV===false){this._kpiErrorHandler(r);}try{var k=i.results[0];if(!k){throw"no data";}}catch(E){this.setProperty("errorType",f.MessageType.Warning);var j=this.getModel("i18n").getResourceBundle();this.setProperty('errorMessage',j.getText("KPI_NO_DATA"));m.warning("KPI error details: "+j.getText("KPI_NO_DATA"));return this._kpiErrorHandler(r,false,true,false);}this.setBusy(false);this._checkKpiCriticality();var s=new J();s.setData(k);this.setModel(s);this._setKpiName();this._setKpiValue();this._setKpiIndicator();this._setKpiStatus(this.getIndicator());this._setTooltipForKPI();if(!this.getEnabled()){this.setEnabled(true);}},_setKpiValue:function(){var v=new h({number:{path:"/"+this._oConfig.properties.value,formatter:function(s){this._isPercent=this._oConfig.properties.isPercent;this._unScaledValue=N.getFloatInstance({maxFractionDigits:2,groupingEnabled:true,showScale:false},new L(sap.ui.getCore().getConfiguration().getLanguage())).format(s);return this._oConfig.properties.isPercent?a.formatNumberForPresentation(s,this._getNumberOfFractionalDigits(),true):a.formatNumberForPresentation(s,this._getNumberOfFractionalDigits());}.bind(this)}});if(this._oConfig.properties.unitOfMeasure){(this._oConfig.properties.unitOfMeasure.hasOwnProperty("Path"))?v.bindProperty("unit",{path:"/"+this._oConfig.properties.unitOfMeasure.Path}):v.setProperty("unit",this._oConfig.properties.unitOfMeasure.String||this._oConfig.properties.unitOfMeasure);}this.setValue(v);},_setKpiStatus:function(i){switch(i){case"Good":this.setStatus("Success");this.getValue().setState("Success");break;case"Error":this.setStatus("Error");this.getValue().setState("Error");break;case"Critical":this.setStatus("Warning");this.getValue().setState("Warning");break;default:this.setStatus("None");this.getValue().setState("None");break;}this.setDesign("StatusIconHidden");},_kpiErrorHandler:function(r,i,I,j){this._resetKpiValue();var k=this.getModel("i18n").getResourceBundle();if(r.statusCode==="401"||r.statusCode==="403"||r.authorizationError){this.setProperty('visible',false);this.setProperty('errorMessage',k.getText("KPI_AUTHORIZATION_ISSUE"));m.warning("KPI error details: "+k.getText("KPI_AUTHORIZATION_ISSUE"));return;}if(this.kpiProvider.kpiConfig.oDefaultPV===false){this.setProperty('visible',false);this.setProperty('errorMessage',k.getText("KPI_DEFAULT_PV_ERROR_MESSAGE"));m.warning("KPI error details: "+k.getText("KPI_DEFAULT_PV_ERROR_MESSAGE"));return;}if(i){this.setProperty('errorMessage',k.getText("REQUIRED_VH_FIELDS_OVERLAY_MESSAGE"));m.error("KPI error details: "+k.getText("REQUIRED_VH_FIELDS_OVERLAY_MESSAGE"));this.setStatus("Error");}else if(j){this.setProperty("errorType",f.MessageType.Information);this.setProperty('errorMessage',k.getText("KPI_INFO_FOR_MISSING_MANDATE_FILTPAR"));m.info("KPI error details: "+k.getText("KPI_INFO_FOR_MISSING_MANDATE_FILTPAR")," ",this);this.setStatus("Information");}else if(this.kpiProvider.kpiConfig.bIsKpiAnnotaion&&!this.kpiProvider.kpiConfig.hasOwnProperty("navigation")){m.warning("KPI error details: "+k.getText("KPI_DRILLDOWN_NAVIGATION_MESSAGE"));this.setStatus("Warning");if(!I){return;}}this.setBusy(false);if(!i&&!this.getProperty("errorMessage")){this.setProperty('errorMessage',k.getText("KPI_GENERIC_ERROR_MESSAGE"));this.setStatus("Error");}if(r&&r.statusCode&&r.message){m.error("KPI error details: "+r.statusCode+" "+r.message);}this._setKpiName();this.setProperty('error',true);if(!this.getEnabled()){this.setEnabled(true);}},_resetKpiValue:function(){this.setValue(new h({number:"",unit:""}));this._isPercent=false;this._unScaledValue="";},_setKpiIndicator:function(){if(this._oConfig&&this._oConfig.criticalityProps){var i=this._oConfig.criticalityProps.criticalityIndicator;if(typeof i==="string"){this.setIndicator(i);}else if(typeof i==="object"){this.bindProperty("indicator",i);}}this.setDesign("StatusIconHidden");},_checkCriticalityCalculationForNumber:function(i,I){if(I===p){if((i.DeviationRangeLowValue&&!i.DeviationRangeLowValue.Path)||(i.ToleranceRangeLowValue&&!i.ToleranceRangeLowValue.Path)){return true;}}else if(I===q){if((i.DeviationRangeHighValue&&!i.DeviationRangeHighValue.Path)||(i.ToleranceRangeHighValue&&!i.ToleranceRangeHighValue.Path)){return true;}}else if(I===T){if((i.ToleranceRangeLowValue&&!i.ToleranceRangeLowValue.Path)||(i.ToleranceRangeHighValue&&!i.ToleranceRangeHighValue.Path)){return true;}}},_setKpiName:function(){if(!this.kpiSettings||!this.kpiSettings.props||!this.kpiSettings.props.title){return this.setProperty("shortDescription","");}var i=this.kpiSettings.props.title;if(i===undefined||typeof i!=="string"){i="";}var k=this._oConfig&&this._oConfig.properties.shortDescription?this._oConfig.properties.shortDescription:i;if(k){if(k.indexOf(">")>0){this.bindProperty("shortDescription",{path:k,formatter:function(v){return this._getKpiTagTitle(v);}.bind(this)});}else{this.setProperty("shortDescription",this._getKpiTagTitle(k));}}this.setText(this.getShortDescription());},_getPathForIndicatorParts:function(v){if(Number(v)||!v){return{path:"/dummy"};}return v;},_getKpiTagTitle:function(i){return this.getShortDescription()?this.getShortDescription():this._getNameFromHeuristic(i);},_getCriticalityFromEnum:function(s){return this.kpiProvider.getCriticalityFromEnum(s);},_getNumberOfFractionalDigits:function(){var i=0;if(!this._oConfig.properties.isInteger){i=this._oConfig.properties.valueFormat&&this._oConfig.properties.valueFormat.NumberOfFractionalDigits.Int;if(i!=0){i=1;}}return i;},_getImproveDirection:function(s,i,j,k,v){return this.kpiProvider.getImproveDirection(s,i,j,k,v);},_onMouseClick:function(E){if(this.kpiSettings){this._displayKpiErrorPopOverOrCard(E);}else{m.error("KPI error details - Incorrect KPI configuration. Unable to open card");}},_displayKpiErrorPopOverOrCard:function(E){if(this.getError()){if(this._oPopoverDialog){this._oPopoverDialog.getContent()[0].setProperty("text",this.getProperty("errorMessage"));this._oPopoverDialog.getContent()[0].mAggregations._text.setProperty("text",this.getProperty("errorMessage"));this._oPopoverDialog.getContent()[0].setProperty("type",this.getProperty("errorType"));this._oPopoverDialog.openBy(this);}else{this._oPopoverDialog=this._getResponsivePopOver(this.getErrorMessage());this._oPopoverDialog.openBy(this);}}else{K.openKpiCard(E);}},_getResponsivePopOver:function(t){if(this._oPopoverDialog){return this._oPopoverDialog;}var s=D.system.phone?true:false;var r=new R({showHeader:s,placement:e.PlacementType.Auto,content:[new M({text:t,showIcon:true,type:this.getProperty("errorType")})]}).addStyleClass("sapSmartTemplatesAnalyticalListPageErrorPopOver");r.setShowCloseButton(s);return r;},_onKeyUp:function(E){if(this.kpiSettings&&E.which===l.ENTER||E.which===l.SPACE){this._displayKpiErrorPopOverOrCard(E);}else{m.error("KPI error details - Incorrect KPI configuration. Unable to open card");}},_checkForPercent:function(u){if(u&&u.hasOwnProperty("String")){this._oConfig.properties.unitOfMeasure=(u.String)?u.String:"";}if(u&&u.hasOwnProperty("Path")&&this._relativeToProperties.indexOf(u.Path)===-1){this._relativeToProperties.push(u.Path);}this._oConfig.properties.isPercent=(u&&u.hasOwnProperty("String"))?(u.String==="%"):false;},_getNameFromHeuristic:function(s){var i=s.split(/\s/);return i.length===1?this._getNameFromSingleWordHeuristic(s):this._getNameFromMultiWordHeuristic(i);},_getNameFromSingleWordHeuristic:function(w){return w.substr(0,3).toUpperCase();},_getNameFromMultiWordHeuristic:function(w){var i=[];i.push(w[0].charAt(0));i.push(w[1].charAt(0));if(w.length>=3){i.push(w[2].charAt(0));}return i.join("").toUpperCase();},getFilterableKPISelectionVariant:function(){return this._filterableKPISelectionVariant;},_findControl:function(i){var r,v;if(i){r=sap.ui.getCore().byId(i);if(!r){v=this._getView();if(v){r=v.byId(i);}}}return r;},_getView:function(){if(!this._oView){var i=this.getParent();while(i){if(i instanceof sap.ui.core.mvc.View){this._oView=i;break;}i=i.getParent();}}return this._oView;},exit:function(){this._relativeToProperties=[];},getToolTipForUndefinedIndicator:function(){if(this.kpiSettings.criticalityNotDefined){return"NONE";}else{return"NEUTRAL";}},_setTooltipForKPI:function(){var k=this.getValue();if(k===null){return;}var t=(this._isPercent)?k.getNumber()+" "+k.getUnit():this._unScaledValue+" "+k.getUnit();var i=this.getIndicator();var s="KPI_TOOLTIP_"+(i?i.toUpperCase():this.getToolTipForUndefinedIndicator());var r=this.getModel("i18n").getResourceBundle();var j;var u=r.getText(s,[(this.kpiSettings&&this.kpiSettings.props?this.kpiSettings.props.title:""),t]);if(this.kpiSettings&&this.kpiSettings.props){j=this.kpiSettings.props.title;}if(j&&j.indexOf(">")>0){this.bindProperty("tooltip",{path:j,formatter:function(v){this._oConfig.properties.title=v;this.kpiSettings.props.title=v;return r.getText(s,[v,t]);}.bind(this)});}else{this.setTooltip(u);}if(this.getError()){s=this.getErrorType()=="Error"?"KPI_DETERMINING_ERROR":"KPI_DETERMINING_WARNING";}this._ariaLabel=r.getText(s,[(this.kpiSettings&&this.kpiSettings.props?this.kpiSettings.props.title:""),t]);},onAfterRendering:function(){setTimeout(function(){this.detachBrowserEvent("click",this._onMouseClick).attachBrowserEvent("click",this._onMouseClick);this.detachBrowserEvent("keyup",this._onKeyUp).attachBrowserEvent("keyup",this._onKeyUp);}.bind(this),1);},getSmartKpiConfig:function(){return this._oConfig;},getOverflowToolbarConfig:function(){return{canOverflow:true};},setShortDescription:function(v){this.setProperty("shortDescription",this._getNameFromHeuristic(v));},setEnabled:function(v){this.setProperty("enabled",v,true);if(v){this.removeStyleClass("sapSmartTemplatesAnalyticalListPageKpiTagDisable");}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageKpiTagDisable");}}});},true);
