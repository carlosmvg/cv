// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","sap/ushell/utils","sap/ushell/ApplicationType","sap/m/MessagePopover","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/thirdparty/URI","sap/ushell/EventHub","sap/ui/core/Icon","sap/ushell/System","sap/ushell/User","sap/m/Text","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/util/uid","sap/base/security/encodeXML","sap/ushell/utils/testableHelper","sap/ushell/Config","sap/ushell/resources"],function(D,u,A,M,C,a,b,U,E,I,S,c,T,d,f,g,h,t,j,r){"use strict";var p="sap.ushell.components.container.",s=p+"ApplicationContainer",k="sap.ushell.Container.dirtyState.",l,o,H,R,P=false,K=false,m=[],n=0;var q=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-defaultedParameterNames","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url"];function v(e){var i=sap.ushell.Container.getService("CrossApplicationNavigation");i.isUrlSupported(e.url).done(function(){e.promise.resolve({"allowed":true,"id":e.id});}).fail(function(){e.promise.resolve({"allowed":false,"id":e.id});});}function w(e){var i={"asyncURLHandler":l1.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(i);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(w);l=new u.Map();function x(e){return l.get(e.getId());}function y(){return o;}function z(e){var i=new d(e).mParams,m1=i["sap-xapp-state"],n1;delete i["sap-xapp-state"];n1={startupParameters:i};if(m1){n1["sap-xapp-state"]=m1;}return n1;}function B(e,i){if(!R){R=jQuery.sap.resources({url:jQuery.sap.getModulePath(p)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return R.getText(e,i);}function F(){return new I({size:"2rem",src:"sap-icon://error",tooltip:l1.prototype._getTranslatedText("an_error_has_occured")});}function G(e){var i=e.getAggregation("child"),m1;if(i instanceof a){m1=i.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");jQuery.sap.log.debug("unloading component "+m1,null,s);}e.destroyAggregation("child");}function J(e,i,m1){var n1,o1,p1,q1,r1,s1,t1,u1={},v1,w1;p1=i.indexOf("?");if(p1>=0){s1=l1.prototype._getParameterMap(i);u1=s1.startupParameters;i=i.slice(0,p1);}if(i.slice(-1)!=="/"){i+="/";}if(/\.view\.(\w+)$/i.test(m1)){r1=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(m1);if(!r1){jQuery.sap.log.error("Invalid SAPUI5 URL",m1,s);return l1.prototype._createErrorControl();}t1=r1[1];v1=r1[2];w1=r1[3].toUpperCase();if(t1){v1=t1+"."+v1;}else{q1=v1.lastIndexOf(".");if(q1<1){jQuery.sap.log.error("Missing namespace",m1,s);return l1.prototype._createErrorControl();}t1=v1.slice(0,q1);}}else{t1=m1.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(t1,i+t1.replace(/\./g,"/"));l1.prototype._destroyChild(e);if(v1){if(e.getApplicationConfiguration()){u1.config=e.getApplicationConfiguration();}o1=sap.ui.view({id:e.getId()+"-content",type:w1,viewData:u1||{},viewName:v1});e.fireEvent("applicationConfiguration");}else{jQuery.sap.log.debug("loading component "+t1,null,s);var x1=s1?{startupParameters:s1.startupParameters}:{startupParameters:{}};if(s1&&s1["sap-xapp-state"]){x1["sap-xapp-state"]=s1["sap-xapp-state"];}if(e.getApplicationConfiguration()){x1.config=e.getApplicationConfiguration();}n1=sap.ui.component({id:e.getId()+"-component",componentData:x1,name:t1});e.fireEvent("applicationConfiguration",{"configuration":n1.getMetadata().getConfig()});o1=new a({id:e.getId()+"-content",component:n1});}o1.setWidth(e.getWidth());o1.setHeight(e.getHeight());o1.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",o1,true);return o1;}function L(e,i){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,i);},0);}function N(e,i,m1){var n1,o1,p1,q1,r1={startupParameters:{}},s1,t1=e.getComponentHandle(),u1=sap.ushell.Container.getService("PluginManager"),v1,w1;u.addTime("createUi5Component");n1=i.indexOf("?");if(n1>=0){q1=l1.prototype._getParameterMap(i);r1={startupParameters:q1.startupParameters};if(q1["sap-xapp-state"]){r1["sap-xapp-state"]=q1["sap-xapp-state"];}i=i.slice(0,n1);}if(e.getApplicationConfiguration()){r1.config=e.getApplicationConfiguration();}if(i.slice(-1)!=="/"){i+="/";}l1.prototype._destroyChild(e);s1={id:e.getId()+"-component",name:m1,componentData:r1};jQuery.sap.log.debug("Creating component instance for "+m1,JSON.stringify(s1),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:m1});if(t1){o1=t1.getInstance(s1);}else{jQuery.sap.registerModulePath(m1,i);jQuery.sap.log.error("No component handle available for '"+m1+"'; fallback to component.load()",null,s);o1=sap.ui.component({id:e.getId()+"-component",name:m1,componentData:r1});}e.fireEvent("applicationConfiguration",{"configuration":o1.getMetadata().getConfig()});p1=new a({id:e.getId()+"-content",component:o1});p1.setHeight(e.getHeight());p1.setWidth(e.getWidth());p1.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=l1.prototype._disableRouter.bind(this,o1);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",p1,true);if(u1){v1=u1.getPluginLoadingPromise("RendererExtensions");w1=v1&&v1.state();if(w1==="pending"){v1.done(function(){l1.prototype._publishExternalEvent("appComponentLoaded",{component:o1});}).fail(function(){l1.prototype._publishExternalEvent("appComponentLoaded",{component:o1});});}if(w1==="resolved"||w1==="rejected"){l1.prototype._publishExternalEvent("appComponentLoaded",{component:o1});}}else{l1.prototype._publishExternalEvent("appComponentLoaded",{component:o1});}return p1;}function O(e){var i;if((e instanceof C)&&(typeof e.getRouter==="function")){i=e.getRouter();if(i&&(typeof i.stop==="function")){jQuery.sap.log.info("router stopped for instance "+e.getId());i.stop();}}}function Q(e){var i=document.createElement("a"),m1=new d(e).get("sap-client"),n1;i.href=e;n1=i.protocol+"//"+i.host;return new S({alias:m1?n1+"?sap-client="+m1:n1,baseUrl:n1,client:m1||undefined,platform:"abap"});}function V(e,i){var m1=false,n1=e.getDomRef(),o1,p1;if(e.getIframeWithPost()===true&&n1&&n1.getAttribute&&n1.getAttribute("sap-iframe-app")=="true"){n1=jQuery("#"+n1.getAttribute("id")+"-iframe")[0];}if(n1){o1=U(e._getIFrameUrl(n1)||window.location&&window.location.href||"");p1=o1.protocol()+"://"+o1.host();m1=(i.source===n1.contentWindow)||(i.origin===p1);}return m1;}function W(e,i,m1){var n1=JSON.stringify({type:"request",service:i,request_id:g(),body:{}});jQuery.sap.log.debug("Sending post message request to origin ' "+m1+"': "+n1,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(n1,m1);}function X(){var i=this.getDomRef();if(!i||i.tagName!=="IFRAME"){if(this.getIframeWithPost()===true&&i&&i.getAttribute&&i.getAttribute("sap-iframe-app")=="true"){return jQuery("#"+i.getAttribute("id")+"-iframe")[0];}return null;}return i;}function Y(i){var e;if(i===undefined){i=this._getIFrame();}if(this.getIframeWithPost()===true){e=jQuery("#"+i.getAttribute("id").replace("-iframe","-form"))[0].action;if(e===undefined&&(new U()).query(true).hasOwnProperty("sap-isolation-enabled")){e=i.src;}}else{e=i.src;}return e;}function Z(e,i){if(e&&!e.getActive()){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(n1)+"' on inactive container '"+e.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var m1=e.getUi5ComponentName&&e.getUi5ComponentName(),n1=i.data;if(typeof m1==="string"){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(n1)+"' on container of UI5 application '"+m1+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var o1={bApiRegistered:true};H(e,i,o1);$(e,i,o1);}var Z=t.testableStatic(Z,"ApplicationContainer_handleMessageEvent");function $(e,m1,n1){var o1,p1,q1;if(n1.bApiRegistered!==false){return;}if(P===false){P=true;o1=sap.ushell.Container.getService("PluginManager");if(o1){p1=o1.getPluginLoadingPromise("RendererExtensions");q1=p1&&p1.state();if(q1==="pending"){K=true;p1.done(function(){var r1;K=false;jQuery.sap.log.debug("Processing post messages queue after 'RendererExtensions' plugins loaded, queue size is: "+m.length,null,"sap.ushell.components.container.ApplicationContainer");for(var i=0;i<m.length;i++){r1=m[i];try{Z.call(r1.that,r1.oContainer,r1.oMessage);}catch(ex){jQuery.sap.log.error(ex.message||ex,null,"sap.ushell.components.container.ApplicationContainer");}}m=[];});}}}if(K===true){m.push({index:n++,that:this,oContainer:e,oMessage:m1});}}var $=t.testableStatic($,"ApplicationContainer_handlePostMessagesForPluginsPostLoading");function _(){P=false;K=false;m=[];n=0;}var _=t.testableStatic(_,"ApplicationContainer_resetPluginsLoadIndications");function a1(e,i){var m1=e._getIFrame(),n1=e.getApplicationType();if(u.isApplicationTypeEmbeddedInIframe(e.getApplicationType(n1))&&m1){var o1=new U(e._getIFrameUrl(m1));var p1=o1.protocol()+"://"+o1.host();m1.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),p1);i.preventDefault();}}function b1(e,i,m1){e.write("<div").writeControlData(i).writeAccessibilityState(i).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">").renderControl(m1);e.write("</div>");}function c1(e,i,m1,n1){var o1,p1=function(){var x1=u.getParameterValueBoolean("sap-accessibility");if(x1!==undefined){return x1;}return sap.ushell.Container.getUser().getAccessibilityMode();},q1=function(){var x1=new d(e)||{mParams:{}};if(x1.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(c.prototype.constants.themeFormat.NWBC);}return undefined;},r1=function(){var x1=false,y1=new d(e)||{mParams:{}};x1=sap.ui.getCore().getConfiguration().getStatistics()&&y1.mParams["sap-statistics"]===undefined;return x1;},s1=function(){var x1=window.hasher&&window.hasher.getHash(),u1="",y1;if(x1&&x1.length>0&&x1.indexOf("sap-iapp-state=")>0){y1=/(?:sap-iapp-state=)([^&/]+)/.exec(x1);if(y1&&y1.length===2){u1=y1[1];}}return u1;},t1=function(){var x1="";var y1=(!!jQuery("body.sapUiSizeCompact").length);var z1=(!!jQuery("body.sapUiSizeCozy").length);if(y1===true){x1="0";}else if(z1){x1="1";}return x1;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";o1=q1();if(o1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(o1);}if(m1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(m1);}if(p1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(r1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(n1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var u1=s1();if(u1&&u1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+u1;}var v1=t1();if(v1&&v1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+v1;}var w1=0;if(j.last("/core/shell/sessionTimeoutIntervalInMinutes")>0){w1=j.last("/core/shell/sessionTimeoutIntervalInMinutes");}e+=e.indexOf("?")>=0?"&":"?";e+="sap-ushell-timeout="+w1;return u.appendSapShellParam(e,i);}function d1(e,i,m1,n1){var o1=i.getAggregation("child");if(!o1||i._bRecreateChild){o1=l1.prototype._createUi5Component(i,m1,n1);i._bRecreateChild=false;}l1.prototype._renderControlInDiv(e,i,o1);}function e1(e,i,m1){var n1=e.getProperty(i);if(f(n1,m1)){return;}e.setProperty(i,m1);e._bRecreateChild=true;}function f1(e,i,m1,n1,o1){var p1;localStorage.removeItem(i.globalDirtyStorageKey);if(o1&&o1.indexOf("SAPUI5.Component=")===0&&m1===A.URL.type){d1(e,i,n1,o1.replace(/^SAPUI5\.Component=/,""));return;}if(o1&&o1.indexOf("SAPUI5=")===0&&m1===A.URL.type){l1.prototype._renderControlInDiv(e,i,l1.prototype._createUi5View(i,n1,o1));return;}jQuery.sap.log.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+o1);if(!i.getActive()){jQuery.sap.log.debug("Skipping rendering container iframe","Container '"+i.getId()+"' is inactive");return;}try{n1=i.getFrameSource(m1,n1,o1);}catch(ex){jQuery.sap.log.error(ex.message||ex,null,s);i.fireEvent("applicationConfiguration");e.renderControl(l1.prototype._createErrorControl());return;}if(sap.ushell.Container){p1=l1.prototype._getLogoutHandler(i);if(!p1){if(u.isApplicationTypeEmbeddedInIframe(m1)){p1=l1.prototype._logout.bind(null,i);l.put(i.getId(),p1);sap.ushell.Container.attachLogoutEvent(p1);sap.ushell.Container.addRemoteSystem(l1.prototype._createSystemForUrl(n1));}}else if(!u.isApplicationTypeEmbeddedInIframe(m1)){sap.ushell.Container.detachLogoutEvent(p1);l.remove(i.getId());}}if(u.isApplicationTypeEmbeddedInIframe(m1)){var r1=i.getTargetNavigationMode();n1=l1.prototype._adjustNwbcUrl(n1,m1,r1,i.getIsStateful());u.localStorageSetItem(i.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}n1=this._adjustURLForIsolationOpeningWithoutURLTemplate(n1);if(i.getIframeWithPost()===true&&(u.isApplicationTypeEmbeddedInIframe(m1)||i.getIsPostCapability()===true)){i.oDeferredRenderer=new jQuery.Deferred();n1=l1.prototype._filterURLParams(n1);var s1=[];var t1=l1.prototype._getParamKeys(n1,s1);l1.prototype._generateRootElementForIFrame(e,i,true);if(t1.length>0){var u1=sap.ushell.Container.getService("CrossApplicationNavigation");u1.getAppStateData(t1).then(function(q1){var v1;var w1=jQuery("#"+i.getId());if(w1){v1=sap.ui.getCore().createRenderManager();l1.prototype._buildHTMLElements(v1,i,q1,s1,n1,true);v1.flush(w1[0]);v1.destroy();i.oDeferredRenderer.resolve();}},function(q1){l1.prototype._buildHTMLElements(e,i,undefined,s1,n1,true);i.oDeferredRenderer.resolve();});}else{l1.prototype._buildHTMLElements(e,i,undefined,s1,n1,false);i.oDeferredRenderer.resolve();}l1.prototype._generateRootElementForIFrame(e,i,false);return;}i.fireEvent("applicationConfiguration");e.write("<iframe").writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("src",n1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write("></iframe>");}function g1(e){var i=new d(document.URL);if(i.get("sap-isolation-enabled")==="true"){var m1=sap.ushell.Container.getService("URLParsing"),n1=m1.getHash(document.URL),o1="",p1="&sap-plugins="+encodeURIComponent(sap.ushell.Container.getService("PluginManager")._getNamesOfPluginsWithAgents());if(e.indexOf("&/")>0){o1=e.substr(e.indexOf("&/"));}if(p1==="&sap-plugins="){p1="";}if(n1){var q1=m1.parseShellHash("#"+n1),r1=m1.paramsToString(q1.params);if(r1&&r1.length>=0){var s1=sap.ushell.Container.getService("AppState").createEmptyAppState(),t1=sap.ushell.Container.getService("AppState").createEmptyAppState(),u1="";if(r1.indexOf("sap-intent-param")>=0){u1=encodeURIComponent(r1);}else{s1.setData(r1);s1.save();u1=encodeURIComponent("sap-intent-param="+s1.getKey());}t1.setData("sap-startup-params="+u1);t1.save();e=e.split("#")[0]+"&sap-intent-param="+t1.getKey()+p1+"#"+window.hasher.getHash();}else{e=e.split("#")[0]+p1+"#"+window.hasher.getHash();}}else{e+="#"+window.hasher.getHash();}if(e.indexOf("&/")<0){e+=o1;}}if(i.has("sap-iframe-params")){var v1=i.get("sap-iframe-params")||"",w1=v1.split(",");w1.forEach(function(x1){if(x1&&x1.length>0){if(i.has(x1)){e=e.split("#")[0]+"&"+x1+"="+i.get(x1)+"#"+e.split("#")[1];}}});}return e;}function h1(e){var i=new U(e);i=i.removeSearch(q);return i.toString();}function i1(e,i){var m1=[],n1;if(e.indexOf("sap-intent-param=")>0){n1=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(n1&&n1.length===2){m1.push([n1[1]]);i.push("sap-intent-param-data");}}if(e.indexOf("sap-xapp-state=")>0){n1=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(n1&&n1.length===2){m1.push([n1[1]]);i.push("sap-xapp-state-data");}}if(e.indexOf("sap-iapp-state=")>0){n1=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(n1&&n1.length===2){m1.push([n1[1]]);i.push("sap-iapp-state-data");}}return m1;}function j1(e,i,m1,n1,o1,p1){var q1=i.getId()+"-form",r1="",s1=false;if(m1===undefined){m1=[];}m1.push([sap.ushell.Container.getFLPUrl(true)]);n1.push("sap-flp-url");var t1="";var u1={};n1.forEach(function(w1,x1){if(m1[x1][0]){u1[w1]=m1[x1][0];}});t1=JSON.stringify(u1);r1="<input name=\"sap-flp-params\" value=\""+h(t1)+"\">";i.fireEvent("applicationConfiguration");e.write("<form").writeAttributeEscaped("method","post").writeAttributeEscaped("id",q1).writeAttributeEscaped("name",q1).writeAttributeEscaped("target",i.getId()+"-iframe").writeAttributeEscaped("action",o1).addStyle("display","none").writeStyles().write(">").writeAttributeEscaped(r1).write("</form>");var v1=i.sId;if(!p1&&i.hasStyleClass("hidden")){s1=true;i.toggleStyleClass("hidden",false);}i.sId+="-iframe";e.write("<iframe").writeAttributeEscaped("name",i.getId()).writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("sap-orig-src",o1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write("></iframe>");i.sId=v1;if(s1){i.toggleStyleClass("hidden",true);}}function k1(e,i,m1){if(m1){e.write("<div").writeControlData(i).writeAttributeEscaped("sap-iframe-app","true").addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");}else{e.write("</div>");}}var l1=b.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:p+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},iframeWithPost:{defaultValue:false,type:"boolean"},beforeAppCloseEvent:{type:"object"},isPostCapability:{defaultValue:false,type:"boolean"}},events:{"applicationConfiguration":{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,i=this;if(sap.ushell.Container){e=l1.prototype._getLogoutHandler(i);if(e){sap.ushell.Container.detachLogoutEvent(e);l.remove(i.getId());}}localStorage.removeItem(i.globalDirtyStorageKey);if(i._unloadEventListener){removeEventListener("unload",i._unloadEventListener);}if(i._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",i._disableRouterEventHandler);}if(i._storageEventListener){removeEventListener("storage",i._storageEventListener);}if(i._messageEventListener){removeEventListener("message",i._messageEventListener);}l1.prototype._destroyChild(i);if(b.exit){b.exit.apply(i);}},setHandleMessageEvent:function(i){H=i;},init:function(){var e=this;e.globalDirtyStorageKey=k+g();if(new d(window.location.href).get("sap-post")==="true"){e.setIframeWithPost(true);}e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(i){var m1=e.getApplicationType();if(i.key===e.globalDirtyStorageKey&&i.newValue===sap.ushell.Container.DirtyState.PENDING&&u.isApplicationTypeEmbeddedInIframe(m1)){var n1=e._getIFrame();if(n1){jQuery.sap.log.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var o1=new U(e._getIFrameUrl(n1));var p1=o1.protocol()+"://"+o1.host();n1.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),p1);}}};addEventListener("storage",e._storageEventListener);e._messageEventListener=l1.prototype._handleMessageEvent.bind(null,e);addEventListener("message",e._messageEventListener);},onAfterRendering:function(){var e=this;this.rerender=function(){};if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){var i=document.getElementById(e.getId()+"-form");if(i){i.submit();}});}},renderer:function(e,i){var m1=i.getApplication(),n1=i.launchpadData,o1;if(!i.getVisible()){l1.prototype._renderControlInDiv(e,i);return;}if(i.error){delete i.error;l1.prototype._renderControlInDiv(e,i,l1.prototype._createErrorControl());}else if(!m1){l1.prototype._render(e,i,i.getApplicationType(),i.getUrl(),i.getAdditionalInformation());}else if(!m1.isResolvable()){l1.prototype._render(e,i,m1.getType(),m1.getUrl(),"");}else if(n1){l1.prototype._render(e,i,n1.applicationType,n1.Absolute.url.replace(/\?$/,""),n1.applicationData);}else{jQuery.sap.log.debug("Resolving "+m1.getUrl(),null,s);m1.resolve(function(p1){jQuery.sap.log.debug("Resolved "+m1.getUrl(),JSON.stringify(p1),s);i.launchpadData=p1;l1.prototype._destroyChild(i);},function(p1){var q1=m1.getMenu().getDefaultErrorHandler();if(q1){q1(p1);}l1.prototype._destroyChild(i);i.error=p1;});o1=new T({text:l1.prototype._getTranslatedText("loading",[m1.getText()])});l1.prototype._destroyChild(i);i.setAggregation("child",o1);l1.prototype._renderControlInDiv(e,i,o1);}}});l1.prototype.getFrameSource=function(e,i){if(!Object.prototype.hasOwnProperty.call(A.enum,e)){throw new Error("Illegal application type: "+e);}return i;};l1.prototype.setUrl=function(e){e1(this,"url",e);};l1.prototype.setAdditionalInformation=function(e){e1(this,"additionalInformation",e);};l1.prototype.setApplicationType=function(e){e1(this,"applicationType",e);};l1.prototype.createPostMessageRequest=function(e,i){var m1=Date.now().toString();return{"type":"request","request_id":m1,"service":e,"body":i};};l1.prototype.setNewTRApplicationContext=function(e){var i=new jQuery.Deferred(),m1=this._getIFrame(),n1,o1,p1=this;if(!m1){return i.promise().reject({message:"Expected an exisiting TR application application frame but found none."});}function q1(){if(o1){o1["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);n1["sap-flp-params"]=h(JSON.stringify(o1));}var u1=p1.createPostMessageRequest("sap.its.startService",n1);p1.postMessageToIframe(u1,m1,true).then(function(){i.resolve();},function(v1){i.reject({eventData:v1,message:"Failed to change application context."});});}e=u.appendSapShellParam(e);n1={"url":e};if(this.getIframeWithPost&&this.getIframeWithPost()===true){var r1=[];var s1=l1.prototype._getParamKeys(e,r1);if(s1.length>0){var t1=sap.ushell.Container.getService("CrossApplicationNavigation");t1.getAppStateData(s1).then(function(u1){o1={};r1.forEach(function(v1,w1){if(u1[w1][0]){o1[v1]=u1[w1][0];}});q1();},function(u1){q1();});}else{o1={};q1();}}else{q1();}return i.promise();};l1.prototype.postMessageToIframe=function(i,m1,n1){var o1=this;var p1=i.request_id;return new Promise(function(q1,r1){function s1(w1){var x1;try{x1=JSON.parse(w1.data,o1);if(p1!==x1.request_id){return;}if(x1.status==="success"){q1(x1);}else{r1(x1);}window.removeEventListener("message",s1);}catch(e){q1();jQuery.sap.log.warning("Obtained bad response from framework in response to message "+i.request_id);jQuery.sap.log.debug("Underlying framework returned invalid response data: '"+w1.data+"'");}}var t1=JSON.stringify(i);jQuery.sap.log.debug("Sending postMessage "+t1+" to application container '"+o1.getId()+"'");var u1=new U(o1._getIFrameUrl(m1));var v1=u1.protocol()+"://"+u1.host();if(n1){window.addEventListener("message",s1,false);m1.contentWindow.postMessage(t1,v1);}else{m1.contentWindow.postMessage(t1,v1);q1();}});};l1.prototype.postMessageToCurrentIframe=function(e,i){if(i===undefined){i=false;}var m1=this._getIFrame();if(!m1){if(i){return Promise.reject({message:"Expected opened iframe not found."});}return;}return this.postMessageToIframe(e,m1,i);};l1.prototype.setNewApplicationContext=function(e,i){var m1=this;var n1=this["setNew"+e+"ApplicationContext"];if(!n1){return Promise.reject({message:"Unsupported application type"});}var o1=this._getIFrame();if(!o1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var p1=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(p1,o1,true).then(function(){return n1.call(m1,i);},function(q1){return Promise.reject({eventData:q1,message:"Failed to change application context."});});};l1.prototype.onApplicationOpened=function(e){var i=this.getIsStateful();if(!i){return Promise.resolve();}var m1=this.getApplicationType();if(m1==="TR"&&e!=="TR"){var n1=this._getIFrame();if(!n1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var o1=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(o1,n1,false).catch(function(p1){return Promise.reject({eventData:p1,message:"Failed to change application context."});});}return Promise.resolve();};l1.prototype.postMessageRequest=function(e,i){var m1=this._getIFrame();if(!m1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var n1=this.createPostMessageRequest(e,i||{});return this.postMessageToIframe(n1,m1,false).catch(function(o1){return Promise.reject({eventData:o1,message:"Failed to post message."});});};l1.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),i;if(e&&e.enabled&&e.enabled===true){i=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(i,this._getIFrame(),true);}else{return undefined;}};l1.prototype._getCommunicationHandlers=y;l1.prototype._adaptIsUrlSupportedResultForMessagePopover=v;l1.prototype._getLogoutHandler=x;l1.prototype._getParameterMap=z;l1.prototype._getTranslatedText=B;l1.prototype._createErrorControl=F;l1.prototype._destroyChild=G;l1.prototype._createUi5View=J;l1.prototype._publishExternalEvent=L;l1.prototype._createUi5Component=N;l1.prototype._disableRouter=O;l1.prototype._createSystemForUrl=Q;l1.prototype._isTrustedPostMessageSource=V;l1.prototype._handleMessageEvent=Z;l1.prototype._logout=a1;l1.prototype._renderControlInDiv=b1;l1.prototype._adjustNwbcUrl=c1;l1.prototype._render=f1;l1.prototype._getParamKeys=i1;l1.prototype._buildHTMLElements=j1;l1.prototype._generateRootElementForIFrame=k1;l1.prototype._backButtonPressedCallback=W;l1.prototype._getIFrame=X;l1.prototype._getIFrameUrl=Y;l1.prototype._filterURLParams=h1;l1.prototype._adjustURLForIsolationOpeningWithoutURLTemplate=g1;return l1;},true);
