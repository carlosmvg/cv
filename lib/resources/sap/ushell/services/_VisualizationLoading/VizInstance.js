// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/events/PseudoEvents","sap/ushell/library","sap/ushell/resources","sap/ushell/services/_VisualizationLoading/VizInstanceRenderer"],function(m,C,I,P,u,r){"use strict";var L=m.LoadState;var V=u.VisualizationLoadState;var a=C.extend("sap.ushell.ui.launchpad.VizInstance",{metadata:{library:"sap.ushell",properties:{visualizationId:{type:"string"},editable:{type:"boolean",defaultValue:false,bindable:true},type:{type:"string"},vizType:{type:"string"},state:{type:"sap.ushell.VisualizationLoadState",defaultValue:V.Loading},previewMode:{type:"boolean",defaultValue:false},catalogTile:{type:"any"},title:{type:"string"},subtitle:{type:"string"},icon:{type:"string"},footer:{type:"string"},targetURL:{type:"string"},adapter:{type:"any"},keywords:{type:"string[]",defaultValue:[]},width:{type:"int",defaultValue:1},height:{type:"int",defaultValue:1}},aggregations:{innerControl:{type:"sap.ui.core.Control",multiple:false,hidden:true},removeIcon:{type:"sap.ui.core.Icon",multiple:false,hidden:true}},events:{press:{parameters:{scope:{type:"sap.m.GenericTileScope"},action:{type:"string"}}}}},renderer:"sap.ushell.services._VisualizationLoading.VizInstanceRenderer"});a.prototype.init=function(){var R=new I({src:"sap-icon://decline",press:[this._onRemoveIconPressed,this],tooltip:r.i18n.getText("removeButtonTitle"),noTabStop:true});R.addStyleClass("sapMPointer");R.addStyleClass("sapUshellTileDeleteIconInnerClass");this.setAggregation("removeIcon",R);};a.prototype._onRemoveIconPressed=function(){this.firePress({scope:"Actions",action:"Remove"});};a.prototype.setState=function(s){this.setProperty("state",s);var i=this.getInnerControl(),b,f;switch(s){case V.InsufficientRoles:case V.OutOfRoleContext:b=L.Failed;f=r.i18n.getText("VisualizationInstance.OutOfRoleContext");break;case V.NoNavTarget:b=L.Loaded;break;default:b=s;}if(i&&i.setState){i.setState(b);if(i.setFailedText&&f){i.setFailedText(f);}}else{this._getInnerControlPromise().then(function(c){if(c.setState){c.setState(b);}if(c.setFailedText&&f){c.setFailedText(f);}});}};a.prototype.getFocusDomRef=function(){if(!this.getEditable()){var p=this.getInnerControl().findAggregatedObjects(true,function(c){return c.isA("sap.m.GenericTile")||c.isA("sap.f.Card");});if(p.length){return p[0].getFocusDomRef();}}return this.getInnerControl().getFocusDomRef();};a.prototype.onAfterRendering=function(){this.getDomRef("innerControl").onclick=function(e){return this._preventDefault(e);}.bind(this);};a.prototype.onsapspace=function(e){return this._preventDefault(e);};a.prototype.onsapenter=function(e){return this._preventDefault(e);};a.prototype.onkeyup=function(e){if(this.getEditable()&&(P.events.sapdelete.fnCheck(e)||P.events.sapbackspace.fnCheck(e))){this.firePress({scope:"Actions",action:"Remove"});}};a.prototype._preventDefault=function(e){if(this.getEditable()){e.preventDefault();e.stopPropagation();return false;}return true;};a.prototype.getLayout=function(){var w=this.getWidth(),h=this.getHeight();var s=(Object.getPrototypeOf(this).getMetadata().getName()==="sap.ushell.ui.launchpad.VizInstanceCard")?1:2;var l={columns:w*s,rows:h*s};return l;};a.prototype.load=function(v){if(!this.oInnerControl&&this.oControlPromise){return this.oControlPromise;}return new Promise(function(b,c){if(this.oInnerControl){b(this.oInnerControl);return;}this._setVizViewControlPromise(v);this.oControlPromise.then(function(o){this.setAggregation("innerControl",o,false);b(o);}.bind(this)).catch(c);}.bind(this));};a.prototype._setVizViewControlPromise=function(){this.oControlPromise=Promise.resolve({});};a.prototype._getInnerControlPromise=function(){return this.oControlPromise;};return a;});
