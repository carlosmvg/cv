// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/XMLComposite","sap/ui/core/Icon","sap/m/VBox","sap/m/Button","sap/ui/events/PseudoEvents","sap/ushell/resources","sap/m/ActionSheet"],function(m,X,I,V,B,P,r,A){"use strict";var L=m.LoadState;var T=m.TileSizeBehavior;var a=X.extend("sap.ushell.ui.launchpad.VizInstance",{metadata:{library:"sap.ushell",properties:{title:{type:"string",defaultValue:"",bindable:true},subtitle:{type:"string",defaultValue:"",bindable:true},height:{type:"int",defaultValue:2},width:{type:"int",defaultValue:2},info:{type:"string",defaultValue:"",bindable:true},icon:{type:"sap.ui.core.URI",defaultValue:"",bindable:true},state:{type:"sap.m.LoadState",defaultValue:L.Loaded,bindable:true},sizeBehavior:{type:"sap.m.TileSizeBehavior",defaultValue:T.Responsive,bindable:true},editable:{type:"boolean",defaultValue:false,bindable:true},active:{type:"boolean",defaultValue:false},targetURL:{type:"string"},indicatorDataSource:{type:"object",defaultValue:undefined},keywords:{type:"string[]",defaultValue:[]},instantiationData:{type:"object",defaultValue:{}},tileActions:{type:"object",defaultValue:{}},contentProviderId:{type:"string",defaultValue:""},vizConfig:{type:"object"}},events:{press:{parameters:{scope:{type:"sap.m.GenericTileScope"},action:{type:"string"}}}}},fragment:"sap.ushell.services._VisualizationInstantiation.VizInstance"});a.prototype.init=function(){X.prototype.init.apply(this,arguments);this._oContent=this.getAggregation("_content");};a.prototype.exit=function(){if(this._oEditModeOverlayContainer){this._oEditModeOverlayContainer.destroy();}if(this._oActionModeButtonIconVBox){this._oActionModeButtonIconVBox.destroy();}if(this._oActionDivCenter){this._oActionDivCenter.destroy();}if(this._oActionSheet){this._oActionSheet.destroy();}};a.prototype.getLayout=function(){return{columns:this.getWidth(),rows:this.getHeight()};};a.prototype._setContent=function(c){var g=this.getLayoutData();if(g&&g.isA("sap.f.GridContainerItemLayoutData")){g.setRows(this.getHeight());g.setColumns(this.getWidth());this.getParent().invalidate();}this._oContent=c;this.invalidate();};a.prototype._updateContent=function(){var c=this._oContent;if(this.getEditable()){c=this._getEditModeOverlay(c);}if(this._oContent.getItems){this.setAggregation("_content",c.getItems()[0]);}else{this.setAggregation("_content",c);}};a.prototype._getEditModeOverlay=function(c){var t=this.getTileActions();var b=Object.keys(t);if(!this._oEditModeOverlayContainer){var R=new I({src:"sap-icon://decline",press:[this._onRemoveIconPressed,this],tooltip:r.i18n.getText("removeButtonTitle"),noTabStop:true}).addStyleClass("sapUshellTileDeleteIconInnerClass sapMPointer");this._oRemoveIconVBox=new V({items:[R]}).addStyleClass("sapUshellTileDeleteIconOuterClass sapUshellTileDeleteClickArea sapMPointer");this._oEditModeOverlayContainer=new V().addStyleClass("sapUshellVizInstance");if(b.length>0){this._oActionDivCenter=new V().addStyleClass("sapUshellTileActionDivCenter");this._oActionDivCenter.attachBrowserEvent("click",this._onActionMenuIconPressed,this);this._oActionModeIcon=new I({src:"sap-icon://overflow",press:[this._onActionMenuIconPressed,this],tooltip:r.i18n.getText("configuration.category.tile_actions"),noTabStop:true}).addStyleClass("sapUshellTileActionIconDivBottomInner sapMPointer");this._oActionModeButtonIconVBox=new V({items:[this._oActionModeIcon]}).addStyleClass("sapUshellTileActionIconDivBottom sapMPointer");}}this._oEditModeOverlayContainer.removeAllItems();this._oEditModeOverlayContainer.addItem(c);this._oEditModeOverlayContainer.addItem(this._oRemoveIconVBox);if(b.length>0){this._oEditModeOverlayContainer.addItem(this._oActionDivCenter);this._oEditModeOverlayContainer.addItem(this._oActionModeButtonIconVBox);}return this._oEditModeOverlayContainer;};a.prototype._onRemoveIconPressed=function(){this.firePress({scope:"Actions",action:"Remove"});};a.prototype._onActionMenuIconPressed=function(){if(!this._oActionSheet){if(Object.keys(this.getProperty("tileActions")).length===0){this._oActionSheet=new A({buttons:[new B({text:r.i18n.getText("tileHasNoActions"),enabled:false})]});}else{}}this._oActionSheet.openBy(this._oActionModeIcon);};a.prototype.getFocusDomRef=function(){if(this.getEditable()){return this._oActionModeIcon&&this._oActionModeIcon.getFocusDomRef();}var p=this._oContent.findAggregatedObjects(true,function(c){return c.isA("sap.m.GenericTile")||c.isA("sap.f.Card");});if(p.length){return p[0].getFocusDomRef();}return this._oContent.getFocusDomRef();};a.prototype.onclick=function(e){if(this._preventDefault(e)){this.firePress({scope:"Display",action:"Press"});}};a.prototype.onBeforeRendering=function(){this._updateContent();var d=this.getDomRef();if(d){d.removeEventListener("keyup",this._fnKeyupHandler);d.removeEventListener("touchend",this._fnTouchendHandler);}};a.prototype.onAfterRendering=function(){var d=this.getDomRef();this._fnKeyupHandler=this.onkeyup.bind(this);this._fnTouchendHandler=this.onclick.bind(this);d.addEventListener("keyup",this._fnKeyupHandler,true);d.addEventListener("touchend",this._fnTouchendHandler,true);};a.prototype.onkeyup=function(e){if(this.getEditable()){if((P.events.sapdelete.fnCheck(e)||P.events.sapbackspace.fnCheck(e))){this.firePress({scope:"Actions",action:"Remove"});}if(P.events.sapspace.fnCheck(e)||P.events.sapenter.fnCheck(e)){this._preventDefault(e);}}};a.prototype._preventDefault=function(e){if(this.getEditable()){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false;}return true;};a.prototype.load=function(){return Promise.resolve();};a.prototype._setSize=function(t){if(t){var s=t.split("x");var h=parseInt(s[0],10);var w=parseInt(s[1],10);if(w&&h){w=w*2;h=h*2;this.setWidth(w);this.setHeight(h);}}};return a;});
