// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/Config","sap/base/util/deepClone","sap/base/util/isPlainObject","sap/base/util/ObjectPath"],function(r,a,b,u,C,d,i,O){"use strict";var c={};c.getVizData=function(s,v,U){var V=C.last("/core/spaces/vizInstantiation/enabled");if(v.isBookmark&&v.url){v=d(v);v.subTitle=v.subtitle;v.target=u.toTargetFromHash(v.url,U);}var e=this.getCdmParts(s,v);var A=e&&e[3]||{};var o=r.get(s,b.getTileVizId(v))||{};var f={id:b.getTileId(v),vizId:b.getTileVizId(v)||"",vizType:v.vizType||r.getTypeId(o)||"",vizConfig:v.vizConfig,title:r.getTitle(e)||"",subtitle:r.getSubTitle(e)||"",icon:r.getIcon(e)||"",keywords:r.getKeywords(e)||[],info:r.getInfo(e)||"",target:v.target||r.getTarget(o)||{},indicatorDataSource:v.indicatorDataSource||r.getIndicatorDataSource(o),isBookmark:v.isBookmark||false,contentProviderId:a.getContentProviderId(A)||"",_instantiationData:r.getInstantiationData(o)};f.target=this._harmonizeTarget(f.target);f.targetURL=u.toHashFromVizData(f,s.applications,U);if(v.isBookmark){this._addBookmarkInstantiationData(f,s);}if(!f._instantiationData||!Object.keys(f._instantiationData)){f._instantiationData={platform:"CDM",vizType:r.getType(s,f.vizType)};}if(!V&&f.isBookmark){f.url=f.targetURL;}return f;};c.getVizRef=function(v){var V={id:v.id,vizId:v.vizId,title:v.title,subTitle:v.subtitle,icon:v.icon,keywords:v.keywords,info:v.info,target:v.target,indicatorDataSource:v.indicatorDataSource,contentProviderId:v.contentProviderId};if(v.isBookmark){V.isBookmark=v.isBookmark;if(v.vizConfig){V.vizType=v.vizType;V.vizConfig=v.vizConfig;}}return V;};c.getCdmParts=function(s,t){var v=r.get(s,b.getTileVizId(t))||{};var V=r.getConfig(v);var A=r.getAppDescriptor(s,r.getAppId(v));var I=a.getInbound(A,r.getInboundId(v));return[t,V,I,A];};c._harmonizeTarget=function(t){var p=t.parameters;if(!p||i(p)){return t;}var P={};p.forEach(function(o){P[o.name]={value:{value:o.value,format:"plain"}};});t.parameters=P;return t;};c._addBookmarkInstantiationData=function(v,s){if(v.vizType){var V=r.getType(s,v.vizType);if(V!==undefined){v._instantiationData={platform:"CDM",vizType:V};}else{var o=O.get(["vizConfig","sap.flp","chipConfig"],v);v._instantiationData={platform:"ABAP",chip:d(o),simplifiedChipFormat:true};}}else if(v.indicatorDataSource){v.vizType="sap.ushell.DynamicAppLauncher";}else{v.vizType="sap.ushell.StaticAppLauncher";}};return c;},true);
