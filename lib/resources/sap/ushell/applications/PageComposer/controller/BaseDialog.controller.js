// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["./BaseController","sap/ui/core/Fragment","sap/ui/core/library","sap/ui/model/json/JSONModel"],function(B,F,c,J){"use strict";var V=c.ValueState;return B.extend("sap.ushell.applications.PageComposer.controller.BaseDialog.controller",{destroy:function(){if(this._oView.byId(this.sViewId)){this._oView.byId(this.sViewId).destroy();}},attachCancel:function(a){this._fnCancel=a;},attachConfirm:function(a){this._fnConfirm=a;},onCancel:function(){this.close();if(this._fnCancel){this._fnCancel();}},onConfirm:function(e){function f(s){var b=this._oView.getControlsByFieldGroupId(s);if(b.length){b[0].fireValidateFieldGroup({fieldGroupIds:[s]});}}function a(){var t=this._oView.byId("transportContainer").getComponentInstance();var T=t&&t.getRootControl();if(T){var p=T.byId("packageInput");if(p){p.fireChangeEvent(p.getValue());}var o=T.byId("transportInput");if(o){o.fireChangeEvent(o.getValue());}}}f.call(this,"pageGroup");a.call(this);var v=this.getModel().getProperty("/validation");var i=this.validate(v);if(i&&this._fnConfirm){this._fnConfirm(e);}},getModel:function(){if(!this._oModel){this._oModel=new J({});}return this._oModel;},_resetModel:function(){var m=this.getModel();var v=m.getProperty("/validation")||{};m.setProperty("/",{validation:v});},onValidateFieldGroup:function(e){function g(C,f){if(!C){return[];}if(C.getControlsByFieldGroupId){var I=C.getControlsByFieldGroupId(f);if(I.length){return I;}}return g(C.getParent(),f);}function v(I){var a=0;I.forEach(function(i){try{i.getBinding("value").getType().validateValue(i.getValue());i.fireValidationSuccess({element:i});}catch(E){if(E.message.indexOf("validateValue")>=0){throw new Error("The input's \"value\" binding must have a \"type\" to be validated");}i.fireValidationError({element:i,exception:E});a++;}});return!a;}var i=e.getSource();var m=i.getModel();e.getParameters().fieldGroupIds.forEach(function(f){var I=g(i,f);m.setProperty("/validation/"+f,v(I));});},onValidationSuccess:function(e){var i=e.getSource();i.setValueState(V.None);},onValidationError:function(e){var E=e.getParameter("exception");var m=E.message;var i=e.getSource();var v=i.getBindingPath("value");if(v){i.getModel().setProperty(v,i.getValue());}if(E.violatedConstraints.indexOf("search")>=0){var I=i.getModel("i18n").getProperty("Message.InvalidPageID");if(m.indexOf(I)===-1){if(m){m+=((m.slice(-1)!==".")?". ":" ");}m+=I;}}i.setValueStateText(m);i.setValueState(V.Error);e.bCancelBubble=true;},validate:function(v){for(var k in v){if(!v[k]){return false;}}return true;},transportExtensionPoint:function(a){this._oView.byId("transportContainer").setComponent(a);},load:function(){var f={id:this._oView.getId(),name:this.sId,controller:this};return F.load(f).then(function(o){o.setModel(this._oModel);this._oDialog=o;this._oView.addDependent(this._oDialog);}.bind(this));},open:function(){this._oDialog.open();},close:function(){this._oDialog.close();},handleNamespaceChange:function(i){var t=this._oView.byId("transportContainer").getComponentInstance();if(t){t.showTransport({id:i},"Page");}},onPageIDChange:function(e){var n=e.getParameters().value;this.handleNamespaceChange(n);}});});
